
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>EOS architecture specification &#8212; EOS 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="eos-architecture-specification">
<h1>EOS architecture specification<a class="headerlink" href="#eos-architecture-specification" title="Permalink to this headline">¶</a></h1>
<p>This is the architecture specification for EOS project. This document specifies
the architecture of EOS software, hardware and also processes involved in
development of EOS, its deployment, maintenance and evolution.</p>
<section id="overall-system-description">
<h2>Overall system description<a class="headerlink" href="#overall-system-description" title="Permalink to this headline">¶</a></h2>
<p>The goal of EOS is to develop a generic object store solution. An EOS deployment
consists of sofware (to be developed as part of the project) installed on
Seagate hardware assembled on the customer’s premises (so called <em>private
cloud</em>). Access to the data is through the industry standard interfaces: <a class="reference external" href="https://en.wikipedia.org/wiki/Amazon_S3">S3</a> and <a class="reference external" href="https://en.wikipedia.org/wiki/Network_File_System">NFS</a>. EOS includes <a class="reference external" href="https://en.wikipedia.org/wiki/Reliability,_availability_and_serviceability">RAS</a>,
provisioning, cluster management and monitoring UI.</p>
<p><strong>Add some high level marketing justification.</strong></p>
</section>
<section id="high-level-decomposition">
<h2>High level decomposition<a class="headerlink" href="#high-level-decomposition" title="Permalink to this headline">¶</a></h2>
<p>At the highest level, EOS consists of software, hardware, and processes for its
development, deployment, maintenance and evolution.</p>
<p>Top-level software components are:</p>
<blockquote>
<div><ul class="simple">
<li><p>mero [<a class="reference internal" href="#component-mero">mero</a>]: a scalable storage software providing object store and
key-value store interfaces;</p></li>
<li><p>halon [<a class="reference internal" href="#component-halon">halon</a>]: a high-availability sub-system that monitors and manages
other software and hardware components;</p></li>
<li><p>s3 [<a class="reference internal" href="#component-s3">s3</a>]: an implementation of s3 server using mero to store data
and meta-data;</p></li>
<li><p>nfs [<a class="reference internal" href="#component-nfs">nfs</a>]: an implementation of nfs server, based on open source
<a class="reference external" href="https://github.com/nfs-ganesha/nfs-ganesha/wiki">Ganesha</a>, using mero
to store data and meta-data;</p></li>
<li><p>provisioner [<a class="reference internal" href="#component-provisioner">provisioner</a>];</p></li>
<li><p>RAS [<a class="reference internal" href="#component-ras">ras</a>];</p></li>
<li><p>management interface (cli and gui) [<a class="reference internal" href="#component-managementui">managementui</a>];</p></li>
<li><p>operating system [<a class="reference internal" href="#component-os">os</a>].</p></li>
</ul>
</div></blockquote>
<p>The software components listed above are <em>deployed</em> software, that is, they
execute on the EOS deployments. In addition, EOS includes <em>non-deployed software</em>:</p>
<blockquote>
<div><ul class="simple">
<li><p>test scripts;</p></li>
<li><p>RE infrastructure;</p></li>
<li><p>continuous intergration infrastructure;</p></li>
<li><p>debugging tools;</p></li>
<li><p>development tools, like VM images.</p></li>
</ul>
</div></blockquote>
<p>EOS hardware is organised hierarchically into:</p>
<blockquote>
<div><ul class="simple">
<li><p>a deployment [<a href="#id152"><span class="problematic" id="id153">`deployment &lt;entity.deployment_&gt;`_</span></a>], which is a collection of</p></li>
<li><p>clusters [<a href="#id154"><span class="problematic" id="id155">`cluster &lt;entity.cluster_&gt;`_</span></a>], each corresponding to an s3 region
[<a class="reference internal" href="#entity-s3-region">s3.region</a>], consisting of</p></li>
<li><p>sites [<a href="#id156"><span class="problematic" id="id157">`site &lt;entity.site_&gt;`_</span></a>], also known as <em>data centres</em>, corresponding to an s3
<em>availability zone</em>, consisting of</p></li>
<li><p>racks [<a class="reference internal" href="#entity-rack">rack</a>], consisting of</p>
<ul>
<li><p>top-of-the-rack network switches [<a href="#id158"><span class="problematic" id="id159">`switch &lt;entity.switch_&gt;`_</span></a>],</p></li>
<li><p>management server nodes (CMU) [<a href="#id160"><span class="problematic" id="id161">`cmu &lt;entity.cmu_&gt;`_</span></a>],</p></li>
<li><p>storage servers [<a href="#id162"><span class="problematic" id="id163">`ss &lt;entity.ss_&gt;`_</span></a>],</p></li>
<li><p>data enclosures [<a href="#id164"><span class="problematic" id="id165">`enclosure &lt;entity.enclosure_&gt;`_</span></a>], including</p>
<ul>
<li><p>PODS controllers [<a href="#id166"><span class="problematic" id="id167">`pods &lt;entity.pods_&gt;`_</span></a>] to which attached are</p>
<ul>
<li><p>storage devices.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div></blockquote>
<p>Hardware units are <em>failure domains</em> [<a class="reference internal" href="#entity-failuredomain">failuredomain</a>].</p>
</section>
<section id="requirements">
<h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h2>
</section>
<section id="architectural-diagrams">
<h2>Architectural diagrams<a class="headerlink" href="#architectural-diagrams" title="Permalink to this headline">¶</a></h2>
<section id="component-and-connector">
<h3>Component and connector<a class="headerlink" href="#component-and-connector" title="Permalink to this headline">¶</a></h3>
</section>
<section id="use-depends-diagram-software-components">
<h3>Use-depends diagram (software components)<a class="headerlink" href="#use-depends-diagram-software-components" title="Permalink to this headline">¶</a></h3>
</section>
<section id="data-flow-control-flow">
<h3>Data flow, control flow<a class="headerlink" href="#data-flow-control-flow" title="Permalink to this headline">¶</a></h3>
</section>
<section id="deployment">
<h3>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h3>
</section>
</section>
<section id="components">
<h2>Components<a class="headerlink" href="#components" title="Permalink to this headline">¶</a></h2>
<p>EOS software is decomposed into components, also called modules. Modules
interact with each other through defined interfaces or protocols, can be
planned, estimated and developed independently.</p>
<p>This section contains informal overview of the components and can be read in
sequential order to get an overview of the eos. Formal descriptions are given in
the appropriate entries of the <a class="reference internal" href="#encyclopaedia">Encyclopædia</a>.</p>
<section id="eos">
<span id="component-eos"></span><h3>eos<a class="headerlink" href="#eos" title="Permalink to this headline">¶</a></h3>
<p>Top-level component, containing all deployed EOS software.</p>
<dl class="field-list simple">
<dt class="field-odd">Parent</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Sub-components</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>], [<a class="reference internal" href="#component-s3">s3</a>], [<a class="reference internal" href="#component-nfs">nfs</a>], [<a class="reference internal" href="#component-halon">halon</a>],
[<a class="reference internal" href="#component-provisioner">provisioner</a>], [<a class="reference internal" href="#component-ras">ras</a>], [<a class="reference internal" href="#component-managementui">managementui</a>], [<a class="reference internal" href="#component-os">os</a>]</p>
</dd>
</dl>
</section>
<section id="mero">
<span id="component-mero"></span><h3>mero<a class="headerlink" href="#mero" title="Permalink to this headline">¶</a></h3>
<p>Mero is a distributed storage system, targeting exascale configurations. Its
main roots are Lustre file system, NFSv4 and database technology. Mero is not,
strictly speaking, a file system: an emerging consensus is that traditional file
system properties (hierarchical directory namespace, strong POSIX consistency
guarantees, etc.) are no longer desirable or achievable at exascale. Nor Mero is
an object store. Instead, Mero is a more general storage system, providing an
optional file system and object store interfaces. This allows wider range of
deployments, including cloud.</p>
<p>Mero controls a cluster consisting of nodes connected by network. Some nodes
have persistent storage attached to them. Mero makes distinction between various
types of persistent store:</p>
<blockquote>
<div><ul class="simple">
<li><p>rotational drives. They have low cost per bit, good durability, widely
available. Their drawbacks include high latency (due to rotational and
seek delays) and ever decreasing bandwidth-to-capacity ratio;</p></li>
<li><p>flash drives. They are more expensive per bit, have limited capacity per
drive, no seek latency, good throughput;</p></li>
<li><p>non-volatile memory of various types, including PCI-attached flash
devices, battery-backed memory and phase-change memory. Even more
expensive and even faster.</p></li>
</ul>
</div></blockquote>
<p>Some nodes are running applications [<a href="#id168"><span class="problematic" id="id169">`application &lt;entity.application_&gt;`_</span></a>], which are processes
external to Mero. Applications issue requests to query or manipulate cluster
state. An application can be a traditional user space application, running
standalone on a node, or a large MPI job running on multiple nodes, or a cluster
management utility monitoring the state of the system, or S3 [<a href="#id170"><span class="problematic" id="id171">`s3 &lt;entity.s3_&gt;`_</span></a>] or NFS
[<a class="reference internal" href="#entity-nfs">nfs</a>] or CIFS daemon exporting Mero to non-Mero clients.</p>
<img alt="images/mero.layers.png" src="images/mero.layers.png" />
<p>The ultimate effect of operation execution consists of updates and queries to
state on multiple nodes.</p>
<p>Remote execution requires network communication. Mero rpc layer [<a class="reference internal" href="#entity-rpc">rpc</a>]
handles certain network failures (message loss) and provides convenient
interface to send items, which are internally packed in network messages.</p>
<p>Distributed transaction manager [<a href="#id172"><span class="problematic" id="id173">`dtm &lt;entity.dtm_&gt;`_</span></a>] allows operations to be grouped into
distributed transactions, which are guaranteed to be atomic in the face of
certain failures.</p>
<p>Main novel ideas of Mero, that distinguish it from other cluster file-systems or
object stores are:</p>
<blockquote>
<div><ul class="simple">
<li><p>fdmi [<a class="reference internal" href="#entity-fdmi">fdmi</a>];</p></li>
<li><p>file operations log [<a href="#id174"><span class="problematic" id="id175">`fol &lt;entity.fol_&gt;`_</span></a>];</p></li>
<li><p>fops [<a class="reference internal" href="#entity-fop">fop</a>];</p></li>
<li><p>distributed transaction manager [<a href="#id176"><span class="problematic" id="id177">`dtm &lt;entity.dtm_&gt;`_</span></a>];</p></li>
<li><p>resource manager [<a href="#id178"><span class="problematic" id="id179">`rm &lt;entity.rm_&gt;`_</span></a>];</p></li>
<li><p>layouts [<a href="#id180"><span class="problematic" id="id181">`layout &lt;entity.layout_&gt;`_</span></a>], including parity de-clustering [<a class="reference internal" href="#entity-pdclust">pdclust</a>];</p></li>
<li><p>containers [<a href="#id182"><span class="problematic" id="id183">`container &lt;entity.container_&gt;`_</span></a>];</p></li>
<li><p>addb [<a href="#id184"><span class="problematic" id="id185">`addb &lt;entity.addb_&gt;`_</span></a>].</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id186"><span class="problematic" id="id187">`mero &lt;entity.mero_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-eos">eos</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-clovis">mero.clovis</a>], [<a class="reference internal" href="#component-mero-rpc">mero.rpc</a>], [<a class="reference internal" href="#component-mero-reqh">mero.reqh</a>],
[<a class="reference internal" href="#component-mero-be">mero.be</a>], [<a class="reference internal" href="#component-mero-stob">mero.stob</a>], [<a class="reference internal" href="#component-mero-dtm">mero.dtm</a>],
[<a class="reference internal" href="#component-mero-pdclust">mero.pdclust</a>], [<a class="reference internal" href="#component-mero-ios">mero.ios</a>], [<a class="reference internal" href="#component-mero-dix">mero.dix</a>],
[<a class="reference internal" href="#component-mero-cob">mero.cob</a>], [<a class="reference internal" href="#component-mero-cas">mero.cas</a>], [<a class="reference internal" href="#component-mero-cm">mero.cm</a>], [<a class="reference internal" href="#component-mero-conf">mero.conf</a>],
[<a class="reference internal" href="#component-mero-lib">mero.lib</a>], [<a class="reference internal" href="#component-mero-addb">mero.addb</a>], [<a class="reference internal" href="#component-mero-fol">mero.fol</a>],
[<a class="reference internal" href="#component-mero-layout">mero.layout</a>], [<a class="reference internal" href="#component-mero-pool">mero.pool</a>], [<a class="reference internal" href="#component-mero-spiel">mero.spiel</a>],
[<a class="reference internal" href="#component-mero-balloc">mero.balloc</a>], [<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>], [<a class="reference internal" href="#component-mero-lf">mero.lf</a>],
[<a class="reference internal" href="#component-mero-fid">mero.fid</a>], [<a class="reference internal" href="#component-mero-rm">mero.rm</a>], [<a class="reference internal" href="#component-mero-xcode">mero.xcode</a>], [<a class="reference internal" href="#component-mero-net">mero.net</a>]</p>
</dd>
<dt class="field-even">References</dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.google.com/document/d/1weQya-S3b9uW7whD0I1du2MoXoo90gx6w1kCFvGpavQ">Mero in prose</a></p></li>
<li><p><a class="reference external" href="https://docs.google.com/presentation/d/1VrqkzxklEXnthfsNl3GZhgGaeWl4yTW43LP87EmhzPc">Mero technical (presentation)</a></p></li>
<li><p><a class="reference external" href="https://docs.google.com/document/d/1xM7yYPjPH_AuxiN7-J54s2LANv87BvkqLtdL9bOU-7I">Mero whitepaper</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="component-s3">
<span id="id1"></span><h3>s3<a class="headerlink" href="#component-s3" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id188"><span class="problematic" id="id189">`s3 &lt;entity.s3_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-eos">eos</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="component-nfs">
<span id="id2"></span><h3>nfs<a class="headerlink" href="#component-nfs" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-nfs">nfs</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-eos">eos</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="halon">
<span id="component-halon"></span><h3>halon<a class="headerlink" href="#halon" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-halon">halon</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-eos">eos</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="provisioner">
<span id="component-provisioner"></span><h3>provisioner<a class="headerlink" href="#provisioner" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-provisioner">provisioner</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-eos">eos</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="component-ras">
<span id="id3"></span><h3>ras<a class="headerlink" href="#component-ras" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id190"><span class="problematic" id="id191">`ras &lt;entity.ras_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-eos">eos</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="management-ui">
<span id="component-managementui"></span><h3>management ui<a class="headerlink" href="#management-ui" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id192"><span class="problematic" id="id193">`managementui &lt;entity.managementui_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-eos">eos</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="os">
<span id="component-os"></span><h3>os<a class="headerlink" href="#os" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id194"><span class="problematic" id="id195">`os &lt;entity.os_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-eos">eos</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-clovis">
<span id="component-mero-clovis"></span><h3>mero.clovis<a class="headerlink" href="#mero-clovis" title="Permalink to this headline">¶</a></h3>
<p>clovis [<a class="reference internal" href="#entity-clovis">clovis</a>] is the external interface exported by mero. Clovis consists
of two main parts:</p>
<blockquote>
<div><ul class="simple">
<li><p>access interface, object IO, key-value indices and distributed
transactions and</p></li>
<li><p>fdmi interface [<a class="reference internal" href="#entity-fdmi">fdmi</a>] used to extend the core system with new
functionality.</p></li>
</ul>
</div></blockquote>
<p>Clovis is used by applications [<a href="#id196"><span class="problematic" id="id197">`application &lt;entity.application_&gt;`_</span></a>] including <em>native</em> applications
(directly using clovis) and <em>front-ends</em>, which are applications exporting
conventional interfaces such as posix, nfs, cifs, s3, etc.</p>
<p>A typical application uses clovis by linking with libmero.so shared library
[<a href="#id198"><span class="problematic" id="id199">`mero.library &lt;entity.mero.library_&gt;`_</span></a>] and using functions defined in clovis.h header file. A linux
kernel component uses clovis by loading mero kernel module.</p>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-clovis">clovis</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p><a class="reference external" href="https://docs.google.com/presentation/d/1gh3qtPK6l69VjORMWkogMCO24kGEJ4dDjIdcNGkSFtk">Clovis presentation</a></p>
</dd>
</dl>
</section>
<section id="mero-rpc">
<span id="component-mero-rpc"></span><h3>mero.rpc<a class="headerlink" href="#mero-rpc" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-rpc">rpc</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-reqh">
<span id="component-mero-reqh"></span><h3>mero.reqh<a class="headerlink" href="#mero-reqh" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id200"><span class="problematic" id="id201">`reqh &lt;entity.reqh_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-be">
<span id="component-mero-be"></span><h3>mero.be<a class="headerlink" href="#mero-be" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-be">be</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-stob">
<span id="component-mero-stob"></span><h3>mero.stob<a class="headerlink" href="#mero-stob" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-stob">stob</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-dtm">
<span id="component-mero-dtm"></span><h3>mero.dtm<a class="headerlink" href="#mero-dtm" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id202"><span class="problematic" id="id203">`dtm &lt;entity.dtm_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-pdclust">
<span id="component-mero-pdclust"></span><h3>mero.pdclust<a class="headerlink" href="#mero-pdclust" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-pdclust">pdclust</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-ios">
<span id="component-mero-ios"></span><h3>mero.ios<a class="headerlink" href="#mero-ios" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-ios">ios</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-dix">
<span id="component-mero-dix"></span><h3>mero.dix<a class="headerlink" href="#mero-dix" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id204"><span class="problematic" id="id205">`dix &lt;entity.dix_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-cob">
<span id="component-mero-cob"></span><h3>mero.cob<a class="headerlink" href="#mero-cob" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id206"><span class="problematic" id="id207">`cob &lt;entity.cob_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-cas">
<span id="component-mero-cas"></span><h3>mero.cas<a class="headerlink" href="#mero-cas" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-cas">cas</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-cm">
<span id="component-mero-cm"></span><h3>mero.cm<a class="headerlink" href="#mero-cm" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id208"><span class="problematic" id="id209">`cm &lt;entity.cm_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-conf">
<span id="component-mero-conf"></span><h3>mero.conf<a class="headerlink" href="#mero-conf" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id210"><span class="problematic" id="id211">`conf &lt;entity.conf_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-lib">
<span id="component-mero-lib"></span><h3>mero.lib<a class="headerlink" href="#mero-lib" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id212"><span class="problematic" id="id213">`lib &lt;entity.lib_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-addb">
<span id="component-mero-addb"></span><h3>mero.addb<a class="headerlink" href="#mero-addb" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id214"><span class="problematic" id="id215">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-fol">
<span id="component-mero-fol"></span><h3>mero.fol<a class="headerlink" href="#mero-fol" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id216"><span class="problematic" id="id217">`fol &lt;entity.fol_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-layout">
<span id="component-mero-layout"></span><h3>mero.layout<a class="headerlink" href="#mero-layout" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id218"><span class="problematic" id="id219">`layout &lt;entity.layout_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-pool">
<span id="component-mero-pool"></span><h3>mero.pool<a class="headerlink" href="#mero-pool" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-pool">pool</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-spiel">
<span id="component-mero-spiel"></span><h3>mero.spiel<a class="headerlink" href="#mero-spiel" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id220"><span class="problematic" id="id221">`spiel &lt;entity.spiel_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-balloc">
<span id="component-mero-balloc"></span><h3>mero.balloc<a class="headerlink" href="#mero-balloc" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-balloc">balloc</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-fdmi">
<span id="component-mero-fdmi"></span><h3>mero.fdmi<a class="headerlink" href="#mero-fdmi" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-lf">
<span id="component-mero-lf"></span><h3>mero.lf<a class="headerlink" href="#mero-lf" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id222"><span class="problematic" id="id223">`lf &lt;entity.lf_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-fid">
<span id="component-mero-fid"></span><h3>mero.fid<a class="headerlink" href="#mero-fid" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id224"><span class="problematic" id="id225">`fid &lt;entity.fid_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-rm">
<span id="component-mero-rm"></span><h3>mero.rm<a class="headerlink" href="#mero-rm" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id226"><span class="problematic" id="id227">`rm &lt;entity.rm_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-xcode">
<span id="component-mero-xcode"></span><h3>mero.xcode<a class="headerlink" href="#mero-xcode" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a href="#id228"><span class="problematic" id="id229">`xcode &lt;entity.xcode_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="mero-net">
<span id="component-mero-net"></span><h3>mero.net<a class="headerlink" href="#mero-net" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entity</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-net">net</a>]</p>
</dd>
<dt class="field-even">Parent</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
</section>
<section id="use-cases">
<h2>Use cases<a class="headerlink" href="#use-cases" title="Permalink to this headline">¶</a></h2>
<section id="product-life-cycle">
<span id="usecase-product-life-cycle"></span><h3>product.life.cycle<a class="headerlink" href="#product-life-cycle" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-6258751226fc33112e1cf75e46c5dc6c750f5cc3.png" alt="state &quot;Requirements\n from management&quot; as req
state Discussion
state &quot;Architecture specification&quot; as arch
state Planning
state Execution

Discussion: - features
Discussion: - informal requirements
Discussion: - informal usecases

arch: - formal requirements
arch: - formal usecases
arch: - components
arch: - list of options

Planning: - schedule
Planning: - list of tasks
Planning: - list of resources
Planning: - estimates

Execution: - HLD
Execution: - DLD
Execution: - coding
Execution: - dev testing
Execution: - release
Execution: - QA testing
Execution: - Patents

[*] --&gt; req

req --&gt; Discussion
Discussion --&gt; req

Discussion --&gt; arch
arch --&gt; Discussion

arch --&gt; Planning
Planning --&gt; arch

Planning --&gt; Execution
Execution --&gt; Planning"/>
</p>
</section>
<section id="development-cycle">
<span id="usecase-development-cycle"></span><h3>development.cycle<a class="headerlink" href="#development-cycle" title="Permalink to this headline">¶</a></h3>
<p>Development process of a software task goes through a number of phases,
described below.</p>
<p class="plantuml">
<img src="_images/plantuml-cb3e5167edb189ca0c5fb9e9906b71bd25940cea.png" alt="participant core
participant team
participant ci

core  -&gt; team: overview
loop learning and clarification
 core &lt;-&gt; team: q&amp;a
end
loop
 core  -&gt; team: specification
 core &lt;-&gt; team: q&amp;a
end
loop plan adjustment
 core &lt;-  team: execution plan
 core &lt;-&gt; team: discussion
end
core  -&gt; team: approval
loop dld cycle
 team  -&gt; team: dld
 team  -&gt; team: internal inspection
 core &lt;-  team: dld
 core  -&gt; core: dld inspection
 core  -&gt; team: defects
 core &lt;-&gt; team: discussion
end
core  -&gt; team: approval
core  -&gt; core: patents
loop code cycle
 loop
   core &lt;-  team: intermediate code
   core  -&gt; team: comments
 end
 loop code and ci cycle
   loop code inspection
     team  -&gt; team: ut
     team  -&gt; team: internal inspection
     core &lt;-  team: code
     core &lt;-  core: code inspection
     core  -&gt; team: defects
     core &lt;-&gt; team: discussion
   end
   core  -&gt; team: approval
   team  -&gt; ci: submit
   team &lt;-  ci: failures
   team  -&gt; team: fixes
 end
 core &lt;-  team: ci ok
 core  -&gt; core: land
end
core  -&gt; team: approved"/>
</p>
<p>Where</p>
<p><strong>core</strong> are the people responsible for specifying the software task to be done,
controlling the execution and quality. Different members of the core can be
responsible for different aspects of core activity: producing a specification,
inspecting designs and code.</p>
<dl class="simple">
<dt><strong>team</strong> are the people writing the detailed designs, code, doing the testing,</dt><dd><p>etc.</p>
</dd>
</dl>
<p><strong>ci</strong> is the continuous integration infrastructure.</p>
<p><strong>specification</strong> is a document or a set of documents describing the software
task with sufficient detail to start the development. A specification can be
either a high-level design specification [<a class="reference internal" href="#entity-hld">hld</a>] or a modification
specification [<a href="#id230"><span class="problematic" id="id231">`modification &lt;entity.modification_&gt;`_</span></a>]. An hld is used for development of a new
feature [<a href="#id232"><span class="problematic" id="id233">`feature &lt;entity.feature_&gt;`_</span></a>] or component [<a href="#id234"><span class="problematic" id="id235">`component &lt;entity.component_&gt;`_</span></a>]. A modification is used for
changing an existing component.</p>
<p><strong>execution plan</strong> [<a href="#id236"><span class="problematic" id="id237">`execution.plan &lt;entity.execution.plan_&gt;`_</span></a>] specifies the timeline of the task
execution and required resources. It includes:</p>
<blockquote>
<div><ul class="simple">
<li><p>estimation for execution phases (dld, coding, testing, etc.);</p></li>
<li><p>division of implementation into smaller sub-tasks usable for continuous
integration;</p></li>
<li><p>testing plan.</p></li>
</ul>
</div></blockquote>
<p><strong>dld</strong> [<a class="reference internal" href="#entity-dld">dld</a>]</p>
<p><strong>dld inspection</strong> [<a class="reference internal" href="#entity-dldinsp">dldinsp</a>]</p>
<p><strong>code inspection</strong> [<a class="reference internal" href="#entity-codeinsp">codeinsp</a>]</p>
<p>The sequence diagram above is simplified in certain aspects for readability. For
example, it assumes that a dld never changes as a result of coding or testing.</p>
</section>
<section id="deployment-life-cycle">
<span id="usecase-deployment-life-cycle"></span><h3>deployment.life.cycle<a class="headerlink" href="#deployment-life-cycle" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-69b5423e09824535ea80bb71f9ce53971244b15f.png" alt="state Developers
state Sales
state Manufacturing
state Shipment
state &quot;Assemble on site&quot; as assembly
state Operation
state EOL

Developers --&gt; Sales
Sales --&gt; Developers
Sales --&gt; Manufacturing
Manufacturing --&gt; Shipment
Shipment --&gt; assembly
assembly --&gt; Manufacturing
assembly --&gt; Operation
Operation --&gt; Sales
Operation --&gt; EOL"/>
</p>
</section>
<section id="durability-bitrot">
<span id="usecase-durability-bitrot"></span><h3>durability.bitrot<a class="headerlink" href="#durability-bitrot" title="Permalink to this headline">¶</a></h3>
<p>This is a case when a bit rot happens on a drive. It’s not detected by the drive
itself and there is no error code returned on attempt to read the rotten data.</p>
<p>Bit rot is detected when someone (either application or BSC service) reads the
rotten data. After it’s detected BSC service will try to
<a class="reference internal" href="#bsc-repair">repair (bsc.repair)</a> the missing piece using the SNS parity
algorithm.</p>
<p>This diagram describes how the bit rot is detected when a Clovis application
tries to read the data.</p>
<p class="plantuml">
<img src="_images/plantuml-09d43941b84dbefaf63fee3216d94766b05464b0.png" alt="participant drive
participant ioservice
participant BSC
participant Clovis
participant Application

note over drive: bit rot happens
Application -&gt; Clovis: read I/O request
Clovis -&gt; ioservice: read I/O request
ioservice -&gt; drive: read stob I/O
drive -&gt; ioservice: OK
ioservice -&gt; ioservice: check DI checksum: FAILED
ioservice -&gt; Clovis: read I/O error
note over Clovis: continue with degraded read
Clovis -&gt; Application: read I/O request data
ioservice -&gt; BSC: repair request
note over BSC: not execute the request right now
BSC -&gt; ioservice:"/>
</p>
<section id="bsc-repair">
<h4>bsc.repair<a class="headerlink" href="#bsc-repair" title="Permalink to this headline">¶</a></h4>
<p>Then BSC service handles the rotten data:</p>
<p class="plantuml">
<img src="_images/plantuml-740c71593c2d47da203841becc487b33691e9fe8.png" alt="participant drive
participant ios_node1
participant ios_node2
participant BSC

note over BSC: repair request for a unit (D or P)

note over BSC: mark the unit as BAD\n(so subsequent reads return I/O failure)
BSC -&gt; ios_node1: read a unit
BSC -&gt; ios_node2: read a unit
ios_node1 -&gt; BSC: done
note over BSC: parity calculations for available units
ios_node2 -&gt; BSC: done
note over BSC: parity calculations for the unit
note over BSC: DI check for the unit\n(compare againts the stored data)
BSC -&gt; drive: write new calculated data to the unit
drive -&gt; BSC: done
note over BSC: the repair request is done
note over drive, BSC
Error cases
1. &gt; K failures in the PG for the unit being repaired
2. Process restart when handling the repair request
3. DI mismatch (no decision yet)
4. Intermittent write I/O failure (expander reset etc.) (no decision yet).
5. Persistence of the repair request (decision: YES).
6. DI checksum for the DIX keys/values (no decision yet).
endnote"/>
</p>
<p>The rotten data can be overwritten:</p>
<p class="plantuml">
<img src="_images/plantuml-c645c6078573610b3e2f4b1ae46bd0c112bb7acc.png" alt="participant Application
participant Clovis
participant ioservice
participant stob

Application -&gt; Clovis: write I/O request for a unit
Clovis -&gt; ioservice: write I/O request for the unit
ioservice -&gt; stob: write I/O request
note over stob: move the unit to the BAD list
note over stob: do the write I/O normally
stob -&gt; ioservice: done
ioservice -&gt; Clovis: done
Clovis -&gt; Application: done"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
</section>
<section id="durability-misdirected-write">
<span id="usecase-durability-misdirected-write"></span><h3>durability.misdirected.write<a class="headerlink" href="#durability-misdirected-write" title="Permalink to this headline">¶</a></h3>
<p>This is the case when a write is misdirected to some random physical location
and the metadata maps the objects logical location to different physical location.
In this case the checksum calculated during a typical read io does not match the
one saved in the metadata.</p>
<p>Following diagram illustrates how the misdirected write are handled.</p>
<p class="plantuml">
<img src="_images/plantuml-18fffb307d46ce59587f91a5bf6d12e3a8b4defd.png" alt="participant client as C
participant ios1 as I1
participant drive1 as D1
participant ios2 as I2
participant ios3 as I3
participant bsc1 as B1
participant bsc2 as B2
participant bsc3 as B3

C -&gt; I1: write data
I1 -&gt; D1: write submit
D1 -&gt; D1: write misdirected
D1 -&gt; I1: write success
I1 -&gt; C: write success
C -&gt; I1: Read data
I1 -&gt; D1: read submit
D1 -&gt; I1: return data
I1 -&gt; I1: calculate data checksum
I1 -&gt; I1: verify calculated checksum with stored checksum
I1 -&gt; I1: checksum mismatch
I1 -&gt; B1: submit scrub request
I1 -&gt; C: return io error
C -&gt; I2: read remaining data
C -&gt; I3: read remaining data
C -&gt; C: reconstruct missing data
B1 -&gt; B2: read data
B1 -&gt; B3: read data
B1 -&gt; B1: reconstruct missing data
B1 -&gt; I1: write data and checksum to new location
I1 -&gt; D1: write data to new location
D1 -&gt; D1: write success
D1 -&gt; I1: write success
I1 -&gt; B1: write success
B1 -&gt; I1: read data and verify checksum"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="metadata-internal-bitrot">
<span id="usecase-metadata-internal-bitrot"></span><h3>metadata-internal.bitrot<a class="headerlink" href="#metadata-internal-bitrot" title="Permalink to this headline">¶</a></h3>
<p>This is the case of managing the durability of internal metadata.</p>
<p class="plantuml">
<img src="_images/plantuml-16d106e57654594dff1a3071ad826e3080397b07.png" alt="participant Halon as H
participant mdStore as MD1
participant ios1 as I1
participant ios2 as I2
participant ios3 as I3

note over MD1: bit rot happens
MD1 -&gt; H: Notify halon about md failure
H -&gt; I2: notify I1 failure
H -&gt; I3: notify I1 failure
H -&gt; I2: Start direct rebalance
H -&gt; I3: Start direct rebalance
== I1 md is restored using direct rebalance ==
I2 -&gt; H: rebalance complete
I3 -&gt; H: rebalance complete
H -&gt; I2: notify I1 online
H -&gt; I2: notify I1 online"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="clovis-multi-site-create">
<span id="usecase-clovis-multi-site-create"></span><h3>clovis.multi-site.create<a class="headerlink" href="#clovis-multi-site-create" title="Permalink to this headline">¶</a></h3>
<p>This is the case when clovis create objects on multi-site configured cluster and
target drives (dix) from some of the sites failed to write. Create operation
return with success.</p>
<p class="plantuml">
<img src="_images/plantuml-cd016ca273cb4463176afdaaaaf4742df7a5d4d1.png" alt="skinparam ArrowColor Blue
skinparam BoxPadding 10
skinparam ParticipantPadding 5

box &quot;Client&quot;
participant ClovisApp as ca
participant Clovis as cc
end box

box &quot;&lt;font color=red&gt;Site 1 (Drive Failure)&quot;
participant IOS1 as i1
participant DIX1 as d1
end box

box &quot;Site2&quot;
participant IOS2 as i2
participant DIX2 as d2
end box

ca -&gt; cc : Create Object
note over cc : Get pool version\nas per policy from\nspecified pool\notherwise scan\nall pools
cc -&gt; d1 : Create meta-data(cob)
cc -&gt; d2 : Create meta-data(cob)
note over d1 : MD drive failed
ca &lt;- cc : Create Object Return
cc &lt;-[#red]- d1 : meta-data(cob) Fail
cc &lt;- d2 : meta-data(cob)
ca &lt;- cc : Create Object executed
ca &lt;- cc : Create Object stable"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="clovis-multi-site-write">
<span id="usecase-clovis-multi-site-write"></span><h3>clovis.multi-site.write<a class="headerlink" href="#clovis-multi-site-write" title="Permalink to this headline">¶</a></h3>
<p>This is the case when clovis writes objects on multi-site configured cluster and
target drives (dix &amp; data) from some of the sites failed to write. Write operation
return with success.</p>
<p class="plantuml">
<img src="_images/plantuml-0a29d0d3be108f935ee99e2ef581c8fbfd238851.png" alt="skinparam ArrowColor Blue
skinparam BoxPadding 10
skinparam ParticipantPadding 5

box &quot;Client&quot;
participant ClovisApp as ca
participant Clovis as cc
end box

box &quot;&lt;font color=red&gt;Site 1 (Drive Failure)&quot;
participant IOS1 as i1
participant DIX1 as d1
end box

box &quot;Site2&quot;
participant IOS2 as i2
participant DIX2 as d2
end box

ca -&gt; cc : Open Object
cc -&gt; d1 : Open meta-data(cob)
cc -&gt; d2 : Open meta-data(cob)
ca &lt;- cc : Open Object Return
cc &lt;-[#red]- d1 : meta-data(cob) Fail
cc &lt;- d2 : meta-data(cob)
ca &lt;- cc : Open Object executed

ca -&gt; cc : Write Object Chunk 0
cc -&gt; i1 : Write Object Chunk
cc -&gt; i2 : Write Object Chunk
ca &lt;- cc : Write Object Chunk 0 Return
...
ca -&gt; cc : Write Object Chunk n
cc -&gt; i1 : Write Object Chunk
cc -&gt; i2 : Write Object Chunk
ca &lt;- cc : Write Object Chunk n Return
...
cc &lt;-[#red]- i1 : Object Data Chunk 0 Fail
cc &lt;- i2 : Object Data Chunk 0
...
cc &lt;-[#red]- i1 : Object Data Chunk n Fail
cc &lt;- i2 : Object Data Chunk n
ca &lt;- cc : Write Object Chunk 0 executed
...
ca &lt;- cc : Write Object Chunk n executed

ca -&gt; cc : Sync Init
cc -&gt; i1 : Sync op
cc -&gt; d1 : Sync op
cc -&gt; i2 : Sync op
cc -&gt; d2 : Sync op
ca &lt;- cc : sync Init Return
cc &lt;-[#red]- i1 : Sync op Fail
cc &lt;-[#red]- d1 : Sync op Fail
cc &lt;- i2 : Sync op Fail
cc &lt;- d2 : Sync op
ca &lt;- cc : Sync Init executed
ca &lt;- cc : Sync Init stable"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="clovis-multi-site-read">
<span id="usecase-clovis-multi-site-read"></span><h3>clovis.multi-site.read<a class="headerlink" href="#clovis-multi-site-read" title="Permalink to this headline">¶</a></h3>
<p>This is the case when clovis reads objects on multi-site configured cluster and
some of the sites are down. Read operation return with success.</p>
<p class="plantuml">
<img src="_images/plantuml-b6402cc4625bdedae76c06a0fa72375eb363eab5.png" alt="skinparam ArrowColor Blue
skinparam BoxPadding 10
skinparam ParticipantPadding 5

box &quot;Client&quot;
participant ClovisApp as ca
participant Clovis as cc
end box

box &quot;&lt;font color=red&gt;Site 1 (Failure)&quot;
participant IOS1 as i1
participant DIX1 as d1
end box

box &quot;Site2&quot;
participant IOS2 as i2
participant DIX2 as d2
end box

ca -&gt; cc : Open Object
cc -&gt; d2 : Read meta-data(cob)
ca &lt;- cc : Read Object Return
cc &lt;- d2 : meta-data(cob)
ca &lt;- cc : Open Object executed

ca -&gt; cc : Read Object Chunk 0
cc -&gt; i2 : Read Object Chunk
ca &lt;- cc : Read Object Chunk 0 Return
...
ca -&gt; cc : Read Object Chunk n
cc -&gt; i2 : Read Object Chunk
ca &lt;- cc : Read Object Chunk n Return
...
cc &lt;- i2 : Object Data Chunk 0
...
cc &lt;- i2 : Object Data Chunk n
ca &lt;- cc : Read Object Chunk 0 executed
...
ca &lt;- cc : Read Object Chunk n executed"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="clovis-multi-site-delete">
<span id="usecase-clovis-multi-site-delete"></span><h3>clovis.multi-site.delete<a class="headerlink" href="#clovis-multi-site-delete" title="Permalink to this headline">¶</a></h3>
<p>This is the case when clovis deletes objects on multi-site configured cluster and
target drives (dix &amp; data) from some of the sites failed to write. Delete
operation return with success.</p>
<p class="plantuml">
<img src="_images/plantuml-58d89889de1a2d7e77e45439109a73d00f532448.png" alt="skinparam ArrowColor Blue
skinparam BoxPadding 10
skinparam ParticipantPadding 5

box &quot;Client&quot;
participant ClovisApp as ca
participant Clovis as cc
end box

box &quot;&lt;font color=red&gt;Site 1 (Drive Failure)&quot;
participant IOS1 as i1
participant DIX1 as d1
end box

box &quot;Site2&quot;
participant IOS2 as i2
participant DIX2 as d2
end box

ca -&gt; cc : Delete Object
cc -&gt; d1 : Delete meta-data(cob)
cc -&gt; d2 : Delete meta-data(cob)
ca &lt;- cc : Delete Object Return
cc &lt;-[#red]- d1 : meta-data(cob) Fail
cc &lt;- d2 : meta-data(cob)
ca &lt;- cc : Delete Object executed
ca &lt;- cc : Delete Object stable"/>
</p>
</section>
<section id="s3-access-single-regions-multisite-replication">
<span id="usecase-s3-access-single-regions-multisite-replication"></span><h3>s3.access.single.regions.multisite.replication<a class="headerlink" href="#s3-access-single-regions-multisite-replication" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Customer should be able to deploy Single S3 region with multiple sites.</p></li>
<li><dl class="simple">
<dt>Customer should be able to define implicit replication policy (Sync or Async) for Multiple Sites (AvZ) within a Single Region.</dt><dd><p>2.1 Sync replication (1, k) (k parity and k spares required)
2.2 Async replication (1, k) (k parity and k spares required)</p>
</dd>
</dl>
</li>
<li><p>Customer should be able to deploy multiple Availability zones (multiple sites under single region).</p></li>
<li><dl class="simple">
<dt>Customer should be able to define deployments with</dt><dd><p>4.1 One Region: 1 Site where customer needs just 1 Site(AvZ) per region.
4.2 or One Region : ‘n’ Sites (Avz)</p>
</dd>
</dl>
</li>
<li><p>In multisite deployment, client application should be able to write to local site and the data should be eventually available in remote site. (Partitioning use case)</p></li>
<li><p>In multisite deployment, client application should be able to read from local site.</p></li>
<li><p>In multisite deployment, (S3/clovis) client application on failure should be able to read from remote available site.</p></li>
</ol>
<img alt="_images/s3.access.single.regions.multisite.replication.png" src="_images/s3.access.single.regions.multisite.replication.png" />
<p><a class="reference external" href="https://docs.google.com/document/d/1H4kHFApZhEfbOhd8wbmA_j6DS72BLg_sr0qTuuabAtA/edit?usp=sharing">diagram source</a></p>
<dl class="field-list simple">
<dt class="field-odd">Feasibility</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ol class="arabic">
<li><p>Sync replication is feasible if sites have minimal latency (near to local transfer)</p>
<blockquote>
<div><p>1.1 Active-Passive</p>
<p>1.2 Degraded operations on Site partition (Read only)</p>
<p>1.3 Better failover (latest data available)</p>
</div></blockquote>
</li>
<li><p>Async replication feasible for higher latency across sites</p>
<blockquote>
<div><p>2.1 Active - Active</p>
<p>2.2 Possibility of consistency issues for sites to converge</p>
</div></blockquote>
</li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="s3-access-single-regions-multisite-erasurecoding">
<span id="usecase-s3-access-single-regions-multisite-erasurecoding"></span><h3>s3.access.single.regions.multisite.erasurecoding<a class="headerlink" href="#s3-access-single-regions-multisite-erasurecoding" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Customer should be able to deploy Single S3 region with multiple sites.</p></li>
<li><dl class="simple">
<dt>Customer should be able to define erasure coding policy for Multiple Sites within a Single Region.</dt><dd><p>2.1 (n, k) (n data, k parity and k spares sites required) (total n + 2k sites)</p>
</dd>
</dl>
</li>
<li><p>In single region multisite deployment, client application should be able to perform degraded write to available sites.</p></li>
<li><p>In single region multisite deployment, client application should be able to read from available sites and tolerate ‘k’ site failures.</p></li>
</ol>
<img alt="_images/s3.access.single.regions.multisite.erasurecoding.png" src="_images/s3.access.single.regions.multisite.erasurecoding.png" />
<p><a class="reference external" href="https://docs.google.com/document/d/1H4kHFApZhEfbOhd8wbmA_j6DS72BLg_sr0qTuuabAtA/edit?usp=sharing">diagram source</a></p>
<dl class="field-list simple">
<dt class="field-odd">Feasibility</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ol class="arabic simple">
<li><p>Feasible with very low latency across sites</p></li>
<li><p>Better Availability with site failure</p></li>
<li><p>Very high cost solution due to ‘n’ sites?</p></li>
</ol>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="s3-access-multi-regions-crr-single-site">
<span id="usecase-s3-access-multi-regions-crr-single-site"></span><h3>s3.access.multi.regions.crr.single.site<a class="headerlink" href="#s3-access-multi-regions-crr-single-site" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Customer should be able to deploy Multiple S3 regions with each region having single site.</p></li>
<li><p>Customer should be able to define explicit replication policy (Async) for Multiple regions. Explicit is cross-region replication within S3-mero.</p></li>
</ol>
<img alt="_images/s3.access.multi.regions.crr.single.site.png" src="_images/s3.access.multi.regions.crr.single.site.png" />
<p><a class="reference external" href="https://docs.google.com/document/d/1H4kHFApZhEfbOhd8wbmA_j6DS72BLg_sr0qTuuabAtA/edit?usp=sharing">diagram source</a></p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="s3-access-multi-regions-crr-multisite">
<span id="usecase-s3-access-multi-regions-crr-multisite"></span><h3>s3.access.multi.regions.crr.multisite<a class="headerlink" href="#s3-access-multi-regions-crr-multisite" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li><p>Customer should be able to deploy Multiple S3 regions with each region having single site.</p></li>
<li><p>Customer should be able to define explicit replication policy (Async) for Multiple regions. Explicit is cross-region replication within S3-mero.</p></li>
</ol>
<img alt="_images/s3.access.multi.regions.crr.multisite.png" src="_images/s3.access.multi.regions.crr.multisite.png" />
<p><a class="reference external" href="https://docs.google.com/document/d/1H4kHFApZhEfbOhd8wbmA_j6DS72BLg_sr0qTuuabAtA/edit?usp=sharing">diagram source</a></p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="s3-access-regions-mixed-policies">
<span id="usecase-s3-access-regions-mixed-policies"></span><h3>s3.access.regions.mixed.policies<a class="headerlink" href="#s3-access-regions-mixed-policies" title="Permalink to this headline">¶</a></h3>
<p>Customer should be able to define custom data protection policy, example erasure coding in local site and replication across sites. [CONFIRM requirement?]. (Advantage increases probability of local access over remote, over the cost of more storage use)</p>
<img alt="_images/s3.access.regions.mixed.policies.png" src="_images/s3.access.regions.mixed.policies.png" />
<p><a class="reference external" href="https://docs.google.com/document/d/1H4kHFApZhEfbOhd8wbmA_j6DS72BLg_sr0qTuuabAtA/edit?usp=sharing">diagram source</a></p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="s3-bucket-put-tagging">
<span id="usecase-s3-bucket-put-tagging"></span><h3>s3.bucket.put.tagging<a class="headerlink" href="#s3-bucket-put-tagging" title="Permalink to this headline">¶</a></h3>
<p>Adding a set of tags to an existing bucket.</p>
<p class="plantuml">
<img src="_images/plantuml-b6b0ae4e13b32b54f2885edc5c75adde2f305633.png" alt="title PUT Bucket Tagging
' skinparam backgroundColor #red
skinparam sequenceArrowThickness 2
skinparam maxmessagesize 60
' skinparam sequenceParticipant underline
' skinparam ParticipantPadding 20
skinparam BoxPadding 10
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-Dix&quot; as E

A-&gt;B:PUT Bucket Tag
B-&gt;C:PUT Bucket Tag
C-&gt;D: Do Authentication/Authorization
C&lt;--D: 200 OK
C-&gt;E: Get Bucket keyval
E--&gt;C: Response Success
C-&gt;E: PUT KeyVal(Bucket Tag)
E--&gt;C: Response 204/Error
C--&gt;B: Response 204/Error
B--&gt;A: Response 204/Error"/>
</p>
</section>
<section id="s3-bucket-get-tagging">
<span id="usecase-s3-bucket-get-tagging"></span><h3>s3.bucket.get.tagging<a class="headerlink" href="#s3-bucket-get-tagging" title="Permalink to this headline">¶</a></h3>
<p>Return the tag set associated with the bucket.</p>
<p class="plantuml">
<img src="_images/plantuml-84f9371fa4b980edf1dbc3bf360d776d203e484d.png" alt="title GET Bucket Tagging
' skinparam backgroundColor #red
skinparam sequenceArrowThickness 2
skinparam maxmessagesize 60
' skinparam sequenceParticipant underline
' skinparam ParticipantPadding 20
skinparam BoxPadding 10
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-Dix&quot; as E

A-&gt;B:GET Bucket Tag
B-&gt;C:GET Bucket Tag
C-&gt;D: Do Authentication/Authorization
C&lt;--D: OK
C-&gt;E: Get Bucket keyval
E--&gt;C: Response Success/Error
rnote over &quot;C&quot;
Convert to XML
endrnote

C--&gt;B: Response Success/Error
B--&gt;A: Response Success/Error"/>
</p>
</section>
<section id="s3-bucket-delete-tagging">
<span id="usecase-s3-bucket-delete-tagging"></span><h3>s3.bucket.delete.tagging<a class="headerlink" href="#s3-bucket-delete-tagging" title="Permalink to this headline">¶</a></h3>
<p>Remove a tag set from the specified bucket.</p>
<p class="plantuml">
<img src="_images/plantuml-244ca867a5f5ed83c937fd79dec5c063d3fbfda3.png" alt="title DELETE Bucket Tagging
' skinparam backgroundColor #red
skinparam sequenceArrowThickness 2
skinparam maxmessagesize 60
' skinparam sequenceParticipant underline
' skinparam ParticipantPadding 20
skinparam BoxPadding 10
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-Dix&quot; as E

A-&gt;B:DELETE Bucket Tag
B-&gt;C:DELETE Bucket Tag
C-&gt;D: Do Authentication/Authorization
C&lt;--D: OK
C-&gt;E: Update/Put Bucket keyval
E--&gt;C: Response Success/Error
C--&gt;B: Response Success/Error
B--&gt;A: Response Success/Error"/>
</p>
</section>
<section id="s3-acl">
<span id="usecase-s3-acl"></span><h3>s3.acl<a class="headerlink" href="#s3-acl" title="Permalink to this headline">¶</a></h3>
<p>ACLs (access control lists) enable you to manage access to buckets and objects. Each bucket and object has an ACL attached to it as a subresource. It defines which accounts or groups are granted access and the type of access.</p>
<p>Below diagram describes how to create acl associated with an s3 bucket</p>
<p class="plantuml">
<img src="_images/plantuml-d309eec4d6aad840b6fc2bc17ed63a8c6ee6fd17.png" alt="title Bucket ACL creation in S3
participant &quot;Client&quot; as A
participant &quot;LB&quot; as B
participant &quot;S3&quot; as C
participant &quot;S3auth&quot; as D
A-&gt;B:Create Bucket
B-&gt;C:Create Bucket
C-&gt;D:Do auth
C&lt;--D:200 OK
note over C:Bucket is created with\ndefault Bucket ACL \nFULL_CONTROL to owner.
B&lt;--C:200 OK
A&lt;--B:200 OK
A-&gt;B:Create Bucket ACL
B-&gt;C:Create Bucket ACL
C-&gt;D:Do auth
C&lt;--D:200 OK
note over C:Bucket ACL updated/created.
B&lt;--C:200 OK
A&lt;--B:200 OK"/>
</p>
<p>This diagram describes acl creation associated with s3 object.</p>
<p class="plantuml">
<img src="_images/plantuml-638b40e16a207a64ae563a13184ed2be0f6b3318.png" alt="title Object ACL creation in S3
participant &quot;Client&quot; as A
participant &quot;LB&quot; as B
participant &quot;S3&quot; as C
participant &quot;S3auth&quot; as D
A-&gt;B:PUT Object ACL(Request Body)
B-&gt;C:PUT Object ACL(Request body)
C-&gt;D:Do auth
C&lt;--D:200 OK
note over C:Object ACL created/updated.
B&lt;--C:200 OK
A&lt;--B:200 OK
A-&gt;B:PUT Object (Canned ACL, Request header)
B-&gt;C:PUT Object (Canned ACL, Request header)
C-&gt;D:Do auth
C&lt;--D:200 OK
note over C:Object created with canned ACL.\n and default ACL owner FULL_CONTROL
B&lt;--C:200 OK
A&lt;--B:200 OK"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul class="simple">
<li><dl class="simple">
<dt>Resources</dt><dd><ul>
<li><p>Bucket</p></li>
<li><p>Object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Account/Users</dt><dd><ul>
<li><p>Owner</p></li>
<li><p>Grantee</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Permissions</dt><dd><ul>
<li><dl class="simple">
<dt>Object</dt><dd><ul>
<li><p>READ: Allows grantee to read object data and metadata</p></li>
<li><p>READ_ACP: Allows grantee to read object ACL</p></li>
<li><p>WRITE_ACP: Allows grantee to write object ACL</p></li>
<li><p>FULL_CONTROL: Allowd grantee the READ, READ_ACP, WRITE_ACP permissions for object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Bucket</dt><dd><ul>
<li><p>READ: Allows grantee to list objects in bucket</p></li>
<li><p>WRITE: Allows grantee to create, overwrite, and delete any objects in the bucket</p></li>
<li><p>READ_ACP: Allows grantee to read bucket ACL</p></li>
<li><p>WRITE_ACP: Allows grantee to write bucket ACL</p></li>
<li><p>FULL_CONTROL: Allowd grantee the READ, WRITE, READ_ACP, WRITE_ACP permissions on the bucket</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Components</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Features</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Tests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">History</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Known problems</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Requests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Questions</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="s3-bucketpolicy">
<span id="usecase-s3-bucketpolicy"></span><h3>s3.bucketpolicy<a class="headerlink" href="#s3-bucketpolicy" title="Permalink to this headline">¶</a></h3>
<p>A bucket policy is a resource-based Identity and Access Management (IAM) policy. Bucket policy is used to grant other accounts or IAM users access permissions for the bucket and the objects in it.</p>
<img alt="_images/s3.policy_evaluation.png" src="_images/s3.policy_evaluation.png" />
<p>Below diagram describes bucket policy creation in s3.</p>
<p class="plantuml">
<img src="_images/plantuml-3955491837bc4686b07cb8521e40a8fc9dbcd164.png" alt="title Bucket Policy creation in S3
participant &quot;Client&quot; as A
participant &quot;LB&quot; as B
participant &quot;S3&quot; as C
participant &quot;S3auth&quot; as D
A-&gt;B:PUT Bucket Policy
B-&gt;C:PUT Bucket Policy
C-&gt;D:Do auth
C&lt;--D:200 OK
note over C:Bucket Policy created/updated\n and saved with bucket metadata.
B&lt;--C:200 OK
A&lt;--B:200 OK"/>
</p>
<p>Following diagram describes how an bucket policy is evaluated in s3.</p>
<p class="plantuml">
<img src="_images/plantuml-2f8cbdccba26d9662ad2d6815f5263356275e88c.png" alt="title Policy Evaluation/Autorization in S3
participant &quot;Client&quot; as A
participant &quot;LB&quot; as B
participant &quot;S3&quot; as C
participant &quot;S3auth&quot; as D
A-&gt;B:Get Object
B-&gt;C:Get Object
C-&gt;D:Do auth
C&lt;--D:200 OK
C&lt;--C:Gather Request context
D&lt;-C:Authorize(list of policy/acl)
C&lt;--D:200 OK
B&lt;--C:200 OK
A&lt;--B:200 OK"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<ul>
<li><dl class="simple">
<dt>Resources</dt><dd><ul class="simple">
<li><p>Bucket</p></li>
<li><p>Object</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl>
<dt>Actions</dt><dd><ul class="simple">
<li><p>Permissions for Operations</p></li>
</ul>
<blockquote>
<div><ul class="simple">
<li><p>s3:AbortMultipartUpload</p></li>
<li><p>s3:DeleteObject</p></li>
<li><p>s3:DeleteObjectTagging</p></li>
<li><p>s3:DeleteObjectVersion</p></li>
<li><p>s3:DeleteObjectVersionTagging</p></li>
<li><p>s3:GetObject</p></li>
<li><p>s3:GetObjectAcl</p></li>
<li><p>s3:GetObjectTagging</p></li>
<li><p>s3:GetObjectVersion</p></li>
<li><p>s3:GetObjectVersionAcl</p></li>
<li><p>s3:GetObjectVersionTagging</p></li>
<li><p>s3:ListMultipartUploadParts</p></li>
<li><p>s3:PutObject</p></li>
<li><p>s3:PutObjectAcl</p></li>
<li><p>s3:PutObjectTagging</p></li>
<li><p>s3:PutObjectVersionAcl</p></li>
<li><p>s3:PutObjectVersionTagging</p></li>
<li><p>s3:RestoreObject</p></li>
</ul>
</div></blockquote>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Effect</dt><dd><ul class="simple">
<li><p>Allow or Deny</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Principal</dt><dd><ul class="simple">
<li><p>Account/User</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Components</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Features</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Tests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">History</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Known problems</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Requests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Questions</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="s3-iamuserpolicy">
<span id="usecase-s3-iamuserpolicy"></span><h3>s3.iamuserpolicy<a class="headerlink" href="#s3-iamuserpolicy" title="Permalink to this headline">¶</a></h3>
<p>IAM user policy specify what operations are allowed or denied on resources of service like S3. IAM user policies are attached to IAM users, groups, or roles. It defines what a user can do in a environment.
IAM policy are used for managing access to multiple services in a environment. In EOS access management is required only for S3 service, hence IAM polcy is currently not supported. All S3 service access management can by done using ACL and Bucket policy.</p>
</section>
<section id="s3-crr">
<span id="usecase-s3-crr"></span><h3>s3.crr<a class="headerlink" href="#s3-crr" title="Permalink to this headline">¶</a></h3>
<p>Cross-region replication (CRR) enables automatic, asynchronous copying of objects across buckets in different Regions. Buckets configured for cross-region replication can be owned by the same account or by different accounts.</p>
<img alt="_images/s3.crr.png" src="_images/s3.crr.png" />
<p>In case of setting s3 policies for CRR, there may be two approaches which can be
followed.</p>
<dl class="field-list simple">
<dt class="field-odd">Approach 1</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>S3server sends REST API request to remote S3server(S3server in another Region)
to get remote bucket metadata or to trigger COPY Object. This approach is secure.</p>
<dl class="field-list simple">
<dt class="field-odd">Approach 2</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>S3server uses Mero to get remote bucket metadata or to trigger COPY Object.</p>
<p>Approach 1 is recommended as it seems to be secure.</p>
</section>
<section id="s3-crr-put-policies">
<span id="usecase-s3-crr-put-policies"></span><h3>s3.crr.put.policies<a class="headerlink" href="#s3-crr-put-policies" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Approach 1</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>This is the case when we want to enable Cross Region replication(CRR), we add
a replication configuration to our source bucket, the configuration tells the
S3Server to replicate objects as specified. In the replication configuration we
provide the destination bucket and the objects we want to replicate. PUT Bucket
Policies either creates a replication policies or replaces existing one.</p>
<p>This diagram describes how the s3 CRR policy is applied to the source bucket.</p>
<p class="plantuml">
<img src="_images/plantuml-6e014180149c1c57f1c7714d43de88299ff3bb82.png" alt="skinparam BoxPadding 10
box &quot;Region1&quot;
participant &quot;S3Client1&quot;
participant &quot;Haproxy1&quot;
participant &quot;S3Server1&quot;
participant &quot;S3AuthServer1&quot;
participant &quot;Mero-IOS1&quot;
participant &quot;Mero-Dix1&quot;
end box

box &quot;Region2&quot;
participant &quot;S3Server2&quot;
participant &quot;S3AuthServer2&quot;
participant &quot;Mero-IOS2&quot;
participant &quot;Mero-Dix2&quot;
end box
== Apply PUT CRR Policy on source bucket(Bucket1)==
&quot;S3Client1&quot;-&gt;&quot;Haproxy1&quot;:PUT Replication Policy
&quot;Haproxy1&quot;-&gt;&quot;S3Server1&quot;:PUT Replication Policy
&quot;S3Server1&quot;-&gt;&quot;S3AuthServer1&quot;: Do Authentication/Authorization
&quot;S3AuthServer1&quot;--&gt;&quot;S3Server1&quot;: Response (Success)
&quot;S3Server1&quot;-&gt;&quot;Mero-Dix1&quot;:Get-KeyVal(Bucket1)
&quot;S3Server1&quot;&lt;--&quot;Mero-Dix1&quot;: Response(Success)
&quot;S3Server1&quot;-&gt;&quot;S3Server2&quot;:GetVersion by S3server
&quot;S3Server2&quot;-&gt;&quot;S3AuthServer2&quot;: Do Auth
&quot;S3AuthServer2&quot;--&gt;&quot;S3Server2&quot;: Response(Success)
&quot;S3Server1&quot;&lt;--&quot;S3Server2&quot;: Response(Success)
rnote over &quot;S3Server1&quot;
Validation:
  1) Check whether on source(Bucket1) and destination bucket(Bucket2), versioning enabled or not.
  2) Check buckets are in different region or not.
  3) Permission to replicate objects from the source to the destination bucket.
endrnote
  &quot;S3Server1&quot;-&gt;&quot;Mero-Dix1&quot;:Put-KeyVal(Bucket1)
  &quot;S3Server1&quot;&lt;--&quot;Mero-Dix1&quot;: Response(Success)
  &quot;Haproxy1&quot;&lt;--&quot;S3Server1&quot;:Response (Success)
  &quot;S3Client1&quot;&lt;--&quot;Haproxy1&quot;:Response - OK
== CRR Policy applied on Source Bucket(Bucket1) =="/>
</p>
</section>
<section id="s3-crr-put-object">
<span id="usecase-s3-crr-put-object"></span><h3>s3.crr.put.object<a class="headerlink" href="#s3-crr-put-object" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Approach 1</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>This is the case when we PUT object to the source bucket
which has CRR policy set. Async replication of the uploaded
object takes place to the remote bucket,after the object is uploaded
locally.</p>
<p>Below diagram describes how replication happens to the destination bucket
once user has already applied the replication policy to the source bucket.</p>
<p class="plantuml">
<img src="_images/plantuml-653703671f6daeb2d5dfd47e8d66b1487baa64f6.png" alt="title Cross Region Replication - PUT Object
' skinparam backgroundColor #red
skinparam sequenceArrowThickness 2
' skinparam roundcorner 20
' skinparam maxmessagesize 60
' skinparam sequenceParticipant underline
' skinparam ParticipantPadding 20
skinparam BoxPadding 10
box &quot;Region 1&quot;
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;Mero-ios&quot; as D
participant &quot;Mero-dix&quot; as E
end box

box &quot;Region 2&quot;
participant &quot;S3Server&quot; as F
participant &quot;Mero-ios&quot; as G
participant &quot;Mero-dix&quot; as H
end box
== Object creation on region1 start ==
A-&gt;B:PUT Object
activate B
B-&gt;C:PUT Object
activate C
C-&gt;E:Get-KV(B)
C&lt;--E: Response(success)
|||
C-&gt;D:Create object
C&lt;--D:Response Ok
|||
note over C, D
Write Data
end note
|||
C-&gt;E:Put-KV(O)
C&lt;--E: PUT - Kv Response(success)
|||
B&lt;--C:PUT Object Response - OK
A&lt;--B:PUT Object Response - OK
note over C, C
Check for CRR policy enabled or not.
Do below validation, if enabled.
1. Bucket versioning on Source bucket.
end note
|||
C-&gt;E:PUT source and dest object in KV for replication - Put-KV
C&lt;--E: PUT - Kv Response(success)
|||
deactivate B
== Object creation on region1 end ==
...
== Replicate object to region2 start ==
|||
C-&gt;E:GET source and dest object in KV for replication - GET-KV
C&lt;--E: GET - KV Response(success)
|||
C-&gt;F:GET Bucket(B') Metadata
C&lt;--F: Response GET Bucket(B') Metadata
note over C, C
Check for Bucket versioning on Dest. bucket
end note
|||
C-&gt;D:open object
C&lt;--D:Response Ok
|||
loop Replicate the data to Specified region Bucket
|||
C-&gt;D:read object
C&lt;--D:Response Ok
|||
C-&gt;F:PUT object
F-&gt;H:Get-KV(B')
F&lt;--H: Response(success)
|||
F-&gt;G:Create object if it doesn't exists
F&lt;--G:Response Ok
|||
note over F, G
Write Data
end note
|||
F-&gt;H:Put-KV(O)
F&lt;--H: PUT - Kv Response(success)
|||
C&lt;--F:Response Ok
|||
end
C-&gt;E:PUT-KV(O)
C&lt;--E: PUT - KV Response(success)
|||
C-&gt;E: update repilication status in source object metedata: PUT-KV
C&lt;--E: PUT - Kv Response(success)
|||
C-&gt;E:Delete source and dest object in KV for replication - Delete-KV
C&lt;--E: Delete - KV Response(success)
|||
destroy C
== Replicate object to region2 end =="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Approach 2</dt>
<dd class="field-odd"><p></p></dd>
</dl>
<p>This is the case when we PUT object to the source bucket
which has CRR policy set. Async replication of the uploaded
object takes place to the remote bucket,after the object is uploaded
locally. In this approach communication happens between local Mero(Region1) and remote
Mero(Region 2) to get the remote metadata or object replication.</p>
<p>Below diagram describes how replication happens to the destination bucket
once user has already applied the replication policy to the source bucket.</p>
<p class="plantuml">
<img src="_images/plantuml-518c3c20c47e06524f8b57c8faf171e7fce02bb9.png" alt="title Cross Region Replication - PUT Object
' skinparam backgroundColor #red
skinparam sequenceArrowThickness 2
' skinparam roundcorner 20
' skinparam maxmessagesize 60
' skinparam sequenceParticipant underline
' skinparam ParticipantPadding 20
skinparam BoxPadding 10
box &quot;Region 1&quot;
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;Mero-ios&quot; as D
participant &quot;Mero-dix&quot; as E
end box

box &quot;Region 2&quot;
participant &quot;S3Server&quot; as F
participant &quot;Mero-ios&quot; as G
participant &quot;Mero-dix&quot; as H
end box
== Object creation on region1 start ==
A-&gt;B:PUT Object
B-&gt;C:PUT Object
|||
C-&gt;E:Get bucket metadata: Get-KV(B)
C&lt;--E: Get bucket metadata: Response(success)
|||
C-&gt;D:Create object
C&lt;--D:Response - Ok
|||
loop Write data
|||
C-&gt;D: Write Data
C&lt;--D: Write Data - Response -Ok
|||
end
|||
C-&gt;E: Save object metadata: PUT - KV(O)
C&lt;--E: Save object metadata: PUT - KV Response(success)
|||
B&lt;--C:PUT Object Response - OK
A&lt;--B:PUT Object Response - OK
note over C, C
Check for CRR policy enabled or not.
Do below validation, if enabled.
1. Bucket versioning on Source bucket.
end note
|||
C-&gt;E:PUT source(B/O) and dest object(B'/O) in KV for replication - PUT-KV
C&lt;--E: PUT - KV Response(success)
|||
== Object creation on region1 end ==
...
== Replicate object to region2 start ==
|||
C-&gt;E:GET source and dest object in KV for replication - Put-KV
C&lt;--E: GET - KV Response(success)
|||
C-&gt;H:GET Bucket(B') Metadata
C&lt;--H: Response GET Bucket(B') Metadata
note over C, C
Check for Bucket versioning on Dest. bucket
end note
|||
C-&gt;D:open object
C&lt;--D:Response Ok
|||
C-&gt;D: copy object
note over D, H
Replcate object using mero
end note
C&lt;--D: copy object - Response - Ok
|||
C-&gt;E: update repilication status in source object metedata: PUT-KV
C&lt;--E: PUT - KV Response(success)
|||
C-&gt;E:Delete source and dest object in KV for replication - Delete-KV
C&lt;--E: Delete - KV Response(success)
|||
== Replicate object to region2 end =="/>
</p>
</section>
<section id="s3-crr-get-policies">
<span id="usecase-s3-crr-get-policies"></span><h3>s3.crr.get.policies<a class="headerlink" href="#s3-crr-get-policies" title="Permalink to this headline">¶</a></h3>
<p>This is the case when user wants to know what CRR policies
are set on the source bucket</p>
<p class="plantuml">
<img src="_images/plantuml-75d3cf51cd72760b4b273f57e65dff3dd69a7cee.png" alt="title Cross Region Replication - PUT Object
box &quot;Region1&quot;
participant &quot;S3Client&quot;
participant &quot;Haproxy&quot;
participant &quot;S3Server&quot;
participant &quot;S3AuthServer&quot;
participant &quot;Mero-IOS1&quot;
participant &quot;Mero-Dix1&quot;
end box


&quot;S3Client&quot;-&gt;&quot;Haproxy&quot;:GET Replication Policy
&quot;Haproxy&quot;-&gt;&quot;S3Server&quot;:GET Replication Policy
&quot;S3Server&quot;-&gt;&quot;S3AuthServer&quot;: Do Authentication/Authorization
&quot;S3AuthServer&quot;--&gt;&quot;S3Server&quot;: Response (Success)
&quot;S3Server&quot;-&gt;&quot;Mero-Dix1&quot;:Get-KeyVal(Bucket1)
&quot;S3Server&quot;&lt;--&quot;Mero-Dix1&quot;: Response(Success)
&quot;Haproxy&quot;&lt;--&quot;S3Server&quot;: Response(Success)
&quot;S3Client&quot;&lt;--&quot;Haproxy&quot;: Response(Success)"/>
</p>
</section>
<section id="s3-crr-delete-policies">
<span id="usecase-s3-crr-delete-policies"></span><h3>s3.crr.delete.policies<a class="headerlink" href="#s3-crr-delete-policies" title="Permalink to this headline">¶</a></h3>
<p>This is the case when user wants to delete the CRR policy
set to the source bucket earlier</p>
<p class="plantuml">
<img src="_images/plantuml-d5793f25a6195911aa81cd29b9cf2f5cdf572aed.png" alt="box &quot;Region1&quot;
participant &quot;S3Client&quot;
participant &quot;Haproxy&quot;
participant &quot;S3Server&quot;
participant &quot;S3AuthServer&quot;
participant &quot;Mero-IOS1&quot;
participant &quot;Mero-Dix1&quot;
end box

&quot;S3Client&quot;-&gt;&quot;Haproxy&quot;:DELETE Replication Policy
&quot;Haproxy&quot;-&gt;&quot;S3Server&quot;:DELETE Replication Policy
&quot;S3Server&quot;-&gt;&quot;S3AuthServer&quot;: Do Authentication/Authorization
&quot;S3AuthServer&quot;--&gt;&quot;S3Server&quot;: Response (Success)
&quot;S3Server&quot;-&gt;&quot;Mero-Dix1&quot;:Get-KeyVal(Bucket1)
&quot;S3Server&quot;&lt;--&quot;Mero-Dix1&quot;: Response(Success)
&quot;S3Server&quot;-&gt;&quot;Mero-Dix1&quot;:Update-KeyVal(Bucket1)
&quot;S3Server&quot;&lt;--&quot;Mero-Dix1&quot;: Response(Success)"/>
</p>
</section>
<section id="s3-versioning">
<span id="usecase-s3-versioning"></span><h3>s3.versioning<a class="headerlink" href="#s3-versioning" title="Permalink to this headline">¶</a></h3>
<p>Versioning is a means of keeping multiple variants of an object in the same bucket. You can use versioning to preserve, retrieve, and restore every version of every object stored in your S3 bucket. With versioning, you can easily recover from both unintended user actions and application failures.</p>
<section id="s3-bucket-put-versioning">
<h4>s3.bucket.put.versioning<a class="headerlink" href="#s3-bucket-put-versioning" title="Permalink to this headline">¶</a></h4>
<p>PUT operation uses the versioning subresource to set the versioning state of an existing bucket. To set the versioning state, you must be the bucket owner.</p>
<dl class="simple">
<dt>You can set the versioning state with one of the following values:</dt><dd><ul class="simple">
<li><p>Enabled:Enables versioning for the objects in the bucket. All objects added to the bucket receive a unique version ID.</p></li>
<li><p>Suspended: Disables versioning for the objects in the bucket. All objects added to the bucket receive the version ID null.</p></li>
</ul>
</dd>
</dl>
<p class="plantuml">
<img src="_images/plantuml-87087f6a67f29be170f637a89a2e567217c5f202.png" alt="title PUT Bucket versioning
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-ios&quot; as E
participant &quot;Mero-dix&quot; as F

A-&gt;B:PUT Bucket versioning
B-&gt;C:PUT Bucket versioning
C-&gt;D: Do auth
C&lt;--D: 200 OK
C-&gt;F: Get-KV(bucket)
C&lt;--F: Response - Get-KV(bucket)
note over C: Update versioning metadata
C-&gt;F: PUT-KV (bucket)
C&lt;--F: PUT KV (bucket) Response - OK
B&lt;--C: Response - 200 Ok
A&lt;--B: Response - 200 Ok"/>
</p>
</section>
<section id="s3-bucket-get-versioning">
<h4>s3.bucket.get.versioning<a class="headerlink" href="#s3-bucket-get-versioning" title="Permalink to this headline">¶</a></h4>
<p>GET operation uses the versioning subresource to return the versioning state of a bucket. To retrieve the versioning state of a bucket, you must be the bucket owner.</p>
<p class="plantuml">
<img src="_images/plantuml-8012206337290d6df49341f5ef5108f5fc46d36a.png" alt="title GET Bucket versioning
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-ios&quot; as E
participant &quot;Mero-dix&quot; as F

A-&gt;B:GET Bucket versioning
B-&gt;C:GET Bucket versioning
C-&gt;D: Do auth
C&lt;--D: 200 OK
C-&gt;F: Get-KV(bucket)
C&lt;--F: Response - Get-KV(bucket)
note over C: get bucket versioning metadata information
B&lt;--C: (Versioning info) Response - 200 Ok
A&lt;--B: (Versioning info) Response - 200 Ok"/>
</p>
</section>
<section id="s3-object-put-versioning">
<h4>s3.object.put.versioning<a class="headerlink" href="#s3-object-put-versioning" title="Permalink to this headline">¶</a></h4>
<p>If you enable versioning for a bucket, S3 automatically generates a unique version ID for the object being stored. S3 returns this ID in the response using the x-amz-version-id response header. If versioning is suspended, S3 always uses null as the version ID for the object stored.</p>
<p class="plantuml">
<img src="_images/plantuml-6defd42cc396f0ac8a9efd980730a4b3d9d4f3c3.png" alt="title PUT Object versioning
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-ios&quot; as E
participant &quot;Mero-dix&quot; as F

A-&gt;B:PUT Object
B-&gt;C:PUT Object
C-&gt;D: Do authentication
C&lt;--D: 200 OK
C-&gt;F: Get-KV(bucket)
C&lt;--F: Response - Get-KV(bucket)
note over C: Check versioning enabled or not.\n1. If enabled, generates a unique version ID\nfor the object being stored.\n2. If Disabled,  always use null as the version ID\nfor the object stored.
C-&gt;E:Create object
C&lt;--E:Responce Ok
 loop Write data
  |||
  A-&gt;B: Incoming Write Data
  B-&gt;C: Incoming Write Data
  C-&gt;E: Write Data
  C&lt;--E: Write Data - Response - Ok
  |||
  end
alt versioning == true
  C -&gt; C : generate unique VersionID
else versioning == false
  C -&gt; C : Set VersionID to null
end
C-&gt;F: Put-KV(Object Index: versionID--&gt;metadata)
C&lt;--F: Response - Put-KV(Object Index: versionID--&gt;metadata))=
C-&gt;F: Put-KV (update latest object in object list index)
C&lt;--F: Response - Put-KV (update latest object in object list index)
B&lt;--C: (Versioning info) Response - 200 Ok
A&lt;--B: (Versioning info) Response - 200 Ok"/>
</p>
</section>
<section id="s3-object-get-versioning">
<h4>s3.object.get.versioning<a class="headerlink" href="#s3-object-get-versioning" title="Permalink to this headline">¶</a></h4>
<p>By default, the GET operation returns the current version of an object. To return a different version, use the versionId subresource.</p>
<p class="plantuml">
<img src="_images/plantuml-84d12f1cf7b79a017621f8d84d2307f308435eb5.png" alt="title Get Object of specific version
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-ios&quot; as E
participant &quot;Mero-dix&quot; as F

A-&gt;B:Get Object of specific version
B-&gt;C:Get Object of specific version
C-&gt;D: Do authentication
C&lt;--D: 200 OK
C-&gt;F: Get-KV(bucket)
C&lt;--F: Response - Get-KV(bucket)
C-&gt;F: Get-KV(object metadata)
C&lt;--F: Response - Get-KV(object metadata)
alt given versioniID == avialable
    loop read data
    |||
    C-&gt;E: Read Data
    C&lt;--E: Read Data - Response - Ok
    B&lt;--C: send Data
    A&lt;--B: send Data
    |||
    end
    B&lt;--C: Response - 200 Ok
    A&lt;--B: Response - 200 Ok
else given versioniID != avialable
 B&lt;--C: (NoSuchObject with given verison) Response - 404 Not Found
 A&lt;--B: (NoSuchObject with given verison) Response - 404 Not Found
end"/>
</p>
</section>
<section id="s3-object-delete-versioning">
<h4>s3.object.delete.versioning<a class="headerlink" href="#s3-object-delete-versioning" title="Permalink to this headline">¶</a></h4>
<p>The DELETE operation removes the null version (if there is one) of an object and inserts a delete marker, which becomes the current version of the object. If there isn’t a null version, S3 does not remove any objects.</p>
<p>To remove a specific version permanently, you must be the bucket owner and you must use the versionId subresource.</p>
<p class="plantuml">
<img src="_images/plantuml-26b86fc2526048e06d3df15e368147517f51194c.png" alt="title DELETE Object
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-ios&quot; as E
participant &quot;Mero-dix&quot; as F

A-&gt;B:DELETE Object
B-&gt;C:DELETE Object
C-&gt;D: Do authentication
C&lt;--D: 200 OK
C-&gt;F: Get-KV(bucket)
C&lt;--F: Response - Get-KV(bucket)
C-&gt;F: Get-KV(object metadata)
C&lt;--F: Response Ok- Get-KV(object metadata)
alt versioning == true
  C -&gt; C : generate unique VersionID
  note over C: Insert delete marker with newly generated VersionID
  C-&gt;F: Put-KV(Object Index: versionID--&gt;metadata)
  C&lt;--F: Response - Put-KV(Object Index: versionID--&gt;metadata))
else versioning == false (currently is suspended, but previously enabled)
  C -&gt; C : Set VersionID to null
  note over C:  Removes the null version (if there is one) of an object\n and inserts a delete marker.
  C-&gt;F: Put-KV(Object Index: versionID--&gt;metadata)
  C&lt;--F: Response - Put-KV(Object Index: versionID--&gt;metadata))
else versioning == false (Never enabled)
  note over C: Delete the object
  C-&gt;E: Delete the object
  C-&gt;E: Responce - OK
  C-&gt;F: Delete-KV(remove meatdata)
  C-&gt;F: Responce - OK
end
B&lt;--C: Response - 200 Ok
A&lt;--B: Response - 200 Ok"/>
</p>
</section>
</section>
<section id="s3-throttling">
<span id="usecase-s3-throttling"></span><h3>s3.throttling<a class="headerlink" href="#s3-throttling" title="Permalink to this headline">¶</a></h3>
<p>Throttling is a process that is used to control the usage of GET/PUT object APIs by accounts during a given period.</p>
<p class="plantuml">
<img src="_images/plantuml-44180ee0d1422c5801271e47da9970dd409d25c3.png" alt="title Throttling
skinparam sequenceArrowThickness 2
skinparam BoxPadding 10
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero&quot; as E

A-&gt;B:PUT/GET Object request
B-&gt;C:PUT/GET Object request
C-&gt;D: Check authentication
C&lt;--D: 200 OK
note over C,C: Get account details
C --&gt; C : Check Account throttling
alt !throttle
  C -&gt; E : Process request
  C &lt;-- E : Response - OK
  B &lt;-- C : Response - OK
  A &lt;-- B : Response - OK
else throttle
  B &lt;-- C : Response - SlowDown
  A &lt;-- B : Response - SlowDown
end"/>
</p>
</section>
<section id="s3-copy-object">
<span id="usecase-s3-copy-object"></span><h3>s3.copy.object<a class="headerlink" href="#s3-copy-object" title="Permalink to this headline">¶</a></h3>
<p>The copy operation creates a copy of an object that is already stored in Mero. One can create
a copy of the object upto some size (To be defined) in a single atomic operation. For copying an object that
is greater than some size (To be defined), one must use multipart upload API. Below are the some of the uses
of copy operation.</p>
<blockquote>
<div><ul class="simple">
<li><p>Create additional copies of objects</p></li>
<li><p>Rename objects by copying them and deleting original ones</p></li>
<li><p>Change object metadata</p></li>
</ul>
</div></blockquote>
<p class="plantuml">
<img src="_images/plantuml-009a2aa6cee81886ed0ef39396343a72667efa19.png" alt="title Copy Object in single atomic operation
skinparam sequenceArrowThickness 2
skinparam BoxPadding 10
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-ios&quot; as E
participant &quot;Mero-dix&quot; as F

note over A, B: PUT /destinationObject HTTP/1.1\nHost: destinationBucket.s3.amazonaws.com\nx-amz-copy-source: /source_bucket/sourceObject
A-&gt;B:PUT Object - Copy
B-&gt;C:PUT Object - Copy
C-&gt;D: Do auth
C&lt;--D: 200 OK
C-&gt;F: Get-KV(source_bucket)
C&lt;--F: Response - Get-KV(source_bucket)
C-&gt;F: Get-KV(sourceObject)
C&lt;--F: Response - Get-KV(sourceObject)
C-&gt;F: Get-KV(destinationbucket)
C&lt;--F: Response - Get-KV(destinationbucket)
note over C: validations:\n1. READ access to the source object\n2. WRITE access to the destination bucket
C-&gt;E: Copy_Object (source_object_oid, destination_object_oid)
C&lt;--E: Response - Copy_Object
C-&gt;F: PUT-KV (destination_bucket/destination_object)
C&lt;--F: PUT KV Response - OK
B&lt;--C: Response - 201 Ok
A&lt;--B: Response - 201 Ok"/>
</p>
</section>
<section id="s3-copy-part">
<span id="usecase-s3-copy-part"></span><h3>s3.copy.part<a class="headerlink" href="#s3-copy-part" title="Permalink to this headline">¶</a></h3>
<p>For copying an existing object one may use the Upload Part (Copy) API and specify the source object by adding
the x-amz-copy-source request header in the request. First we initiate multipart upload, in response we
get upload id. Then upload a part by copying data from an existing object as data source.</p>
<p class="plantuml">
<img src="_images/plantuml-9ab8a38f0e6006823fd9a4a659e900c18e20930a.png" alt="title Copy part (Multipart)
skinparam sequenceArrowThickness 2
skinparam BoxPadding 10
participant &quot;S3Client&quot; as A
participant &quot;HAproxy&quot; as B
participant &quot;S3Server&quot; as C
participant &quot;S3Auth&quot; as D
participant &quot;Mero-ios&quot; as E
participant &quot;Mero-dix&quot; as F

A-&gt;B:Initiate Multipart Upload
B-&gt;C:Initiate multipart Upload
C-&gt;D: Do auth
C&lt;--D: 200 OK
C-&gt;F: Get-KV(source_bucket)
C&lt;--F: Response - Get-KV(source_bucket)
C-&gt;F: Get-KV(sourceObject)
C&lt;--F: Response - Get-KV(sourceObject)
C-&gt;F: Get-KV(destinationbucket)
C&lt;--F: Response - Get-KV(destinationbucket)
note over C: Check for write permission on destination bucket
C-&gt;E: Create destination Object (oid2)
E--&gt;C: Response OK
C-&gt;B: Upload ID
B-&gt;A: Upload ID
loop as many parts, first part copy request will be of part 1
A-&gt;B: Part Copy (byte range/entire source)
note over A: PUT /ObjectName?partNumber=PartNumber&amp;uploadId=UploadId HTTP/1.1\nHost: BucketName.s3.seagate.com\nx-amz-copy-source: /source_bucket/sourceObject\n x-amz-copy-source-range:bytes=first-last
B-&gt;C: Part Copy (byte range/entire source)
C-&gt;D: Do Authentication/Authorization
C-&gt;E: Get-KV (source object OID oid1)
E--&gt;C: Response ok
C-&gt;E: Get-KV target object
E--&gt;C: Response Ok
note over C: 1. Check read permission on source object and write permission on target object\n2. Compute offset based on part number
C-&gt;E: Copy_Object(oid1, oid2, offset, bytes-size)
C&lt;--E: Response - Copy_Object
C-&gt;F: PUT-KV (destination_bucket/destination_part details)
C&lt;--F: PUT KV Response - OK
B&lt;--C: Response - 200 Ok
A&lt;--B: Response - 200 Ok
end
A-&gt;B: Complete Multipart Upload
B-&gt;C: Complete Multipart Upload
note over C: Do part validation
alt part validation successful case
C-&gt;E: Remove part and multipart metadata
E--&gt;C: Response OK
C-&gt;F: PUT-KV(destination_bucket/destination_object)
F--&gt;C: Response OK
C--&gt;B: Response OK
B--&gt;A: Response OK
else some kind of failure
C-&gt;E: Do cleanup -- delete oid2, multipart metadata, part metadata
E--&gt;C: Response OK
C--&gt;B: Error message
B--&gt;A: Error message
end"/>
</p>
</section>
<section id="s3-hybridcloud-replication">
<span id="usecase-s3-hybridcloud-replication"></span><h3>s3.hybridcloud.replication<a class="headerlink" href="#s3-hybridcloud-replication" title="Permalink to this headline">¶</a></h3>
<p>Customer should be able to define explicit replication policy (Async) for external cloud as target (ex. AWS). Explicit is Bucket level replication to external cloud.</p>
<img alt="_images/s3.hybridcloud.replication.png" src="_images/s3.hybridcloud.replication.png" />
<p><a class="reference external" href="https://docs.google.com/document/d/1H4kHFApZhEfbOhd8wbmA_j6DS72BLg_sr0qTuuabAtA/edit?usp=sharing">diagram source</a></p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="s3-hybridcloud-tiering">
<span id="usecase-s3-hybridcloud-tiering"></span><h3>s3.hybridcloud.tiering<a class="headerlink" href="#s3-hybridcloud-tiering" title="Permalink to this headline">¶</a></h3>
<p>Customer should be able to restore from bucket replicated to external cloud in case Object is lost from local S3-mero cluster. Should this be left to application??</p>
<img alt="_images/s3.hybridcloud.tiering.png" src="_images/s3.hybridcloud.tiering.png" />
<p><a class="reference external" href="https://docs.google.com/document/d/1H4kHFApZhEfbOhd8wbmA_j6DS72BLg_sr0qTuuabAtA/edit?usp=sharing">diagram source</a></p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="s3-sse-s3-managedkeys">
<span id="usecase-s3-sse-s3managedkeys"></span><h3>s3.sse.s3.managedkeys<a class="headerlink" href="#s3-sse-s3-managedkeys" title="Permalink to this headline">¶</a></h3>
<p>S3 client application should be able to enable server side encryption for each object.
S3 PUT api provides a mechanism to specify that the uploaded object should be stored
on disk in encrypted form with “<strong>S3 managed keys</strong>”.</p>
<p class="plantuml">
<img src="_images/plantuml-511b05d88dcd4365d545a79201e09147cda438ea.png" alt="skinparam SequenceMessageAlign center
skinparam sequenceArrowThickness 2

title __**&quot;Server Side Encryption&quot;**__
participant &quot;S3 client&quot; as s3c
participant &quot;LB&quot; as lb
box &quot;__S3 process__&quot; #WhiteSmoke
participant &quot;S3Server&quot; as s3server
participant &quot;clovis&quot; as clovis
end box

participant &quot;KMS&quot; as kms

box &quot;__SSU__&quot; #WhiteSmoke
participant &quot;Mero-ios&quot; as ios
participant &quot;Drives&quot; as drive
participant &quot;Mero-KVS&quot; as dix
end box

== Upload object with SSE (encryption in S3) start ==
s3c-&gt;lb:PUT Object
lb-&gt;s3server:PUT Object
|||

s3server-&gt;clovis:get_kv(bucket)
clovis-&gt;dix:get_kv(bucket)
clovis&lt;--dix: Response(success)
s3server&lt;--clovis: Response(success)
|||

s3server-&gt;clovis:get_kv(object)
clovis-&gt;dix:get_kv(object)
clovis&lt;--dix: Response(success)
s3server&lt;--clovis: Response(success)
|||

s3server-&gt;kms:get_key(key_id)
note over kms: key_id can be &quot;bucket/objectname&quot; or object_fid
s3server&lt;--kms:Response(success, enc_key)
|||

s3server -&gt; s3server: encrypt(unit_size, enc_key)
|||

s3server-&gt;clovis:write(encrypted_data_chunk)
clovis-&gt;ios:write(encrypted_data_chunk)
s3server-&gt;clovis:write(encrypted_data_chunk)
clovis-&gt;ios:write(encrypted_data_chunk)
ios-&gt;drive:write(encrypted_data_chunk)
ios-&gt;drive:write(encrypted_data_chunk)
ios-&gt;clovis:write_success
clovis-&gt;s3server:write_success
ios-&gt;clovis:write_success
clovis-&gt;s3server:write_success
|||

s3server-&gt;clovis:put_kv(object_metadata)
clovis-&gt;dix:put_kv(object_metadata)
dix&lt;--clovis:put_kv_response(success)
s3server&lt;--clovis:put_kv_response(success)
|||

s3server-&gt;lb:PUT Object (success)
lb-&gt;s3c:PUT Object (success)

== Upload object with SSE (encryption in S3) end ==
...
== Upload object with SSE (encryption in mero) start ==
s3c-&gt;lb:PUT Object
lb-&gt;s3server:PUT Object
|||

s3server-&gt;clovis:get_kv(bucket)
clovis-&gt;dix:get_kv(bucket)
clovis&lt;--dix: Response(success)
s3server&lt;--clovis: Response(success)
|||

s3server-&gt;clovis:get_kv(object)
clovis-&gt;dix:get_kv(object)
clovis&lt;--dix: Response(success)
s3server&lt;--clovis: Response(success)
|||

s3server-&gt;kms:get_key(key_id)
note over kms: key_id can be object_fid
s3server&lt;--kms:Response(success, enc_key)
|||

s3server-&gt;ios:write(data_chunk, enc_key)
ios-&gt;ios :encrypt(unit_size, enc_key)
ios-&gt;drive :write(encrypted_data_chunk)
s3server-&gt;ios:write(data_chunk)
ios-&gt;ios :encrypt(unit_size, enc_key)
ios-&gt;drive :write(encrypted_data_chunk)
ios-&gt;s3server:write_success
ios-&gt;s3server:write_success
|||

s3server-&gt;clovis:put_kv(object_metadata)
clovis-&gt;dix:put_kv(object_metadata)

clovis&lt;-dix:put_kv_response(success)
s3server&lt;-clovis:put_kv_response(success)
|||

s3server-&gt;lb:PUT Object (success)
lb-&gt;s3c:PUT Object (success)
== Upload object with SSE (encryption in mero) end =="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="s3-sse-user-managedkeys">
<span id="usecase-s3-sse-user-managedkeys"></span><h3>s3.sse.user.managedkeys<a class="headerlink" href="#s3-sse-user-managedkeys" title="Permalink to this headline">¶</a></h3>
<p>S3 client application should be able to enable server side encryption for each object.
S3 PUT api provides a mechanism to specify that the uploaded object should be stored
on disk in encrypted form using “<strong>keys provided by user</strong>”.</p>
<p class="plantuml">
<img src="_images/plantuml-ddbeefbde5566ea8226b6f8c80c74baa8e37aa9a.png" alt="skinparam SequenceMessageAlign center
skinparam sequenceArrowThickness 2

title __**&quot;Server Side Encryption&quot;**__
participant &quot;S3 client&quot; as s3c
participant &quot;LB&quot; as lb
box &quot;__S3 process__&quot; #WhiteSmoke
participant &quot;S3Server&quot; as s3server
participant &quot;clovis&quot; as clovis
end box

box &quot;__SSU__&quot; #WhiteSmoke
participant &quot;Mero-ios&quot; as ios
participant &quot;Drives&quot; as drive
participant &quot;Mero-KVS&quot; as dix
end box


== Upload object with SSE (encryption in S3) start ==
s3c-&gt;lb:PUT Object (x-amz-server-side​-encryption​-customer-key)
lb-&gt;s3server:PUT Object (x-amz-server-side​-encryption​-customer-key)
|||

s3server-&gt;clovis:get_kv(bucket)
clovis-&gt;dix:get_kv(bucket)
clovis&lt;--dix: Response(success)
s3server&lt;--clovis: Response(success)
|||

s3server-&gt;clovis:get_kv(object)
clovis-&gt;dix:get_kv(object)
clovis&lt;--dix: Response(success)
s3server&lt;--clovis: Response(success)
|||

s3server -&gt; s3server: encrypt(unit_size, enc_key)
note over s3server
    enc_key = user provided key from
    (x-amz-server-side​-encryption​-customer-key)
end note
|||

s3server-&gt;clovis:write(encrypted_data_chunk)
clovis-&gt;ios:write(encrypted_data_chunk)
s3server-&gt;clovis:write(encrypted_data_chunk)
clovis-&gt;ios:write(encrypted_data_chunk)
ios-&gt;drive:write(encrypted_data_chunk)
ios-&gt;drive:write(encrypted_data_chunk)
ios-&gt;clovis:write_success
clovis-&gt;s3server:write_success
ios-&gt;clovis:write_success
clovis-&gt;s3server:write_success
|||

s3server-&gt;clovis:put_kv(object_metadata)
clovis-&gt;dix:put_kv(object_metadata)
dix&lt;--clovis:put_kv_response(success)
s3server&lt;--clovis:put_kv_response(success)
|||

s3server-&gt;lb:PUT Object (success)
lb-&gt;s3c:PUT Object (success)

== Upload object with SSE (encryption in S3) end ==
...
== Upload object with SSE (encryption in mero) start ==
s3c-&gt;lb:PUT Object
lb-&gt;s3server:PUT Object
|||

s3server-&gt;clovis:get_kv(bucket)
clovis-&gt;dix:get_kv(bucket)
clovis&lt;--dix: Response(success)
s3server&lt;--clovis: Response(success)
|||

s3server-&gt;clovis:get_kv(object)
clovis-&gt;dix:get_kv(object)
clovis&lt;--dix: Response(success)
s3server&lt;--clovis: Response(success)
|||

note over s3server: enc_key = (x-amz-server-side​-encryption​-customer-key)
s3server-&gt;ios:write(data_chunk, enc_key)
note over ios
    enc_key = user provided key from
    (x-amz-server-side​-encryption​-customer-key)
end note
ios-&gt;ios :encrypt(unit_size, enc_key)

ios-&gt;drive :write(encrypted_data_chunk)
s3server-&gt;ios:write(data_chunk, enc_key)
ios-&gt;ios :encrypt(unit_size, enc_key)
ios-&gt;drive :write(encrypted_data_chunk)
ios-&gt;s3server:write_success
ios-&gt;s3server:write_success
|||

s3server-&gt;clovis:put_kv(object_metadata)
clovis-&gt;dix:put_kv(object_metadata)

clovis&lt;-dix:put_kv_response(success)
s3server&lt;-clovis:put_kv_response(success)
|||

s3server-&gt;lb:PUT Object (success)
lb-&gt;s3c:PUT Object (success)
== Upload object with SSE (encryption in mero) end =="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="dix-kv-usage">
<span id="usecase-dix-kv-usage"></span><h3>dix.kv_usage<a class="headerlink" href="#dix-kv-usage" title="Permalink to this headline">¶</a></h3>
<blockquote>
<div><p>Key-value pairs can be inserted into mero KVS using the clovis
interface, which uses dix client to distribute this meta-data across
catalogue (CAS) services.</p>
</div></blockquote>
<p class="plantuml">
<img src="_images/plantuml-ea5fc1dba4ec9a4e01a2cfc23e86a99e4226bdfd.png" alt="participant clovis
participant cas1
participant cas2
participant cas3
participant cas4
participant halond

clovis -&gt; cas1 : put_kv()
clovis -&gt; cas2 : put_kv()
clovis -&gt; cas3 : put_kv()
clovis &lt;- cas1 : success
clovis &lt;- cas2 : success
clovis &lt;- cas3 : success
note over clovis : return success to user
clovis -&gt; cas1 : get_kv() from first online CAS
clovis &lt;- cas1 : success
note over clovis :return KV to user
clovis -&gt; cas1 : del_kv()
clovis -&gt; cas2 : del_kv()
clovis -&gt; cas3 : del_kv()
clovis &lt;- cas1 : success
clovis &lt;- cas2 : success
clovis &lt;- cas3 : success
note over clovis : return success to user"/>
</p>
</section>
<section id="dix-delete">
<span id="usecase-dix-delete"></span><h3>dix.delete<a class="headerlink" href="#dix-delete" title="Permalink to this headline">¶</a></h3>
<p>In case of transient or permanent failures of one of the CAS services
we support get(), put() and del() cases and requests from them are
going onto online CASes.</p>
<p class="plantuml">
<img src="_images/plantuml-6c905a0d6379715ded4d1f1e03e15ffe98e01c1f.png" alt="participant clovis
participant cas1
participant cas2
participant cas3
participant cas4
participant halond


note over cas2: FAILED|OFFLINE
clovis -&gt; cas1 : del_kv(id1)
clovis -&gt; cas3 : del_kv(id1)
clovis &lt;- cas1 : success
clovis &lt;- cas3 : success

note over clovis: return success to user

... cas2 is restarted ...

halond -&gt; cas2: Rebalancing
note over cas2: REBALANCE

halond -&gt; cas1: direct_rebalance()
halond -&gt; cas2: direct_rebalance()
halond -&gt; cas3: direct_rebalance()
halond -&gt; cas4: direct_rebalance()
clovis -&gt; cas1: del_kv(id1)
clovis -&gt; cas2: del_kv(id1)
clovis -&gt; cas4: del_kv(id1)
clovis &lt;- cas1: success
clovis &lt;- cas2: success/failure
clovis &lt;- cas4: success
halond &lt;- cas1: direct_rebalance_comp()
halond &lt;- cas2: direct_rebalance_comp()
halond &lt;- cas3: direct_rebalance_comp()
halond &lt;- cas4: direct_rebalance_comp()
halond -&gt; cas2: Online

note over cas2: ONLINE"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="dix-direct-rebalance">
<span id="usecase-dix-direct-rebalance"></span><h3>dix.direct_rebalance<a class="headerlink" href="#dix-direct-rebalance" title="Permalink to this headline">¶</a></h3>
<p>This usecase assumes that CAS2 is permanetly failed and needs full
data restoration. During this process, dix.get(), put(), del()
operation continue to be handled on DIX and CAS side, untill more that
K CAS failures happen. In case of transient CAS failure DTM0 (which
has to be defined) has to orchestrate the process of redo-log replay
by means of creating distributed transaction.</p>
<p class="plantuml">
<img src="_images/plantuml-4b8c59f0a227a880b747bbfdc2248f262f9ddeb4.png" alt="participant clovis
participant cas1
participant cas2
participant cas3
participant cas4
participant halond

note over cas2 : FAILED
clovis -&gt; cas1 : put_kv(id1)
clovis -&gt; cas3 : put_kv(id1)
clovis &lt;- cas1 : success
clovis &lt;- cas3 : success
note over clovis : return success to user
... cas2 is restarted ...
halond -&gt; cas2 : Rebalancing
note over cas2 : REBALANCE \n (Start without any meta-data)
halond -&gt; cas1 : direct_rebalance()
halond -&gt; cas2 : direct_rebalance()
halond -&gt; cas3 : direct_rebalance()
halond -&gt; cas4 : direct_rebalance()
clovis -&gt; cas1 : put_kv(id2)
clovis -&gt; cas2 : put_kv(id2)
clovis -&gt; cas4 : put_kv(id2)
clovis &lt;- cas1 : success
clovis &lt;- cas2 : success
clovis &lt;- cas4 : success
halond &lt;- cas1 : direct_rebalance_comp()
halond &lt;- cas2 : direct_rebalance_comp()
halond &lt;- cas3 : direct_rebalance_comp()
halond &lt;- cas4 : direct_rebalance_comp()
halond -&gt; cas2 : Online
note over cas2 : ONLINE"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="dix-mdraid">
<span id="usecase-dix-mdraid"></span><h3>dix.mdraid<a class="headerlink" href="#dix-mdraid" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-938487c4d290c4ea56c4f3d5eef9f8549538e607.png" alt="participant Admin
participant RC
participant SSPL
participant Provisioner
participant CAS_1&#64;node_1
participant CAS_2&#64;node_2
participant CAS_N&#64;node_N

note over Admin, &quot;CAS_N&#64;node_N&quot;
Assumptions:
- hardware configuration
 - node
   - 82 x data drives
   - 2  x metadata drives in mirror RAID1
end note

ref over &quot;CAS_1&#64;node_1&quot; : I/O error for metadata drive
CAS_1&#64;node_1 -&gt; CAS_1&#64;node_1: CAS service crashes
RC -&gt; RC: detects keepalive timeout for CAS1

RC -&gt; SSPL: SMART check for two drives in the RAID1
SSPL -&gt; RC: SMART check failed for both drives

RC -&gt; Admin: notify that two metadata disks failed and have to be replaced
ref over RC : wait while two metadata disks are replaced

Admin -&gt; RC: notify that two metadata disks for CAS_1 are replaced

RC -&gt; Provisioner: reassamble RAID1, make partitions, enable swap, mkfs.ext4, mount /var/mero
Provisioner -&gt; RC: done

RC -&gt; CAS_1&#64;node_1: start m0mkfs
CAS_1&#64;node_1 -&gt; RC: m0mkfs done

RC -&gt; CAS_1&#64;node_1: start m0d
CAS_1&#64;node_1 -&gt; RC: m0d started

RC -&gt; CAS_1&#64;node_1: m0_spiel_dix_direct_rebalance_start()
RC -&gt; CAS_2&#64;node_2: m0_spiel_dix_direct_rebalance_start()
RC -&gt; CAS_N&#64;node_N: m0_spiel_dix_direct_rebalance_start()

RC -&gt; CAS_1&#64;node_1: m0_spiel_dix_direct_rebalance_status()
RC -&gt; CAS_2&#64;node_2: m0_spiel_dix_direct_rebalance_status()
RC -&gt; CAS_N&#64;node_N: m0_spiel_dix_direct_rebalance_status()

CAS_1&#64;node_1 -&gt; RC: DIX direct rebalance DONE
CAS_2&#64;node_2 -&gt; RC: DIX direct rebalance DONE
CAS_N&#64;node_N -&gt; RC: DIX direct rebalance DONE"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balance-capacity">
<span id="usecase-scaleout-balance-capacity"></span><h3>scaleout.balance.capacity<a class="headerlink" href="#scaleout-balance-capacity" title="Permalink to this headline">¶</a></h3>
<p>On addition of some new storage space, Halon, based on certain policy, triggers storage balance
operation in the pools. The idea is to balance the capacity across overall cluster.</p>
<p>Following sequnce diagram depicts a typical success scenario,</p>
<p class="plantuml">
<img src="_images/plantuml-c3c61f29d6e0c1406ab4a95dc190848180b1cb81.png" alt="participant ha as H
participant rm as R
box #LightBlue
    participant dix_1 as D1
    participant ios_1 as I1
end box
box #LightBlue
    participant dix_2 as D2
    participant ios_2 as I2
end box
box #LightBlue
    participant dix_3 as D3
    participant ios_3 as I3
end box
box #LightBlue
    participant dix_4 as D4
    participant ios_4 as I4
end box
note over H
    P = 4, K = 2
    for DIX
end note
== Repeatation ==
H  -&gt; I2: Elect a co-ordinator
I2 -&gt; H: Send ACK
==  ios: Iterate over gfids  ==
I2 -&gt; D2: Request next gob fid
D2 -&gt; I2: Send the gob fid if present.
I2 -&gt; R : Request lock for gob fid.
R -&gt; I2 : Grant the lock if available.
I2 -&gt; I2: Prepare layout
I2 -&gt; I1: Request obj data, inhibit older cob version.
I2 -&gt; I3: Request obj data, inhibit older cob version.
I2 -&gt; I2: Fetch obj data , inhibit older cob version.
I2 -&gt; I1: Write newer cob version and data.
I2 -&gt; I3: Write newer cob version and data.
I2 -&gt; I4: Write newer cob version and data.
I2 -&gt; D1: Update meta-data
I2 -&gt; D3: Update meta-data
I2 -&gt; D4: Update meta-data
I2 -&gt; I2: Delete older cob version.
I2 -&gt; I3: Delete older cob version.
I2 -&gt; I1: Delete older cob version.
I2 -&gt; R: Relinquish the lock.
== Convey completion to HA ==
I2 -&gt; H: Completed local gfid collection.
== HA: Stop if P - K successinve co-ordinates are done or balancing condition met ==="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balcap-read-drive-fail">
<span id="usecase-scaleout-balcap-read-drive-fail"></span><h3>scaleout.balcap.read.drive.fail<a class="headerlink" href="#scaleout-balcap-read-drive-fail" title="Permalink to this headline">¶</a></h3>
<p>This case illustrates how the drive failure is handled by the balance capacity
service during a read.</p>
<p class="plantuml">
<img src="_images/plantuml-583c0646e2e9c76e571b3c2675dbf853b21bf57e.png" alt="participant ha as H
participant rm as R
box #LightBlue
    participant dix_1 as D1
    participant ios_1 as I1
end box
box #LightBlue
    participant dix_2 as D2
    participant ios_2 as I2
end box
box #LightBlue
    participant dix_3 as D3
    participant ios_3 as I3
end box
box #LightBlue
    participant dix_4 as D4
    participant ios_4 as I4
end box
box #LightBlue
    participant dix_5 as D5
    participant ios_5 as I5
end box
note over H
    P = 4, K = 2
     for DIX
end note
== Repeatation ==
H  -&gt; I2: Elect a co-ordinator
I2 -&gt; H: Send ACK
==  ios: Iterate over gfids  ==
I2 -&gt; D2: Request next gob fid
D2 -&gt; I2: Send the gob fid if present.
I2 -&gt; R : Request lock for gob fid.
R -&gt; I2 : Grant the lock if available.
I2 -&gt; I2: Prepare layout
I2 -&gt; I1: Request obj data, inhibit older cob version.
I1 -&gt; I2: Data send
I2 -&gt; I3: Request obj data, inhibit older cob version.
activate I3 #Red
I3 -&gt; I3: Read data failure
I3 -&gt; I2: Read failure
deactivate I3 #Red
I3 -&gt; H : Notify failure to halon
I2 -&gt; I2: Re-construct missing I3 data
I2 -&gt; I2: Fetch obj data , inhibit older cob version.
I2 -&gt; I1: Write newer cob version and data.
I1 -&gt; I2: Write success
I2 -&gt; I3: Write newer cob version and data.
I3 -&gt; I2: Write success
I2 -&gt; I4: Write newer cob version and data.
I4 -&gt; I2: Write success
I2 -&gt; D1: Update meta-data
D1 -&gt; I2: Update success
I2 -&gt; D5: Update meta-data
D5 -&gt; I2: update success
I2 -&gt; D4: Update meta-data
D4 -&gt; I2: Update success
I2 -&gt; I2: Delete older cob version.
I2 -&gt; I1: Delete older cob version.
I2 -&gt; R: Relinquish the lock.
== Convey completion to HA ==
I2 -&gt; H: Completed local gfid collection.
== HA: Stop if P - K successinve co-ordinates are done or balancing condition met ==="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balcap-read-ios-fail">
<span id="usecase-scaleout-balcap-read-ios-fail"></span><h3>scaleout.balcap.read.ios.fail<a class="headerlink" href="#scaleout-balcap-read-ios-fail" title="Permalink to this headline">¶</a></h3>
<p>This case illustrates how a node failure is handled during a read io in balance capacity
operation.</p>
<p class="plantuml">
<img src="_images/plantuml-18394f742aa1dc8a9c0a791802637ff5de54b05b.png" alt="participant ha as H
participant rm as R
box #LightBlue
    participant dix_1 as D1
    participant ios_1 as I1
end box
box #LightBlue
    participant dix_2 as D2
    participant ios_2 as I2
end box
box #LightBlue
    participant dix_3 as D3
    participant ios_3 as I3
end box
box #LightBlue
    participant dix_4 as D4
    participant ios_4 as I4
end box
box #LightBlue
    participant dix_5 as D5
    participant ios_5 as I5
end box
note over H
    P = 4, K = 2
     for DIX
end note
== Repeatation ==
H  -&gt; I2: Elect a co-ordinator
I2 -&gt; H: Send ACK
==  ios: Iterate over gfids  ==
I2 -&gt; D2: Request next gob fid
D2 -&gt; I2: Send the gob fid if present.
I2 -&gt; R : Request lock for gob fid.
R -&gt; I2 : Grant the lock if available.
I2 -&gt; I2: Prepare layout
I2 -&gt; I1: Request obj data, inhibit older cob version.
I1 -&gt; I2: Data send
I2 -&gt; I3: Request obj data, inhibit older cob version.
destroy I3
I2 -&gt; I2: I3 request timeout
I2 -&gt; I2: Re-construct missing I3 data
I2 -&gt; I2: Fetch obj data , inhibit older cob version.
I2 -&gt; I1: Write newer cob version and data.
I1 -&gt; I2: Write success
I2 -&gt; I5: Write newer cob version and data to spare.
I5 -&gt; I2: Write success
I2 -&gt; I4: Write newer cob version and data.
I4 -&gt; I2: Write success
I2 -&gt; D1: Update meta-data
D1 -&gt; I2: Update success
I2 -&gt; D5: Update meta-data
D5 -&gt; I2: update success
I2 -&gt; D4: Update meta-data
D4 -&gt; I2: Update success
I2 -&gt; I2: Delete older cob version.
I2 -&gt; I1: Delete older cob version.
I2 -&gt; R: Relinquish the lock.
== Convey completion to HA ==
I2 -&gt; H: Completed local gfid collection.
== HA: Stop if P - K successinve co-ordinates are done or balancing condition met ==="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balcap-write-drive-fail">
<span id="usecase-scaleout-balcap-write-drive-fail"></span><h3>scaleout.balcap.write.drive.fail<a class="headerlink" href="#scaleout-balcap-write-drive-fail" title="Permalink to this headline">¶</a></h3>
<p>This case illustrates how a drive failure is handled during a write io in the balance
capacity operation.</p>
<p class="plantuml">
<img src="_images/plantuml-be38cc837fde579abc12694e232993e47dcdd9cd.png" alt="participant ha as H
participant rm as R
box #LightBlue
    participant dix_1 as D1
    participant ios_1 as I1
end box
box #LightBlue
    participant dix_2 as D2
    participant ios_2 as I2
end box
box #LightBlue
    participant dix_3 as D3
    participant ios_3 as I3
end box
box #LightBlue
    participant dix_4 as D4
    participant ios_4 as I4
end box
box #LightBlue
    participant dix_5 as D5
    participant ios_5 as I5
end box
note over H
    P = 4, K = 2
     for DIX
end note
== Repeatation ==
H  -&gt; I2: Elect a co-ordinator
I2 -&gt; H: Send ACK
==  ios: Iterate over gfids  ==
I2 -&gt; D2: Request next gob fid
D2 -&gt; I2: Send the gob fid if present.
I2 -&gt; R : Request lock for gob fid.
R -&gt; I2 : Grant the lock if available.
I2 -&gt; I2: Prepare layout
I2 -&gt; I1: Request obj data, inhibit older cob version.
I1 -&gt; I2: Data send
I2 -&gt; I3: Request obj data, inhibit older cob version.
I3 -&gt; I2: Data send
I2 -&gt; I2: Fetch obj data , inhibit older cob version.
I2 -&gt; I1: Write newer cob version and data.
I1 -&gt; I2: Write success
activate I3 #Red
I2 -&gt; I3: Write newer cob version and data.
I3 -&gt; I2: Write failure
deactivate I3
I3 -&gt; H:  Notify halon of drive failure
I2 -&gt; I5: Write newer cob version and data to spare.
I5 -&gt; I2: Write success
I2 -&gt; I4: Write newer cob version and data.
I4 -&gt; I2: Write success
I2 -&gt; D1: Update meta-data
D1 -&gt; I2: Update success
I2 -&gt; D3: Update meta-data
D3 -&gt; I2: update success
I2 -&gt; D4: Update meta-data
D4 -&gt; I2: Update success
I2 -&gt; I2: Delete older cob version.
I2 -&gt; I3: Delete older cob version.
I2 -&gt; I1: Delete older cob version.
I2 -&gt; R: Relinquish the lock.
== Convey completion to HA ==
I2 -&gt; H: Completed local gfid collection.
== HA: Stop if P - K successinve co-ordinates are done or balancing condition met ==="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balcap-write-ios-fail">
<span id="usecase-scaleout-balcap-write-ios-fail"></span><h3>scaleout.balcap.write.ios.fail<a class="headerlink" href="#scaleout-balcap-write-ios-fail" title="Permalink to this headline">¶</a></h3>
<p>This case illustrates how a node failure is handled during a write io in balance capacity
operation.</p>
<p class="plantuml">
<img src="_images/plantuml-fdefc027f927cc57e0e51a770e81a9127111212f.png" alt="participant ha as H
participant rm as R
box #LightBlue
    participant dix_1 as D1
    participant ios_1 as I1
end box
box #LightBlue
    participant dix_2 as D2
    participant ios_2 as I2
end box
box #LightBlue
    participant dix_3 as D3
    participant ios_3 as I3
end box
box #LightBlue
    participant dix_4 as D4
    participant ios_4 as I4
end box
box #LightBlue
    participant dix_5 as D5
    participant ios_5 as I5
end box
note over H
    P = 4, K = 2
     for DIX
end note
== Repeatation ==
H  -&gt; I2: Elect a co-ordinator
I2 -&gt; H: Send ACK
==  ios: Iterate over gfids  ==
I2 -&gt; D2: Request next gob fid
D2 -&gt; I2: Send the gob fid if present.
I2 -&gt; R : Request lock for gob fid.
R -&gt; I2 : Grant the lock if available.
I2 -&gt; I2: Prepare layout
I2 -&gt; I1: Request obj data, inhibit older cob version.
I1 -&gt; I2: Data send
I2 -&gt; I3: Request obj data, inhibit older cob version.
I3 -&gt; I2: Data send
I2 -&gt; I2: Fetch obj data , inhibit older cob version.
I2 -&gt; I1: Write newer cob version and data.
I1 -&gt; I2: Write success
destroy I3
I2 -&gt; I3: Write newer cob version and data.
I2 -&gt; I2: Write timeout
H -&gt; I1: Notify I3 failure
H -&gt; I2: Notify I3 failure
H -&gt; I4: Notify I3 failure
H -&gt; I5: Notify I3 failure
I2 -&gt; I5: Write newer cob version and data to spare.
I5 -&gt; I2: Write success
I2 -&gt; I4: Write newer cob version and data.
I4 -&gt; I2: Write success
I2 -&gt; D1: Update meta-data
D1 -&gt; I2: Update success
I2 -&gt; D5: Update meta-data
D5 -&gt; I2: update success
I2 -&gt; D4: Update meta-data
D4 -&gt; I2: Update success
I2 -&gt; I2: Delete older cob version.
I2 -&gt; I1: Delete older cob version.
I2 -&gt; R: Relinquish the lock.
== Convey completion to HA ==
I2 -&gt; H: Completed local gfid collection.
== HA: Stop if P - K successinve co-ordinates are done or balancing condition met ==="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balcap-write-drive-restore">
<span id="usecase-scaleout-balcap-write-drive-restore"></span><h3>scaleout.balcap.write.drive.restore<a class="headerlink" href="#scaleout-balcap-write-drive-restore" title="Permalink to this headline">¶</a></h3>
<p>This case illustrates how the data is restored to its original location after a failed
drive is restored.</p>
<p class="plantuml">
<img src="_images/plantuml-19fe1d7d5590b6c5b4f74774c80552a10ba4bd91.png" alt="participant ha as H
participant rm as R
box #LightBlue
    participant dix_1 as D1
    participant ios_1 as I1
end box
box #LightBlue
    participant dix_2 as D2
    participant ios_2 as I2
end box
box #LightBlue
    participant dix_3 as D3
    participant ios_3 as I3
end box
box #LightBlue
    participant dix_4 as D4
    participant ios_4 as I4
end box
box #LightBlue
    participant dix_5 as D5
    participant ios_5 as I5
end box
note over H
    P = 4, K = 2
     for DIX
end note
== Restoring from I3 drive failure. Data was written on spare at I5. ==
== meta data was updated successfully on respective dix nodes. ==
I2 -&gt; D1: Update meta-data
D1 -&gt; I2: Update success
I2 -&gt; D3: Update meta-data
D3 -&gt; I2: update success
I2 -&gt; D4: Update meta-data
D4 -&gt; I2: Update success
I2 -&gt; I2: Delete older cob version.
I2 -&gt; I3: Delete older cob version.
I2 -&gt; I1: Delete older cob version.
I2 -&gt; R: Relinquish the lock.
== Balancing completed ==
H -&gt; I1: Notify drive online
H -&gt; I2: Notify drive online
H -&gt; I3: Notify drive online
H -&gt; I4: Notify drive online
H -&gt; I5: Notify drive online
H -&gt; I1: Start drive rebalance
H -&gt; I2: Start drive rebalance
H -&gt; I3: Start drive rebalance
H -&gt; I4: Start drive rebalance
H -&gt; I5: Start drive rebalance
== all the sns rebalance services participate in drive rebalance ==
I5 -&gt; D5: fetch updated layout
I5 -&gt; I3: move data to appropriate location as per balance
== rebalance complete ==
I1 -&gt; H: notify rebalance complete
I2 -&gt; H: notify rebalance complete
I3 -&gt; H: notify rebalance complete
I4 -&gt; H: notify rebalance complete
I5 -&gt; H: notify rebalance complete"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balcap-write-ios-restore">
<span id="usecase-scaleout-balcap-write-ios-restore"></span><h3>scaleout.balcap.write.ios.restore<a class="headerlink" href="#scaleout-balcap-write-ios-restore" title="Permalink to this headline">¶</a></h3>
<p>This balance capacity case describes how a data is written to its original
location when a failed node is active again.</p>
<p class="plantuml">
<img src="_images/plantuml-6998fc448f2d458daa96f801f0212e34c360f22b.png" alt="participant ha as H
participant rm as R
box #LightBlue
    participant dix_1 as D1
    participant ios_1 as I1
end box
box #LightBlue
    participant dix_2 as D2
    participant ios_2 as I2
end box
box #LightBlue
    participant dix_3 as D3
    participant ios_3 as I3
end box
box #LightBlue
    participant dix_4 as D4
    participant ios_4 as I4
end box
box #LightBlue
    participant dix_5 as D5
    participant dtm_5 as DTM5
    participant ios_5 as I5
end box
note over H
    P = 4, K = 2
     for DIX
end note
== Restoring from I3 failure. Data and meta-data was written on spare at I5. ==
I2 -&gt; D1: Update meta-data
D1 -&gt; I2: Update success
I2 -&gt; D5: Update meta-data
D5 -&gt; I2: update success
I2 -&gt; D4: Update meta-data
D4 -&gt; I2: Update success
I2 -&gt; I2: Delete older cob version.
I2 -&gt; I1: Delete older cob version.
I2 -&gt; R: Relinquish the lock.
== Balancing completed using spare ==
H -&gt; I1: Notify ios online
H -&gt; I2: Notify ios online
H -&gt; I4: Notify ios online
H -&gt; I5: Notify ios online
DTM5 -&gt; I2: redo operation
I2 -&gt; I3: Write newer cob version and data
I3 -&gt; I2: Write success
== DTM0 redo complete =="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balance-capacity-coordinator-fail">
<span id="usecase-scaleout-balance-capacity-coordinator-fail"></span><h3>scaleout.balance.capacity.coordinator.fail<a class="headerlink" href="#scaleout-balance-capacity-coordinator-fail" title="Permalink to this headline">¶</a></h3>
<p>This case describes the handling of coordinator failure.</p>
<p class="plantuml">
<img src="_images/plantuml-0aa920bf567397f2997311da74ae4012fd77c3e2.png" alt="participant ha as H
participant rm as R
box #LightBlue
    participant dix_1 as D1
    participant ios_1 as I1
end box
box #LightBlue
    participant dix_2 as D2
    participant ios_2 as I2
end box
box #LightBlue
    participant dix_3 as D3
    participant ios_3 as I3
end box
box #LightBlue
    participant dix_4 as D4
    participant ios_4 as I4
end box
box #LightBlue
    participant dix_5 as D5
    participant ios_5 as I5
end box
note over H
    P = 4, K = 2
     for DIX
end note
== Repeatation ==
H  -&gt; I2: Elect a co-ordinator
I2 -&gt; H: Send ACK
==  ios: Iterate over gfids  ==
I2 -&gt; D2: Request next gob fid
D2 -&gt; I2: Send the gob fid if present.
I2 -&gt; R : Request lock for gob fid.
R -&gt; I2 : Grant the lock if available.
I2 -&gt; I2: Prepare layout
I2 -&gt; I1: Request obj data, inhibit older cob version.
I1 -&gt; I2: Data send
I2 -&gt; I3: Request obj data, inhibit older cob version.
I3 -&gt; I2: Data send
I2 -&gt; I2: Fetch obj data , inhibit older cob version.
I2 -&gt; I1: Write newer cob version and data.
I1 -&gt; I2: Write success
destroy I2
H -&gt; I1: coordonator failure
H -&gt; I3: coordonator failure
H -&gt; I4: coordonator failure
H -&gt; I5: coordonator failure
H -&gt; I1: Elect new coordinator
== I1 continues the balance operation ==
I1 -&gt; I3: Write newer cob version and data.
I3 -&gt; I1: Write success
I1 -&gt; I4: Write newer cob version and data.
I4 -&gt; I1: Write success
I1 -&gt; I5: Write newer cob version and data.
I5 -&gt; I1: Write success
I1 -&gt; R: Relinquish the lock.
== Convey completion to HA =="/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balance-capacity-mdupdate-fail">
<span id="usecase-scaleout-balance-capacity-mdupdate-fail"></span><h3>scaleout.balance.capacity.mdupdate.fail<a class="headerlink" href="#scaleout-balance-capacity-mdupdate-fail" title="Permalink to this headline">¶</a></h3>
<p>This case describes the case where meta-data update on one of the
io services failed due to transient failure of the coordinator.</p>
<p class="plantuml">
<img src="_images/plantuml-568632266371df666380bc155284363172d94b08.png" alt="participant client as C
participant ha as H
participant rm as R
participant dtm0
box #LightBlue
    participant dix_1 as D1
    participant ios_1 as I1
end box
box #LightBlue
    participant dix_2 as D2
    participant ios_2 as I2
end box
box #LightBlue
    participant dix_3 as D3
    participant ios_3 as I3
end box
box #LightBlue
    participant dix_4 as D4
    participant ios_4 as I4
end box
box #LightBlue
    participant dix_5 as D5
    participant ios_5 as I5
end box
note over H
    P = 4, K = 2
     for DIX
end note
== Repeatation ==
H  -&gt; I2: Elect a co-ordinator
I2 -&gt; H: Send ACK
==  ios: Iterate over gfids  ==
I2 -&gt; D2: Request next gob fid
D2 -&gt; I2: Send the gob fid if present.
I2 -&gt; R : Request a group lock for gob fid.
R -&gt; I2 : Grant the lock if available.
I2 -&gt; I2: Prepare layout
I2 -&gt; I1: Request obj data, inhibit older cob version.
I1 -&gt; I2: Data send
I2 -&gt; I3: Request obj data, inhibit older cob version.
I3 -&gt; I2: Data send
I2 -&gt; I2: Fetch obj data, inhibit older cob version.
I2 -&gt; I1: Write newer cob version and data.
I1 -&gt; I2: Write success
I2 -&gt; I3: Write newer cob version and data.
I3 -&gt; I2: Write success
I2 -&gt; I4: Write newer cob version ad data.
I4 -&gt; I2: Write success
I2 -&gt; I1: update meta-data
I2 -&gt; I4: update meta-data
== I2 fails transiently ==
destroy I2
H -&gt; I1 : notify transient failure of I2
H -&gt; I3 : notify transient failure of I2
H -&gt; I4 : notify trnasient failure of I2
H -&gt; dtm0 : notify transient failure of I2
== meta-data update to I3 couldn't happen ==
== I2, I1, I4 are holding distributed group file locks ==
== I2 comes back up ==
C -&gt; R : try to acquire file lock for read, can possibly read old meta-data on I2
C -&gt; C : Wait for lock
dtm0 -&gt; I2 : redo operation
I2 -&gt; I3 : update meta-data
I2 -&gt; R: Relinquish the lock.
I1 -&gt; R: Relinquish the lock.
I3 -&gt; R: Relinquish the lock.
I4 -&gt; R: Relinquish the lock.
== Convey completion to HA ==
R -&gt; C : file lock granted
C -&gt; I2 : Read new meta-data and data"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-poolmod">
<span id="usecase-scaleout-poolmod"></span><h3>scaleout.poolmod<a class="headerlink" href="#scaleout-poolmod" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-283ec72b44e6e46bc0706f8aa0bb94117bea3276.png" alt="title Pool addition

participant admin
participant halonctl as hctl
participant &quot;Halon RC&quot; as RC
collections IOS as ios
collections confd
participant &quot;Principal RM&quot; as rm

note over RC
    &#64;pre HWmod (hardware addition) happened earlier
    &#64;pre svcmod/procmod ?
end note
admin -&gt; hctl: hctl mero pool add \\\n-f pool.yaml
hctl -&gt; hctl: parse pool.yaml\n(&quot;mini-facts&quot;)

hctl -&gt; RC: PoolAdd
RC -&gt; RC: add Pool\nto the RG

group &lt;font color=red&gt;XXX FIXME: SNS should auto-quiesce\n&lt;font color=red&gt;when conf R lock is revoked
RC -&gt; ios: m0_spiel_repreb_quiesce()
RC &lt;-- ios: ok
end group

RC -&gt; RC: alloc spiel_tx;\nm0_spiel_X_add;\nvalidate confc;\nhash(tx_to_str())

== rconfc, phase 1 ==

RC -&gt; confd: conf_load_fop
confd -&gt; confd: store xcoded conf\nin RAM
RC &lt;-- confd: ok
RC -&gt; rm: borrow conf W\n(request exclusive lock)
rm -&gt; ios: revoke conf R
ios -&gt; ios: .rconfc_expire_cb\n(drains confc)
ios -&gt; rm: return conf R
ios -&gt; ios: restart rconfc
ios -&gt; rm: borrow conf R\n(request)

rm -&gt; confd: revoke conf R
rm &lt;- confd: return conf R
rm &lt;- confd: borrow conf R

RC &lt;- rm: grant (sub-let)\nconf W lock

== rconfc, phase 2 ==

RC -&gt; confd: conf_flip
confd -&gt; confd: write new conf.xc;\nrestart rconfc
RC &lt;-- confd: flipped
RC -&gt; RM: give up (cancel)\nconf W lock"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p>mandar, vvv</p>
</dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="scaleout-balance-io">
<span id="usecase-be-paged-read"></span><h3>scaleout.balance.io<a class="headerlink" href="#scaleout-balance-io" title="Permalink to this headline">¶</a></h3>
<p>On addition of some new storage devices, Mero client creates new objects on less occupied pools.
Mero define pool selection policy which return less occupied pool (with respect to storage/
io_requests) for new objects. The idea is to balance the io request across overall cluster.</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="be-paged-read">
<h3>be.paged.read<a class="headerlink" href="#be-paged-read" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-d61a496969a0f3db9b89afa4c07618c907701fb8.png" alt="participant ReqH
control User_FOM
participant PageD
control PageD_FOM

ReqH -&gt; User_FOM : tick()
User_FOM -&gt; PageD : reg_get(reg, op)
PageD --&gt; User_FOM : // page is in
PageD -&gt; PageD : pages[] = reg_to_pages(reg)
PageD -&gt; PageD : PD.address_space.page_is_in(pages)?
PageD -&gt; PageD : PD.request_queue.push(request(READ, pages[], op)
PageD -&gt; PageD : m0_fom_wait_on(fom, op)
PageD -&gt; PageD : M0_CO_YIELD()
PageD --&gt; User_FOM : return control
User_FOM --&gt; ReqH : return to ReqH, process next FOM

note over ReqH, PageD_FOM
Wait until PageD_FOM to wakeup and process pushed request
end note

ref over PageD_FOM : IDLE
PageD_FOM -&gt; PageD_FOM : request = PD.request_queue.pop()
ref over PageD_FOM : READ
PageD_FOM -&gt; PageD_FOM : mmap(request.pages[i].addr, request.pages[i].size)
PageD_FOM -&gt; PageD_FOM : mlock(request.pages[i].addr, request.pages[i].size)
PageD_FOM -&gt; PageD_FOM : stob_io_fill(io, request.pages[i].offset, request.pages[i].size)
PageD_FOM -&gt; PageD_FOM : m0_fom_wait_on(fom, io-&gt;chan)
PageD_FOM -&gt; PageD_FOM : stob_io_launch(io)
ref over PageD_FOM : READ_DONE
PageD_FOM -&gt; PageD_FOM : m0_be_op_done(request.op)
ref over PageD_FOM : IDLE

note over ReqH, PageD_FOM
PageD_FOM processed given request, wait untill notification to arrive inside corresponding User_FOM
end note

ReqH -&gt; ReqH : wakeup FOM waiting on request.op
ReqH -&gt; User_FOM : tick()
User_FOM -&gt; User_FOM : M0_CO_REENTER()
User_FOM -&gt; User_FOM : restore control over line after M0_CO_YIELD()"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="be-paged-write">
<span id="usecase-be-paged-write"></span><h3>be.paged.write<a class="headerlink" href="#be-paged-write" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-59a0c08d69218a53a2adf56549047fa66539b9bd.png" alt="participant ReqH
control TxGrp_FOM
participant PageD
control PageD_FOM

ReqH -&gt; TxGrp_FOM : tx_group_fom_tick()
ref over TxGrp_FOM : TGS_PLACING
TxGrp_FOM -&gt; TxGrp_FOM : copy gr.tg_reg_area.regs data into corresponding cellar pages
TxGrp_FOM -&gt; TxGrp_FOM : pages[] = dirty_cellar_pages()
TxGrp_FOM -&gt; TxGrp_FOM : PD.request_queue.push(request(WRITE, pages[], op))
TxGrp_FOM -&gt; TxGrp_FOM : m0_be_op_tick_ret(op, fom, TGS_PLACED)

note over ReqH, PageD_FOM
Wait until PageD_FOM to wakeup and process pushed request
end note

ref over PageD_FOM : IDLE
PageD_FOM -&gt; PageD_FOM : request = PD.request_queue.pop()
ref over PageD_FOM : WRITE
PageD_FOM -&gt; PageD_FOM : stob_io_fill(io, request.pages[i].offset, request.pages[i].size)
PageD_FOM -&gt; PageD_FOM : m0_fom_wait_on(fom, io-&gt;chan)
PageD_FOM -&gt; PageD_FOM : stob_io_launch(io)
ref over PageD_FOM : WRITE_DONE
PageD_FOM -&gt; PageD_FOM : m0_be_op_done(request.op)
ref over PageD_FOM : IDLE

note over ReqH, PageD_FOM
PageD_FOM processed given request, wait until notification to arrive inside corresponding TxGrp_FOM
end note

ReqH -&gt; ReqH : wakeup FOM waiting on request.op in the next (TGS_PLACED) state
ref over TxGrp_FOM : TGS_PLACED
ReqH -&gt; TxGrp_FOM : tx_group_fom_tick()"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-handle-pods-vdisk">
<span id="usecase-ras-fault-handle-pods-vdisk"></span><h3>ras.fault.handle.pods.vdisk<a class="headerlink" href="#ras-fault-handle-pods-vdisk" title="Permalink to this headline">¶</a></h3>
<p>PODS exposes virtual disks over erasure coded physical disks to survive one or more disk failures. MERO will use these virtual disks, as the underlying device, for both metadata and data. When one or more disks fail, PODS automatically handles those internally, by performing repairs. However as more number of disks starts to fail, PODS reduces to the vdisk capacity to compensate initially, or may even fail the vdisk.</p>
<p>SSPL integrated with PODS and subscribes to the events. In case of failure
events, SSPL detects and reports the same on the RabbitMQ channel. Halon
and Dashboard retrieve this informaion from RabbitMQ. Dashboard displays
an alert to user, while Halon records it and initiates repair process.</p>
<p>When administrator configures new vdisk and adds it to the pool, Halon
initiates rebalance. Once rebalance completes, Halon notifies SSPL
which in turn sends notification to Dashboard to clear the alert.</p>
<p class="plantuml">
<img src="_images/plantuml-55bca029ca4c1ed4db1fb6207f2ae5792c93f827.png" alt="participant PODS
participant Systemd
participant SSPL
participant RabbitMQ
participant Dashboard
participant Halon
participant Mero

SSPL -&gt; PODS: Subscribe for Events
Halon -&gt; RabbitMQ: Subscribe for Events
Dashboard -&gt; SSPL: Subscribe for Events
note over PODS: vDisk failed
PODS -&gt; SSPL: vDisk failed Event
SSPL -&gt; RabbitMQ: Disk Fail Message
SSPL -&gt; Dashboard: OS Disk Failure Message
note over Dashboard: Display Disk Failure Alert
RabbitMQ -&gt; Halon: Disk Fail Message
note over Systemd: Disk Failure Detected
Systemd -&gt; SSPL: Disk Failure Event
SSPL -&gt; RabbitMQ: OS Disk Failure Message
RabbitMQ -&gt; Halon: OS Disk Failure Message
note over Halon: Mark Disk Transient

Halon -&gt; Mero: Initiate Repair
Mero -&gt; Halon: Data Recovered to other vdisks
note over Halon: Mark Disk Repaired

note over PODS: new vDisk Created
PODS -&gt; SSPL: vDisk Created Event
SSPL -&gt; RabbitMQ: New Disk Install Message
RabbitMQ -&gt; Halon: New Disk Install Message
note over Halon: New Disk Noted
Halon -&gt; Mero: Start Rebalance
note over Mero: Rebalance
Mero -&gt; Halon: Rebalance Completed
Halon -&gt; SSPL: New Disk Configured
SSPL -&gt; RabbitMQ: New Disk Configured
SSPL -&gt; Dashboard: New Disk Configured
note over Dashboard: Clear Disk Failure Alert"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p>ujjwal, vvv</p>
</dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-handle-pods-fru">
<span id="usecase-ras-fault-handle-pods-fru"></span><h3>ras.fault.handle.pods.fru<a class="headerlink" href="#ras-fault-handle-pods-fru" title="Permalink to this headline">¶</a></h3>
<p>PODS FRUs like Fans, Power Supplies, Sideplane SAS expanders, disk drives, etc,
failure and rectification events are received by SSPL. SSPL observes PODS FRU
state change events and publishes the same on RabbitMQ channel and also records
them onto the syslog. Dashboard publishes failure alerts to notify administrators.
Administrators, with the help of Seagate support, can initiate the FRU replacement
process. As soon as a new component is added, SSPL receives a notification from PODS
and the same will be forwarded to Halon for a relevant action if applicable.</p>
<p class="plantuml">
<img src="_images/plantuml-cffb8b894b69ec4c33012b37d9fae1ca8720db70.png" alt="participant PODS
participant SSPL
participant Syslog
participant RabbitMQ
participant Dashboard
participant Halon

SSPL -&gt; PODS: Subscribe for Events
Dashboard -&gt; SSPL : Subscribe for Events
Halon -&gt; RabbitMQ: Subscribe for Events
note over PODS: FRU(FAN) failed
PODS -&gt; SSPL: FRU(FAN) failed Event
SSPL -&gt; RabbitMQ: FRU(FAN) Fail Event
SSPL -&gt; Syslog: FRU(FAN) Action Alert
SSPL -&gt; Dashboard: FRU(FAN) Fail Event
note over Dashboard: Display Action Alert
RabbitMQ -&gt; Halon: FRU(FAN) Fail Event
note over Halon: Record Degraded State

note over PODS: New FRU(FAN) installed
PODS -&gt; SSPL: New FRU:FAN  Event
SSPL -&gt; RabbitMQ: New FRU(FAN)  Event
SSPL -&gt; Dashboard: New FRU(FAN) Event
note over Dashboard: Clear Alert
RabbitMQ -&gt; Halon: New FRU(FAN) Event
note over Halon: Clear Degraded State"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-handle-pods-raid">
<span id="usecase-ras-fault-handle-pods-raid"></span><h3>ras.fault.handle.pods.raid<a class="headerlink" href="#ras-fault-handle-pods-raid" title="Permalink to this headline">¶</a></h3>
<p>SSPL subscribes for events from PODS. SSPL publishes change in raid disk state
onto the RabbitMQ channel. Dashboard and Halon receives this alert. After new
disk installation in PODS, SSPL is informed about the same. SSPL sends this
to Dashboard and Halon via rabbitMQ. Halon reacts and sends actuator request
to add this new disk to Raid array. SSPL processes the request and sends
relevant actuator response to Halon.</p>
<p class="plantuml">
<img src="_images/plantuml-462e3cae5ec61682b0508438c0af82e8617e7030.png" alt="participant PODS
participant SSPL
participant RabbitMQ
participant Halon
participant Dashboard

SSPL -&gt; PODS: Subscribe for Events
Halon -&gt; RabbitMQ: Subscribe for Events
Dashboard -&gt; SSPL: Subscribe for Events.
note over PODS: Raid disk failed
PODS -&gt; SSPL: Raid disk failed Event
SSPL -&gt; RabbitMQ: Raid disk Fail Event
RabbitMQ -&gt; Halon: Raid disk Fail Event
note over Halon: Record Raid disk Degraded State
SSPL -&gt; Dashboard: Raid disk Fail Event
note over Dashboard: Display Action Alert

note over PODS: New disk installed
PODS -&gt; SSPL: New disk installed Event
SSPL -&gt; RabbitMQ: New disk installed Event
RabbitMQ -&gt; Halon: New disk installed Event
note over Halon: Clear Degraded State
SSPL -&gt; Dashboard: New disk installed Event
note over Dashboard: Clear Alert
Halon -&gt; RabbitMQ : actuator RAID add request
RabbitMQ -&gt; SSPL : actuator RAID add request
note over SSPL : process request
SSPL -&gt; RabbitMQ : Send Actuator response
RabbitMQ -&gt; Halon : Send Actuator response
note over Halon : noted"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-handle-os-service">
<span id="usecase-ras-fault-handle-os-service"></span><h3>ras.fault.handle.os.service<a class="headerlink" href="#ras-fault-handle-os-service" title="Permalink to this headline">¶</a></h3>
<p>If a software service state changes, SSPL broadcasts event on to the rabbitMQ channel.
Halon which listens to the event, may take relevant action when required.</p>
<p class="plantuml">
<img src="_images/plantuml-d2ade248dfac4a17c71ab67df61a17686530aee6.png" alt="participant systemd
participant SSPL
participant RabbitMQ
participant Halon

Halon -&gt; RabbitMQ: Subscribe for events
SSPL -&gt; systemd: Subscribe to UDisk2 events
systemd -&gt; SSPL: Service down
note over SSPL: Detect Service state change
SSPL -&gt; RabbitMQ: Service State change event
RabbitMQ -&gt; Halon: Service State change event
note over Halon: Noted. Trigger recovery
Halon -&gt; RabbitMQ: Actuator Service Restart request
RabbitMQ -&gt; SSPL : Actuator Service Restart request
SSPL -&gt; systemd: Restart Service
SSPL -&gt; systemd: Query Service State
systemd -&gt; SSPL: Service ON
SSPL -&gt; RabbitMQ: Actuator Response
RabbitMQ -&gt; Halon: Actuator Response
note over Halon: Noted"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-handle-os-mdraid">
<span id="usecase-ras-fault-handle-os-mdraid"></span><h3>ras.fault.handle.os.mdraid<a class="headerlink" href="#ras-fault-handle-os-mdraid" title="Permalink to this headline">¶</a></h3>
<p>SSPL monitors MDRAID array for any state changes like degraded state of any OS disk (which are part of Raid array) and broadcasts related events onto the rabbitMQ channel. From Dashboard ALert, Administrators will replace the disk and will initiate repair action. Halon will request to add this new OS disk to the array and SSPL will perform add operation using mdadm utility and relevant response will be sent to Halon and Halon will record the state.Also, relevant alerts will be sent to Dashboard with the help of Halon.</p>
<p class="plantuml">
<img src="_images/plantuml-d39d3a39e250c568876dc016fc57049346a37b1e.png" alt="participant OS
participant MDRAID
participant SSPL
participant RabbitMQ
participant Halon
participant Dashboard
actor Admin

Halon -&gt; RabbitMQ: Subscribe for messages
Dashboard -&gt; SSPL: Subscribe for messages
OS -&gt; MDRAID : Disk failed
note over MDRAID: Mark MD Device Degraded
SSPL -&gt; MDRAID: Query MD device state
MDRAID -&gt; SSPL: MD Device Degraded
SSPL -&gt; RabbitMQ: MD Device Degraded Message
RabbitMQ -&gt; Halon: Os Disk Degrade Message
note over Halon : noted
SSPL -&gt; Dashboard: OS Disk Degraded
note over Dashboard: Display Action Alert
Dashboard -&gt; Admin: Action Alert
note over Admin: Replace Disk
Admin -&gt; Halon: Recover OS Disk
Halon -&gt; OS: Reboot

note over OS: New disk detected
OS -&gt; SSPL: New OS Disk
SSPL -&gt; RabbitMQ: New OS Disk Message
RabbitMQ -&gt; Halon: New OS Disk Message
Halon -&gt; SSPL : Actuator Cmd: Add Disk to MD Device
note over SSPL : process request
SSPL -&gt; MDRAID: Add Disk
SSPL -&gt; RabbitMQ: Actuator response
RabbitMQ -&gt; Halon: Actuator response
note over MDRAID: Initiate MD Device Recovery
SSPL -&gt; MDRAID: Query MD Device state
MDRAID -&gt; SSPL: Recovery Complete
SSPL -&gt; RabbitMQ: MD Device Recovered
RabbitMQ -&gt; Halon: MD Device Recovered
note over Halon: Record State
SSPL -&gt; Dashboard : OS Device Ok
note over Dashboard : Clear Alert"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-handle-nw-switch">
<span id="usecase-ras-fault-handle-nw-switch"></span><h3>ras.fault.handle.nw.switch<a class="headerlink" href="#ras-fault-handle-nw-switch" title="Permalink to this headline">¶</a></h3>
<p>Network switch in Rack is monitored through remote management APIs. Admin can recover
network port physically. Dashboard will publish a fault alert in case a fault occurs
in the network switch.</p>
<p class="plantuml">
<img src="_images/plantuml-fadf1c9033276539fb262815b348e8a7ecf32f3d.png" alt="participant NWSwitch
participant &quot;SSPL SNMP Plugin&quot;
participant SSPL
participant RabbitMQ
participant Halon
participant Dashboard
actor Admin

&quot;SSPL SNMP Plugin&quot; -&gt; NWSwitch : Subscribe for events
Dashboard -&gt; SSPL : Subscribe for events
note over NWSwitch: N/W port down
NWSwitch -&gt; &quot;SSPL SNMP Plugin&quot;: N/W port down Event
&quot;SSPL SNMP Plugin&quot; -&gt; SSPL: N/W port down Event
note over SSPL: Process Event
SSPL -&gt; RabbitMQ: N/W port down Event
RabbitMQ -&gt; Halon: N/W port down Event
note over Halon: Noted
SSPL -&gt; Dashboard: N/W port down Event
note over Dashboard: Display alert
note over Admin: Replace Switch
note over NWSwitch: N/W port up
NWSwitch -&gt; &quot;SSPL SNMP Plugin&quot;: N/W port up Event
&quot;SSPL SNMP Plugin&quot; -&gt; SSPL: N/W port up Event
note over SSPL: Process Event
SSPL -&gt; RabbitMQ: N/W port up Event
RabbitMQ -&gt; Halon: N/W port up Event
SSPL -&gt; Dashboard: N/W port up Event
note over Dashboard: Clear alert"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-handle-pdu-voltage">
<span id="usecase-ras-fault-handle-pdu-voltage"></span><h3>ras.fault.handle.pdu.voltage<a class="headerlink" href="#ras-fault-handle-pdu-voltage" title="Permalink to this headline">¶</a></h3>
<p>SSPL subscribe for any PDU events like PDU voltage drop through PDU exposed remote management apis. If any of PDU develops fault, same is propagated to SSPL &amp; further components in chain as depicted in sequence diagram.</p>
<p class="plantuml">
<img src="_images/plantuml-32b32b6a02e73a905c1e7b5b57613be7d896f49a.png" alt="Actor Admin
participant PDUs
participant SSPL
participant RabbitMQ
participant Halon
participant Dashboard

SSPL -&gt; PDUs: subscribe for events
Halon -&gt; RabbitMQ : Subscribe for events
Dashboard -&gt; SSPL : Subscribe for events
note over PDUs: PDU #n Voltage Drop
PDUs -&gt; SSPL : PDU #n Fault detected
note over SSPL: Process Request.\nBroadcast
SSPL -&gt; RabbitMQ: PDU #n Voltage\nFault detected
RabbitMQ -&gt; Halon:PDU #n Voltage\nFault detected
note over Halon: Noted\n No Action
SSPL -&gt; Dashboard: PDU #n Voltage\nFault detected
note over Dashboard : Display Action Alert
note over SSPL: Recover PDU\nusing predefined\n recovery steps
SSPL -&gt; RabbitMQ :PDU recovered message
RabbitMQ -&gt; Halon:PDU recovered message
Halon -&gt; Dashboard :PDU recovered message
note over Dashboard : Clear Alert
Admin -&gt; PDUs: If PDU unrecoverable\nReplace faulty PDU
PDUs -&gt; SSPL : PDU replace message
SSPL -&gt; RabbitMQ : PDU replace message
RabbitMQ -&gt; Halon : PDU replace message
note over Halon : noted
SSPL -&gt; Dashboard : PDU replace message
note over Dashboard : Clear Alert"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-handle-os-space">
<span id="usecase-ras-fault-handle-os-space"></span><h3>ras.fault.handle.os.space<a class="headerlink" href="#ras-fault-handle-os-space" title="Permalink to this headline">¶</a></h3>
<p>SSPL detects OS resources availability like drive free space capacity  and broadcast event to subscribed rabbitmq channel to take recovery action. SSPL can accept request to recover from low disk space availability by possibly clearing predefined temporary caches.</p>
<p class="plantuml">
<img src="_images/plantuml-340ca07edfff446b95465f26e593829c1af8c775.png" alt="participant OS
participant SSPL
participant RabbitMQ
participant Halon
participant Dashboard
actor Admin

Halon -&gt;RabbitMQ : Subscribe for events
Dashboard -&gt; SSPL: Subscribe for events
SSPL -&gt; OS: query space info
OS -&gt; SSPL: space info
note over SSPL:Low space detected
SSPL -&gt; RabbitMQ: message indicating low space
RabbitMQ -&gt; Halon: message indicating low space
note over Halon: Process message
SSPL -&gt; Dashboard: low space event
note over Dashboard: Display alert
Admin -&gt; Dashboard: control action
Dashboard -&gt; Halon: control action
note over Halon: Process message
Halon -&gt; RabbitMQ: request to clear tmp files
RabbitMQ -&gt; SSPL: request to clear tmp files
note over SSPL: Process request
SSPL -&gt; OS: command to clear temp files
note over OS: Clear tmp files"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-alert-email">
<span id="usecase-ras-fault-alert-email"></span><h3>ras.fault.alert.email<a class="headerlink" href="#ras-fault-alert-email" title="Permalink to this headline">¶</a></h3>
<p>Email will be sent by SSPL on configured faults. Sender and receiver email addresses and SMTP server will be configured in SSPL.</p>
<p class="plantuml">
<img src="_images/plantuml-ff577c6313163018930acf4e2520bfad59a6992f.png" alt="participant Enclosure
participant CLI
participant SSPL
participant &quot;SMTP Server&quot;
participant &quot;Admin Email Account&quot;

CLI -&gt; SSPL: configure user email and SMTP server credentials
note over SSPL: Add email subscription
Enclosure -&gt; SSPL: drive failure notification
note over SSPL: Prepare email
SSPL -&gt; &quot;SMTP Server&quot;: email with drive failure notification
note over &quot;SMTP Server&quot;: Send email
&quot;SMTP Server&quot; -&gt; &quot;Admin Email Account&quot;: email with drive failure notification"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-alert-dashboard">
<span id="usecase-ras-fault-alert-dashboard"></span><h3>ras.fault.alert.dashboard<a class="headerlink" href="#ras-fault-alert-dashboard" title="Permalink to this headline">¶</a></h3>
<p>SSPL will propagate configured faults to Dashboard through RabbitMQ channel. Dashboard in turn will process notifications and will highlight in Dashboard view as per the criticality of the notification.</p>
<p class="plantuml">
<img src="_images/plantuml-3a309bb5d1a97f4bbe4f881cdbeb48f9931e5d6e.png" alt="participant Enclosure
participant SSPL
participant RabbitMQ
participant &quot;Halon&quot;
participant &quot;Dashboard&quot;

Halon-&gt; RabbitMQ : Subscribe for events
Dashboard -&gt; SSPL : Subscribe for events
Enclosure -&gt; SSPL: drive failure notification
note over SSPL: Process message
SSPL -&gt; RabbitMQ: drive failure notification
RabbitMQ -&gt; Halon: drive failure notification
note over Halon : noted
SSPL -&gt; Dashboard: drive failure
note over Dashboard: Show alert"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-stats-os-cpu">
<span id="usecase-ras-stats-os-cpu"></span><h3>ras.stats.os.cpu<a class="headerlink" href="#ras-stats-os-cpu" title="Permalink to this headline">¶</a></h3>
<p>SSPL detects system resource cpu over usage by any particular service , generate stats for same based on current,historical values and broadcast stats to subscribed rabbitmq channel to take recovery action, if need be. SSPL can accept request to recover from over cpu usage by restarting the faulty service or any other predefined recovery steps.</p>
<p class="plantuml">
<img src="_images/plantuml-2abca38aba99f7a8003be7aac95fefe5d9ba3cbc.png" alt="participant OS
participant SSPL
participant RabbitMQ
participant Halon
participant Dashboard

Halon -&gt; RabbitMQ: Subscribe to messages
Dashboard -&gt; SSPL: Subscribe to messages
SSPL -&gt; OS: Periodically monitors CPU data
note over SSPL: Process Data
SSPL -&gt; RabbitMQ : CPU information message
RabbitMQ -&gt; Halon : CPU information message
note over Halon: Noted
SSPL -&gt; Dashboard:  CPU usage stats
note over Dashboard: Display CPU stats"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-stats-os-memory">
<span id="usecase-ras-stats-os-memory"></span><h3>ras.stats.os.memory<a class="headerlink" href="#ras-stats-os-memory" title="Permalink to this headline">¶</a></h3>
<p>SSPL detects system resource main memory (RAM) over usage by any particular service , generate stats for same based on current,historical values and broadcast stats to subscribed rabbitmq channel to take recovery action, if need be. SSPL can accept request to recover from high memory usage by restarting the faulty service or any other predefined recovery steps.</p>
<p class="plantuml">
<img src="_images/plantuml-a163058f9f4ff88de2d3e275247c2687b1595b47.png" alt="participant OS
participant SSPL
participant RabbitMQ
participant Halon
participant Dashboard
Halon -&gt; RabbitMQ: Subscribe to messages
Dashboard -&gt; SSPL: Subscribe to messages
SSPL -&gt; OS: Monitor memory releted information
note over SSPL: Process Data
SSPL -&gt; RabbitMQ: Memory usage message
RabbitMQ -&gt; Halon: Memory usage message
note over Halon: Noted
SSPL -&gt; Dashboard  : Memory usage stats
note over Dashboard: Display memory stats"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-support-bundle">
<span id="usecase-ras-support-bundle"></span><h3>ras.support.bundle<a class="headerlink" href="#ras-support-bundle" title="Permalink to this headline">¶</a></h3>
<p>Support bundle aims at obtaining all possible debug information from the EOS system in the event of system issues. The support bundle creation process includes two things:</p>
<ol class="arabic simple">
<li><p>Running debug commands and obtaining the output</p></li>
<li><p>Obtaining log files</p></li>
</ol>
<p>The information is obtained from all the noes, in parallel. Finally information is stored in a compressed archive form, so that it can be sent to the support team.</p>
<p class="plantuml">
<img src="_images/plantuml-97bdf0b2f6f779243eebe3f53cd425d0fdf60d41.png" alt="participant CLI
participant CMU
participant &quot;SSU-1&quot;
participant &quot;SSU-n&quot;
participant &quot;S3Server-1&quot;
participant &quot;S3Server-n&quot;
participant &quot;Seagate Remote Location&quot;

CLI -&gt; CMU: Create bundle request
CMU -&gt; &quot;SSU-1&quot;: Collect Files
note over &quot;SSU-1&quot;: Collect Files
CMU -&gt; &quot;SSU-n&quot;: Collect Files
note over &quot;SSU-n&quot;: Collect Files
CMU -&gt; &quot;S3Server-1&quot;: Collect Files
note over &quot;S3Server-1&quot;: Collect Files
CMU -&gt; &quot;S3Server-n&quot;: Collect Files
note over &quot;S3Server-n&quot;: Collect Files
CMU &lt;-- &quot;SSU-1&quot;: Collected Files
CMU &lt;-- &quot;SSU-n&quot;: Collected Files
CMU &lt;-- &quot;S3Server-1&quot;: Collected Files
CMU &lt;-- &quot;S3Server-n&quot;: Collected Files
note over CMU: Compressed &amp; Prepare Bundle
CLI &lt;-- CMU: result

CLI -&gt; CMU: upload bundle request
CMU -&gt; &quot;Seagate Remote Location&quot;: support bundle archive
note over &quot;Seagate Remote Location&quot;: Store bundle archive
&quot;Seagate Remote Location&quot; -&gt; CMU: upload completion message
CMU -&gt; CLI: upload completion message"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-support-callhome">
<span id="usecase-ras-support-callhome"></span><h3>ras.support.callhome<a class="headerlink" href="#ras-support-callhome" title="Permalink to this headline">¶</a></h3>
<p>SSPL will log support ticket to Seagate’s support management system. That ticket will be displayed to some dashboard to Seagate’s internal support person who is going to provide support. Also SSPL will send paging message or SMS to a support person of a customer.</p>
<p class="plantuml">
<img src="_images/plantuml-7ee1c81b299ce867e4c1d599b9a844dc22fa36d4.png" alt="participant Enclosure
participant SSPL
participant &quot;Seagate Support Center&quot;
actor &quot;Support Person&quot;

Enclosure -&gt; SSPL: SNMP trap for fault
note over SSPL: Process message
SSPL -&gt; &quot;Seagate Support Center&quot;: create support ticket
note over &quot;Seagate Support Center&quot;: log ticket
&quot;Seagate Support Center&quot; -&gt; SSPL: ack for ticket creation
SSPL -&gt; &quot;Support Person&quot;: pager/sms notification"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-simulate-pods-expander-reset">
<span id="usecase-ras-fault-simulate-pods-expander-reset"></span><h3>ras.fault.simulate.pods.expander.reset<a class="headerlink" href="#ras-fault-simulate-pods-expander-reset" title="Permalink to this headline">¶</a></h3>
<p>User triggers simulated sas expanders reset request using SSPL CLI, to which SSPL responds
with dummy failure event data.</p>
<p class="plantuml">
<img src="_images/plantuml-7b1c62ea1cf1ae955daad888e0b38715d20a4805.png" alt="participant &quot;SSPL CLI&quot;
participant SSPL
participant RabbitMQ
participant Halon

Halon -&gt; RabbitMQ: subscribe to messages
Dashboard -&gt; SSPL : subscribe to messages
&quot;SSPL CLI&quot; -&gt; SSPL: simulation request for expander reset
note over SSPL: Process Request
SSPL -&gt; RabbitMQ: drive unavailable messages for all drive
RabbitMQ -&gt; Halon: drive unavailable messages for all drive
note over Halon: Noted
SSPL -&gt; Dashboard: drive unavailable messages for all drive
note over Dashboard : Display Action Alert
SSPL -&gt; RabbitMQ: drive available messages for all drive
RabbitMQ -&gt; Halon: drive available messages for all drive
note over Halon: Noted
SSPL -&gt; Dashboard: drive available messages for all drive
note over Dashboard : Display Action Alert"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-simulate-nw-interface">
<span id="usecase-ras-fault-simulate-nw-interface"></span><h3>ras.fault.simulate.nw.interface<a class="headerlink" href="#ras-fault-simulate-nw-interface" title="Permalink to this headline">¶</a></h3>
<p>User triggers simulated network interface failure request using sspl cli, to which SSPL
responds with dummy failure event data.</p>
<p class="plantuml">
<img src="_images/plantuml-07814ea6ed4151394c35aaaf5db88eaa04420b05.png" alt="participant &quot;SSPL CLI&quot;
participant SSPL
participant RabbitMQ
participant Dashboard

Halon -&gt; RabbitMQ: Subscribe for events
Dashboard -&gt; SSPL: Subscribe for events
&quot;SSPL CLI&quot; -&gt; SSPL: Simulate high latency issue
note over SSPL: Generate message
SSPL -&gt; RabbitMQ: high latency issue message
RabbitMQ -&gt; Halon: high latency issue message
note over Halon : noted
SSPL -&gt; Dashboard: high latency issue message
note over Dashboard : Display action alert"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-simulate-pods-raid">
<span id="usecase-ras-fault-simulate-pods-raid"></span><h3>ras.fault.simulate.pods.raid<a class="headerlink" href="#ras-fault-simulate-pods-raid" title="Permalink to this headline">¶</a></h3>
<p>Using SSPL CLI, we can trigger SNMP trap simulation to fail one of the raid disk.SSPL will process the request and simulation response will be received by Halon through RabbitMQ and failure alert will be displayed in the Dashboard.</p>
<p class="plantuml">
<img src="_images/plantuml-bf968e975e1f899e4d99087db1a14f39d852c583.png" alt="participant &quot;SSPL CLI&quot;
participant SSPL
participant RabbitMQ
participant Halon
participant Dashboard
Halon -&gt; RabbitMQ: Subscribe for Events
Dashboard -&gt; SSPL : Subscribe for Events.
&quot;SSPL CLI&quot; -&gt; SSPL: Simulate Raid disk failure
note over SSPL : process request
SSPL -&gt; RabbitMQ: Disk Fail message
RabbitMQ -&gt; Halon: Disk Fail message
note over Halon: noted
SSPL -&gt; Dashboard: Disk Fail message
note over Dashboard: Display Action Alert

SSPL -&gt; RabbitMQ: Raid Degrade message
RabbitMQ -&gt; Halon: Raid Degrade message
note over Halon: noted
SSPL -&gt; Dashboard: Raid Degrade message
note over Dashboard: Display Action Alert"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-simulate-os-mdraid">
<span id="usecase-ras-fault-simulate-os-mdraid"></span><h3>ras.fault.simulate.os.mdraid<a class="headerlink" href="#ras-fault-simulate-os-mdraid" title="Permalink to this headline">¶</a></h3>
<p>User simulates uninstall  of an OS MD Raid disk through SSPL-CLI, SSPL will process that request and simulated response will be sent to Halon through RabbitMQ. SImilar flow will be there in case of raid os disk install. And finally, through CLI, raid add request will be performed and relevant simulation response will be sent to Halon which will be noted by Halon.</p>
<p class="plantuml">
<img src="_images/plantuml-a463aac0c93cc002fe62c5ca3c50e5cdbc63e33b.png" alt="Actor User
participant &quot;SSPL CLI&quot;
participant SSPL
participant RabbitMQ
participant Halon
participant Dashboard

Halon -&gt; RabbitMQ: subscribe for events
Dashboard -&gt; SSPL : Subscribe for events
User -&gt; &quot;SSPL CLI&quot; : Simulate OS raid disk uninstall
&quot;SSPL CLI&quot; -&gt; SSPL :Simulate OS raid disk uninstall
note over SSPL: Process Request
SSPL -&gt; RabbitMQ: Disk Fail message
RabbitMQ -&gt; Halon:Disk Fail message
note over Halon: Noted
SSPL -&gt; Dashboard: Disk Fail message
note over Dashboard: Display Action Alert
SSPL -&gt; RabbitMQ: Raid Degrade message
RabbitMQ -&gt; Halon:Raid Degrade message
note over Halon: Noted
SSPL -&gt; Dashboard: Raid Degrade message
note over Dashboard: Display Action Alert"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-fault-predict-pods-vdisk">
<span id="usecase-ras-fault-predict-pods-vdisk"></span><h3>ras.fault.predict.pods.vdisk<a class="headerlink" href="#ras-fault-predict-pods-vdisk" title="Permalink to this headline">¶</a></h3>
<p>TBD. There is a dependency on study of PODS.</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-security-user">
<span id="usecase-ras-security-user"></span><h3>ras.security.user<a class="headerlink" href="#ras-security-user" title="Permalink to this headline">¶</a></h3>
<p>Halon will send a login request for authentication containing user credentials to SSPL. SSPL will contact Authentication Server to check validity of supplied user credentials and get a security token if user is valid. That security token will be returned back to Halon and can be used with subsequent actuator requests. When SSPL receives that security token with some request, it will send that token with detail of action requested by Halon, to authentication server again. Authentication server will validate that token and authority of user for requested action. If token is valid and user is allowed for that action, it will send back a response to SSPL indicating that user is allowed to perform action. SSPL will then perform action and send response back to Halon.</p>
<p class="plantuml">
<img src="_images/plantuml-784233afb8c3e22118a93b850a74479603b93d3f.png" alt="participant Halon
participant RabbitMQ
participant SSPL
participant &quot;Authentication Server&quot;

Halon -&gt; RabbitMQ: authentication request with user credentials
RabbitMQ -&gt; SSPL: authentication request with user credentials
note over SSPL: Extract credentials
SSPL -&gt; &quot;Authentication Server&quot;: check user validity
note over &quot;Authentication Server&quot;: Validate user
&quot;Authentication Server&quot; -&gt; SSPL: security token
note over SSPL: Prepare response
SSPL -&gt; RabbitMQ: response with valid security token
RabbitMQ -&gt; Halon: response with valid security token

Halon -&gt; RabbitMQ: actuator request to restart service, with security token
RabbitMQ -&gt; SSPL: actuator request with security token
note over SSPL: Extract token
SSPL -&gt; &quot;Authentication Server&quot;: security token and actuator action
note over &quot;Authentication Server&quot;: Validate token and check authorization for action
&quot;Authentication Server&quot; -&gt; SSPL: user is authorized
note over SSPL: Perform actuator action
SSPL -&gt; RabbitMQ: actuator response
RabbitMQ -&gt; Halon: actuator response"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-security-encryption">
<span id="usecase-ras-security-encryption"></span><h3>ras.security.encryption<a class="headerlink" href="#ras-security-encryption" title="Permalink to this headline">¶</a></h3>
<p>This use case shows how encryption is done for messages sent and received in SSPL. Encryption will use public key cryptography infrastructure. SSPL will have its own public/private keypair and consumers will have one such key pair shared among them.</p>
<p>At the time of sending a message, SSPL will encrypt message using public key of a consumer. When consumer receives this encrypted message it will decrypt the same message and proceed with further action if decryption is successful.</p>
<p class="plantuml">
<img src="_images/plantuml-18d924b09afd023947246cce3cb916125a91272f.png" alt="participant PODS
participant SSPL
participant &quot;Encryption Module&quot;
participant RabbitMQ
participant Halon
participant Dashboard

Halon -&gt; RabbitMQ: subscribe for messages
Dashboard -&gt; SSPL: subscribe for messages
PODS -&gt; SSPL: disk failure snmp trap
note over SSPL: Process message
SSPL -&gt; &quot;Encryption Module&quot;: disk failure message to encrypt
note over &quot;Encryption Module&quot;: Encrypt message using consumer's public key
&quot;Encryption Module&quot; -&gt; SSPL: encrypted disk failure message
SSPL -&gt; RabbitMQ: Encrypted drive failure message
RabbitMQ -&gt; Halon: Encrypted drive failure message
SSPL -&gt; Dashboard: Encrypted drive failure message
note over Dashboard: Display alert

Halon -&gt; &quot;Encryption Module&quot;: encrypted drive failure message
note over &quot;Encryption Module&quot;: Descrypt message using consumer's private key
&quot;Encryption Module&quot; -&gt; Halon: decrypted disks failure message
note over Halon: noted"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-iem-log">
<span id="usecase-ras-iem-log"></span><h3>ras.iem.log<a class="headerlink" href="#ras-iem-log" title="Permalink to this headline">¶</a></h3>
<p>The IEM is a message that uniquely identifies an event with a source location it is generated from. SSPL provides an actuator to log IEM to Syslog.</p>
<p class="plantuml">
<img src="_images/plantuml-9d1ec15d259764730cd876b3eeb473c69a17feaf.png" alt="participant S3
participant Mero
participant Halon
participant RabbitMQ
participant SSPL
participant Syslog

S3 -&gt; RabbitMQ: IEM Request
Mero -&gt; RabbitMQ: IEM Request
Halon -&gt; RabbitMQ: IEM Request
RabbitMQ -&gt; SSPL: All individual IEM Requests queued
note over SSPL: Process IEM Request
SSPL -&gt; Syslog: log formatted message"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="ras-iem-email">
<span id="usecase-ras-iem-email"></span><h3>ras.iem.email<a class="headerlink" href="#ras-iem-email" title="Permalink to this headline">¶</a></h3>
<p>The IEM is a message that uniquely identifies an event with a source location it is generated from. SSPL provides an actuator to send email with IEM.</p>
<p class="plantuml">
<img src="_images/plantuml-9de145302798778041b6eec4a6809421e756a615.png" alt="participant S3
participant Mero
participant Halon
participant RabbitMQ
participant &quot;SSPL CLI&quot;
participant SSPL
participant &quot;SMTP Server&quot;
participant &quot;Admin email account&quot;


&quot;SSPL CLI&quot; -&gt; SSPL: configure email for IEM
Halon -&gt; RabbitMQ: IEM Request
S3 -&gt; RabbitMQ: IEM Request
Mero -&gt; RabbitMQ: IEM Request
RabbitMQ -&gt; SSPL: All individual  IEM Request queued
note over SSPL: Extract IEM detail
SSPL -&gt; &quot;SMTP Server&quot;: email with IEM
note over &quot;SMTP Server&quot;: Send Email
&quot;SMTP Server&quot; -&gt; &quot;Admin email account&quot;: email with IEM"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-mount">
<span id="usecase-nfs-mount"></span><h3>nfs.mount<a class="headerlink" href="#nfs-mount" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-2f83d14499a3f5d7d639371d194d7da7a173d0bf.png" alt="skinparam maxMessageSize 150
skinparam wrapWidth 200
title Mount workflow
box &quot;Client&quot; #Yellow
participant NFS_Client
endbox
box &quot;NFS Ganesha&quot; #LightBlue
participant NFS_Server
participant NFS_worker_thread
participant NFS_Export
end box
box &quot;KVSFS&quot; #LightGreen
participant FSAL_KVSFS
participant KVSNS
participant KVSAL
end box
database CLOVIS

NFS_Client-&gt;NFS_Server: Mount request
NFS_Server-&gt;NFS_worker_thread: Dispatch NFS mount procedure req
activate NFS_worker_thread #FFBBBB
NFS_worker_thread-&gt;NFS_Export: Get export by path
rnote over NFS_worker_thread
1. Get an export entry from its path
2. Search the export list for the entry
3. Check Client access
4. Get cached inode entry for root handle
   end note

NFS_worker_thread-&gt;NFS_Export: Look up path for the export and return FSAL handle
NFS_Export -&gt; FSAL_KVSFS: kvsfs_lookup_path (only &quot;/&quot; is exported)
FSAL_KVSFS -&gt; KVSNS: kvsns_get_root( )
KVSNS -&gt; FSAL_KVSFS : root inode (currently hardcoded 2)
FSAL_KVSFS -&gt; KVSNS: kvsns_getattr(cred, root)
KVSNS -&gt; KVSAL : kvsal_get_stat( )
KVSAL -&gt; CLOVIS : M0_CLOVIS_IC_GET

rnote over FSAL_KVSFS
1. Allocate and fill handle.
2. Set FSAL specific ops.
end note
FSAL_KVSFS --&gt; NFS_Export : Error code
FSAL_KVSFS -&gt;NFS_worker_thread : FSAL handle
rnote over NFS_worker_thread
Convert FSAL handle to file handle
end rnote
NFS_worker_thread -&gt; NFS_Client : File handle.
NFS_worker_thread --&gt; NFS_Client : Error code
deactivate NFS_worker_thread"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-unmount">
<span id="usecase-nfs-unmount"></span><h3>nfs.unmount<a class="headerlink" href="#nfs-unmount" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-export-create">
<span id="usecase-nfs-export-create"></span><h3>nfs.export.create<a class="headerlink" href="#nfs-export-create" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-a3686b0b143e995c4350f9a5a370c65a1ec19971.png" alt="skinparam maxMessageSize 100
skinparam wrapWidth 200
title Export workflow
box &quot;NFS Ganesha&quot; #LightBlue
participant NFS_Server
participant FSAL_PSEUDO
participant NFS_Export
participant FSAL
end box
box &quot;KVSFS&quot; #LightGreen
participant FSAL_KVSFS
participant KVSNS
participant KVSAL
participant EXTSTORE
end box
database CLOVIS

NFS_Server -&gt; FSAL_PSEUDO: Init/Register PSEUDO FSAL
FSAL_PSEUDO -&gt; NFS_Server

NFS_Server -&gt; NFS_Export: ReadExports()
activate NFS_Export #FFBBBB

note over NFS_Export
1. Read Export entries from parsed config file
2. Fill config structure from parse tree.
3. For each FSAL block,load and init FSAL module.
end note
NFS_Export -&gt; FSAL: fsal_load_init(KVSFS)
FSAL -&gt; FSAL_KVSFS: kvsfs_load()
FSAL --&gt;NFS_Export: error code
note over NFS_Export
Create an export and pass FSAL sub-block to it for fsal specific processing
end note
NFS_Export -&gt; FSAL :  fsal-&gt;m_ops.create_export()
FSAL-&gt; FSAL_KVSFS :  kvsfs_create_export()
NFS_Export --&gt; NFS_Server : Error Code
note over FSAL_KVSFS
Allocate an export point and return a handle to it to be kept in the fsal export list.
end note
FSAL_KVSFS -&gt; KVSNS: ksvsns_start
note over KVSNS
1. Start the KVSNS library
2. Read the config information for the library from the libkvsns config file
end note
KVSNS -&gt; KVSAL: kvsal_init()
note over KVSAL
1. Get clovis configuration from cfg file
2. Initialise clovis instance
end note
KVSAL-&gt; CLOVIS: init_clovis()
KVSNS -&gt; EXTSTORE:extstore_init()
KVSNS --&gt; FSAL_KVSFS: return 0
FSAL_KVSFS --&gt; FSAL : Error code
FSAL ---&gt; NFS_Export : Error code
note over NFS_Export
Commit an export block
end note
deactivate NFS_Export
NFS_Export --&gt; NFS_Server: Error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-export-delete">
<span id="usecase-nfs-export-delete"></span><h3>nfs.export.delete<a class="headerlink" href="#nfs-export-delete" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-export-list">
<span id="usecase-nfs-export-list"></span><h3>nfs.export.list<a class="headerlink" href="#nfs-export-list" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-data-read">
<span id="usecase-nfs-data-read"></span><h3>nfs.data.read<a class="headerlink" href="#nfs-data-read" title="Permalink to this headline">¶</a></h3>
<p>NFS client opens a file and issues read request to NFS server. NFS server
forwards the request to FSAL along with the file inode number which in turn
is received by KVSNS [<a class="reference internal" href="#entity-nfs">nfs</a>]. KVSNS queries KV store to get the inode
attributes for the inode. Then it performs actual read operation by calling
<a class="reference external" href="Ext-Store">Ext-Store</a> read API. Finally, it updates the timestamp
attributes in the inode structure and puts the structure back in KV store.</p>
<p class="plantuml">
<img src="_images/plantuml-b46dbe5cc89ae834ce2d4559b8740cdd6e67d12b.png" alt="title Read workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS

NFS_Client -&gt; NFS_Server: read()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_read()
FSAL_KVSFS -&gt; KVSNS: kvsns_read()
rnote over KVSNS: Get stat info for the given inode from KV store
activate KVSNS
KVSNS -&gt; EXTSTORE: extstore_read()
activate EXTSTORE
note over EXTSTORE: Get the clovis object id for corresponding inode
EXTSTORE -&gt; CLOVIS: m0kvs_get(key = &quot;ino.data&quot;, val)
CLOVIS -&gt; EXTSTORE: value for the key
note over EXTSTORE: Do actual read operation
EXTSTORE -&gt; CLOVIS: m0store_pread()
rnote over CLOVIS: Read the given object from given object id
CLOVIS -&gt; EXTSTORE: read size
rnote over EXTSTORE: Update fields in struct stats and return read size
rnote over KVSNS: Set struct stat for given inode in KV Store
EXTSTORE -&gt; KVSNS: read size
deactivate EXTSTORE
KVSNS -&gt; FSAL_KVSFS: read size
deactivate KVSNS
FSAL_KVSFS -&gt; NFS_Server: read size
NFS_Server -&gt; NFS_Client: read size"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-data-write">
<span id="usecase-nfs-data-write"></span><h3>nfs.data.write<a class="headerlink" href="#nfs-data-write" title="Permalink to this headline">¶</a></h3>
<p>NFS server forwards the request to FSAL (KVSFS) along with the inode number.
KVSNS receives inode number of the file to be written from NFS server. It
queries KV store to get the inode attributes for the inode number. Once
the attributes are received KVSNS performs actual write operation by calling
Extstore write API. Finally, it updates the timestamp attributes in the inode
structure and puts the structure back in KV store.</p>
<p>is received by KVSNS [<a class="reference internal" href="#entity-nfs">nfs</a>]. KVSNS queries KV store to get the inode
attributes for the inode. Then it performs actual read operation by calling
<a class="reference external" href="Ext-Store">Ext-Store</a> read API. Finally, it updates the timestamp
attributes in the inode structure and puts the structure back in KV store.</p>
<p class="plantuml">
<img src="_images/plantuml-4432b52ee66c4922f066867f486fedcab119e762.png" alt="title Write workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS

NFS_Client -&gt; NFS_Server: write()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_write()
FSAL_KVSFS -&gt; KVSNS: kvsns_write()
rnote over KVSNS: Get stat info for the given inode from KV store
activate KVSNS
KVSNS -&gt; EXTSTORE: extstore_write()
activate EXTSTORE
note over EXTSTORE: Get the clovis object id for corresponding inode
EXTSTORE -&gt; CLOVIS: m0kvs_get(key = &quot;ino.data&quot;, val)
CLOVIS -&gt; EXTSTORE: value for the key
note over EXTSTORE: Do actual write operation
EXTSTORE -&gt; CLOVIS: m0store_pwrite()
rnote over CLOVIS: Write to given object
CLOVIS -&gt; EXTSTORE: write size
rnote over EXTSTORE: Update fields in struct stats and return write size
rnote over KVSNS: Set struct stat for given inode in KV Store
EXTSTORE -&gt; KVSNS: write size
deactivate EXTSTORE
KVSNS -&gt; FSAL_KVSFS: write size
deactivate KVSNS
FSAL_KVSFS -&gt; NFS_Server: write size
NFS_Server -&gt; NFS_Client: write size"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-file-create">
<span id="usecase-file-create"></span><h3>nfs.file.create<a class="headerlink" href="#nfs-file-create" title="Permalink to this headline">¶</a></h3>
<p>File create steps, start with validating access permission. For this,
KVSNS [<a class="reference internal" href="#entity-nfs">nfs</a>] receives the parent inode and the name of file. After
validating access permissions, KVSNS checks if entry with the given file
name already exists by doing a lookup on parent. If entry does not exist,
it starts preparing for creating new entry for the inode. Finally, it
an object is created on the extstore.</p>
<p class="plantuml">
<img src="_images/plantuml-127996ee8ce23b647cec3919e853d3ee05919839.png" alt="title Create workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS

NFS_Client -&gt; NFS_Server: creat()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_creat()
FSAL_KVSFS -&gt; KVSNS: kvsns_creat()
activate KVSNS
rnote over KVSNS
    1. Get the parent stat info
    2. Check write access in stat info
    3. Do lookup on parent for new entry
end note
KVSNS -&gt; KVSNS: ksvsns_create_entry()
note over KVSNS: Increment the current inode number
activate KVSNS #FFBBBB
KVSNS -&gt; KVSAL: kvsal_incr_counter(ino_counter)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(key = &quot;ino_counter&quot;, val)
CLOVIS --&gt; KVSAL: value for the key
note over KVSAL: ino_counter += 1
KVSAL -&gt; CLOVIS: m0kvs_set(key = &quot;ino_counter&quot;, val)
CLOVIS --&gt; KVSAL: error code
KVSAL --&gt; KVSNS: error code
deactivate KVSAL
rnote over KVSNS
    1. Fill in the details in struct stat for new entry
    2. Update stats in KV store
end note
deactivate KVSNS
note over KVSNS: Create object on backend
KVSNS -&gt; EXTSTORE: extstore_creat()
activate EXTSTORE
rnote over EXTSTORE
    1. Generate clovis object id from inode number
    2. Update the mapping in KV store.
end note
EXTSTORE -&gt; CLOVIS: m0kvs_set(key, val)
CLOVIS --&gt; EXTSTORE: error code
note over EXTSTORE: Create an object
EXTSTORE -&gt; CLOVIS: m0store_create_object(id)
CLOVIS --&gt; EXTSTORE: error code
EXTSTORE --&gt; KVSNS: error code
deactivate EXTSTORE
KVSNS --&gt; FSAL_KVSFS: error code
deactivate KVSNS
FSAL_KVSFS --&gt; NFS_Server: error code
NFS_Server --&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-file-rename">
<span id="usecase-nfs-file-rename"></span><h3>nfs.file.rename<a class="headerlink" href="#nfs-file-rename" title="Permalink to this headline">¶</a></h3>
<p>KVSNS [<a class="reference internal" href="#entity-nfs">nfs</a>] is supplied with old parent’s inode number, old filename, new
parent’s inode number and new filename as parameters for rename. KVSNS first
gets the parent list for old file from KV store and it will remove the old
parent from the list. Now, remove the old entry from dirent of old parent
and add a new entry in the dirent of a new parent. Finally, update the parent
list for new file.</p>
<p class="plantuml">
<img src="_images/plantuml-8ae01d5d386b0f4126c4a49895e22e9dfd5cb50f.png" alt="skinparam defaultFontSize 14

title Rename workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS

NFS_Client -&gt; NFS_Server: rename()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_rename()
FSAL_KVSFS -&gt; KVSNS: kvsns_rename()
activate KVSNS
rnote over KVSNS
    1. Get the old parent stat info and check write access
    2. Get the new parent stat info and check write access
    3. Do lookup on new parent for new entry if already exists
    4. Do lookup on old parent for old entry and get stats for old entry
end note
note over KVSNS: Get parent list for given entry
KVSNS -&gt; KVSAL: kvsns_get_char(key = &quot;ino.parentdir&quot;, val)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(key = &quot;ino.parentdir&quot;, val)
CLOVIS --&gt; KVSAL: value for the key
KVSAL --&gt; KVSNS: value for the key
deactivate KVSAL
rnote over KVSNS: Update old parent with new parent in parent list
note over KVSNS: Delete old name from old parent's dentries
KVSNS -&gt; KVSAL: kvsns_del(key = &quot;sino.dentries.oname&quot;)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_del(key = &quot;sino.dentries.oname&quot;)
CLOVIS --&gt; KVSAL: error code
KVSAL --&gt; KVSNS: error code
deactivate KVSAL
note over KVSNS: Add new name to new parent's dentries
KVSNS -&gt; KVSAL: kvsns_set_char(key = &quot;dino.dentries.dname&quot;, val)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_set(key = &quot;dino.dentries.dname&quot;)
CLOVIS --&gt; KVSAL: error code
KVSAL --&gt; KVSNS: error code
deactivate KVSAL
note over KVSNS: Set parent list for given entry
KVSNS -&gt; KVSAL: kvsns_set_char(key = &quot;ino.parentdir&quot;, val)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_set(key = &quot;ino.parentdir&quot;, val)
CLOVIS --&gt; KVSAL: error code
KVSAL --&gt; KVSNS: error code
deactivate KVSAL
KVSNS --&gt; FSAL_KVSFS: error code
deactivate KVSNS
FSAL_KVSFS --&gt; NFS_Server: error code
NFS_Server --&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-file-open">
<span id="usecase-nfs-file-open"></span><h3>nfs.file.open<a class="headerlink" href="#nfs-file-open" title="Permalink to this headline">¶</a></h3>
<p>Objective of KVSNS is to fill kvsns_fill_open structure which holds the information of
open flags, process id and thread id. When KVSNS receives open call it gets list of open
owners for that file. Once that is got, it updates the process id and thread id for the
current request and stores the list back to KV store. Finally, it updates the kvsns_fill_open
structure with necessary details and return it back to FSAL_KVSFS.</p>
<p class="plantuml">
<img src="_images/plantuml-65a821292f3acd7ce49ac85562609e0c05c0b83f.png" alt="title Open workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS
NFS_Client -&gt; NFS_Server: open()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_open()
FSAL_KVSFS -&gt; KVSNS: kvsns_open()
activate KVSNS
note over KVSNS: Get the list of open owners
KVSNS -&gt; KVSAL: kvsns_get_char(key = &quot;ino.openowner&quot;, val)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(key = &quot;ino.openowner&quot;, val)
CLOVIS --&gt; KVSAL: value for the key
KVSAL --&gt; KVSNS: value for the key
deactivate KVSAL
rnote over KVSNS: Update the list with current pid and tid
note over KVSNS: Set the list of owners for given entry
KVSNS -&gt; KVSAL: kvsns_set_char(key = &quot;ino.openowner&quot;, val)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_set(key = &quot;ino.openowner&quot;, val)
CLOVIS --&gt; KVSAL: error code
KVSAL --&gt; KVSNS: error code
deactivate KVSAL
rnote over KVSNS
      Fill the //kvsns_file_open// structure with
      ino_number, pid, tid, and open flag details.
end rnote
KVSNS --&gt; FSAL_KVSFS: error code
deactivate KVSNS
FSAL_KVSFS --&gt; NFS_Server: error code
NFS_Server --&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-file-close">
<span id="usecase-nfs-file-close"></span><h3>nfs.file.close<a class="headerlink" href="#nfs-file-close" title="Permalink to this headline">¶</a></h3>
<p>On receiving close KVSNS either deletes the open owners list if list has
single entry or it removes an entry from the list with given pid.</p>
<p class="plantuml">
<img src="_images/plantuml-45eb9bcdacd94face2bc0714ef807236a769ed7b.png" alt="title Close workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS
NFS_Client -&gt; NFS_Server: Close()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_close()
FSAL_KVSFS -&gt; KVSNS: kvsns_close()
activate KVSNS
note over KVSNS: Get the list of open owners
KVSNS -&gt; KVSAL: kvsal_get_char(key = &quot;ino.openowner&quot;, val)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(key = &quot;ino.openowner&quot;, val)
CLOVIS --&gt; KVSAL: value for the key
KVSAL --&gt; KVSNS: value for the key
deactivate KVSAL
alt #transparent if list has only single entry
rnote over KVSNS: Update the list with current pid and tid
note over KVSNS: Delete the list of owners for given entry
KVSNS -&gt; KVSAL: kvsal_del(key = &quot;ino.openowner&quot;, val)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_del(key = &quot;ino.openowner&quot;)
CLOVIS --&gt; KVSAL: error code
KVSAL --&gt; KVSNS: error code
deactivate KVSAL
group #transparent if file marked to be deleted
note over KVSNS: Delete the object from extstore
KVSNS -&gt; EXTSTORE: extstore_del()
activate EXTSTORE
rnote over EXTSTORE: Get the clovis object id from inode number
EXTSTORE -&gt; CLOVIS: m0kvs_get(key, val)
CLOVIS --&gt; EXTSTORE: error code
note over EXTSTORE: Create an object
EXTSTORE -&gt; CLOVIS: m0store_delete_object(id)
CLOVIS --&gt; EXTSTORE: error code
EXTSTORE --&gt; KVSNS: error code
end
else multiple entries exists
rnote over KVSNS: Remove the entry from owners list
end
KVSNS --&gt; FSAL_KVSFS: error code
deactivate KVSNS
FSAL_KVSFS --&gt; NFS_Server: error code
NFS_Server --&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-setattr">
<span id="usecase-nfs-setattr"></span><h3>nfs.setattr<a class="headerlink" href="#nfs-setattr" title="Permalink to this headline">¶</a></h3>
<p>KVSNS [<a class="reference internal" href="#component-nfs">nfs</a>] is supplied with attributes to be set for the inode number.
KVSNS queries KV store to get the stored attributes for given key. It
updates the required fields and stores the structure back in KV store.</p>
<p class="plantuml">
<img src="_images/plantuml-060c530be7dc26c2a8367dc854761dfd6e6760ad.png" alt="title Setattr workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS
NFS_Client -&gt; NFS_Server: setattr()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_setattr()
FSAL_KVSFS -&gt; KVSNS: kvsns_setattr()
activate KVSNS
rnote over KVSNS
Check write access in stat info
end note
note over KVSNS: Get stat info for the given inode from KV store
KVSNS -&gt; KVSAL: kvsal_get_stat()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(key, val)
CLOVIS -&gt; KVSAL: value for the key
deactivate KVSAL
KVSAL -&gt; KVSNS:  value for the key
rnote over KVSNS: Fill the details in struct stat
note over KVSNS: Set stat info for the given inode from KV store
KVSNS -&gt; KVSAL: kvsns_set_stat()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_set(key, val)
CLOVIS -&gt; KVSAL: error code
deactivate KVSAL
KVSAL -&gt; KVSNS: error code
KVSNS -&gt; FSAL_KVSFS:  error code
deactivate KVSNS
FSAL_KVSFS -&gt; NFS_Server: error code
NFS_Server -&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-getattr">
<span id="usecase-nfs-getattr"></span><h3>nfs.getattr<a class="headerlink" href="#nfs-getattr" title="Permalink to this headline">¶</a></h3>
<p>KVSNS [<a class="reference internal" href="#entity-nfs">nfs</a>] receives inode number of a file/dir whose attributes are required.
Using the inode number it queries KV store to get the attributes.</p>
<p class="plantuml">
<img src="_images/plantuml-1fe0acb00b45363e1bf1dccbc36279457d0b51b7.png" alt="title Getattr workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
    end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS
NFS_Client -&gt; NFS_Server: getattr()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_getattr()
FSAL_KVSFS -&gt; KVSNS: kvsns_getattr()
activate KVSNS
note over KVSNS: Get stat info for the given inode from KV store
KVSNS -&gt; KVSAL: kvsal_get_stat()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(key, val)
CLOVIS -&gt; KVSAL: value for the key
KVSAL -&gt; KVSNS:  value for the key
deactivate KVSAL
KVSNS -&gt; FSAL_KVSFS:  error code
deactivate KVSNS
FSAL_KVSFS -&gt; NFS_Server: error code
NFS_Server -&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-setxattr">
<span id="usecase-nfs-setxattr"></span><h3>nfs.setxattr<a class="headerlink" href="#nfs-setxattr" title="Permalink to this headline">¶</a></h3>
<p>KVSNS [<a class="reference internal" href="#entity-nfs">nfs</a>] receives extended attribute to be set for the given inode number.
After receiving attributes, KVSNS queries KV store to get the stored value for given xattr.
It updates the value for xattr and stores the structure back in KV store.</p>
<p class="plantuml">
<img src="_images/plantuml-fdef8434568e266435a3a0428c18efd1bdda3fd2.png" alt="title Setxattr workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS
NFS_Client -&gt; NFS_Server: setxattr()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_setxattr()
FSAL_KVSFS -&gt; KVSNS: kvsns_setxattr()
activate KVSNS
rnote over KVSNS
Check write access in stat info
end note
note over KVSNS: Get the value for given xattr
KVSNS -&gt; KVSAL: kvsal_get_stat()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(&quot;ino.xattr.key&quot;, val)
CLOVIS -&gt; KVSAL: value for the key
KVSAL -&gt; KVSNS:  value for the key
deactivate KVSAL
note over KVSNS: Update the value and store it back into KV
KVSNS -&gt; KVSAL: kvsns_set_binary()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_set(key, val)
CLOVIS -&gt; KVSAL: error code
KVSAL -&gt; KVSNS: error code
deactivate KVSAL
KVSNS -&gt; FSAL_KVSFS:  error code
deactivate KVSNS
FSAL_KVSFS -&gt; NFS_Server: error code
NFS_Server -&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-getxattr">
<span id="usecase-nfs-getxattr"></span><h3>nfs.getxattr<a class="headerlink" href="#nfs-getxattr" title="Permalink to this headline">¶</a></h3>
<p>KVSNS [<a class="reference internal" href="#entity-nfs">nfs</a>] receives an inode number of a file/dir whose attributes are required.
Using the inode number it queries KV store to get the attributes.</p>
<p class="plantuml">
<img src="_images/plantuml-2a0704aa82c761e5e1624cb9082d6733e9f7aef6.png" alt="title Getxattr workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS
NFS_Client -&gt; NFS_Server: getxattr()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_getxattr()
FSAL_KVSFS -&gt; KVSNS: kvsns_getxattr()
activate KVSNS
note over KVSNS: Get value for the given extended attribute
KVSNS -&gt; KVSAL: kvsal_get_binary()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(&quot;ino.xattr.key&quot;, val)
CLOVIS -&gt; KVSAL: value for the key
KVSAL -&gt; KVSNS:  value for the key
deactivate KVSAL
KVSNS -&gt; FSAL_KVSFS:  error code
deactivate KVSNS
FSAL_KVSFS -&gt; NFS_Server: error code
NFS_Server -&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-dir-lookup">
<span id="usecase-nfs-dir-lookup"></span><h3>nfs.dir.lookup<a class="headerlink" href="#nfs-dir-lookup" title="Permalink to this headline">¶</a></h3>
<p>KVSNS [<a class="reference internal" href="#entity-nfs">nfs</a>] receives parent’s inode number and name of the file/dir to
lookup. Upon receiving the parameters it checks if user has appropriate read
access rights to get dentry structure from parent. Finally, after getting dentries
it returns the inode number of given file/dir name</p>
<p class="plantuml">
<img src="_images/plantuml-b8b21d32a83a72a88af4c98543e06561b8a45160.png" alt="title Lookup workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS
NFS_Client -&gt; NFS_Server: lookup()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_lookup()
FSAL_KVSFS -&gt; KVSNS: kvsns_lookup()
activate KVSNS
rnote over KVSNS
Check read access for the parent
end note
note over KVSNS: Get dentries info for the given inode from KV store
KVSNS -&gt; KVSAL: kvsal_get_stat()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(&quot;parent_ino.dentries.filename&quot;, val)
CLOVIS -&gt; KVSAL: value for the key
deactivate KVSAL
KVSAL -&gt; KVSNS:  value for the key
rnote over KVSNS: Value returned is the inode number corresponding to filename
KVSNS -&gt; FSAL_KVSFS:  error code
deactivate KVSNS
FSAL_KVSFS -&gt; NFS_Server: error code
NFS_Server -&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-dir-mkdir">
<span id="usecase-nfs-dir-mkdir"></span><h3>nfs.dir.mkdir<a class="headerlink" href="#nfs-dir-mkdir" title="Permalink to this headline">¶</a></h3>
<p>KVSNS receives the name of directory and parent inode number from the NFS server.
To check if user has appropriate access rights it will query KV store to get the
inode attributes of parent. After checking the access rights, KVSNS checks if entry
with the given file name already exists by doing a lookup on parent. If entry does
not exists it starts preparing for creating new entry. It creates an empty inode
structure and tries to fill in the details.</p>
<p class="plantuml">
<img src="_images/plantuml-b9c7f99a8d9575c49850710ecc37afabfa94daaf.png" alt="title Mkdir workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
    participant NFS_Server
    participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
    participant KVSNS
    participant KVSAL
    participant EXTSTORE
end box
database CLOVIS

NFS_Client -&gt; NFS_Server: mkdir()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_mkdir()
FSAL_KVSFS -&gt; KVSNS: kvsns_mkdir()
activate KVSNS
rnote over KVSNS
    1. Get the parent stat info
    2. Check write access in stat info
    3. Do lookup on parent for new entry
end note
KVSNS -&gt; KVSNS: ksvsns_create_entry(//KVSNS_DIR//)
note over KVSNS: Increment the current inode number
activate KVSNS #FFBBBB
KVSNS -&gt; KVSAL: kvsal_incr_counter(ino_counter)
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(key = &quot;ino_counter&quot;, val)
CLOVIS --&gt; KVSAL: value for the key
note over KVSAL: ino_counter += 1
KVSAL -&gt; CLOVIS: m0kvs_set(key = &quot;ino_counter&quot;, val)
CLOVIS --&gt; KVSAL: error code
KVSAL --&gt; KVSNS: error code
deactivate KVSAL
rnote over KVSNS
    1. Fill in the details in struct stat for new entry
    2. Update stats in KV store
end note
deactivate KVSNS
KVSNS --&gt; FSAL_KVSFS: error code
deactivate KVSNS
rnote over FSAL_KVSFS
    1. Call //kvsns_getattr// to get stats
    2. Allocate file handle and fill in the details
end note
FSAL_KVSFS --&gt; NFS_Server: error code
NFS_Server --&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-dir-rmdir">
<span id="usecase-nfs-dir-rmdir"></span><h3>nfs.dir.rmdir<a class="headerlink" href="#nfs-dir-rmdir" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-b75d0258541c456542927238f377bdcb07bb89f0.png" alt="title Rmdir workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
participant NFS_Server
participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
participant KVSNS
participant KVSAL
participant EXTSTORE
end box
database CLOVIS
NFS_Client -&gt; NFS_Server: rmdir()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_rmdir()
FSAL_KVSFS -&gt; KVSNS: kvsns_rmdir()
activate KVSNS
rnote over KVSNS
1. Get the parent stat info
2. Check write access in stat info
3. Do lookup on parent for new entry
end note
note over KVSNS: Get dentry list for the given dir from KV store
KVSNS -&gt; KVSAL: kvsal_get_list()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(&quot;dir_ino.dentries.*&quot;, val)
CLOVIS -&gt; KVSAL: value for the key
KVSAL -&gt; KVSNS:  value for the key
deactivate KVSAL
rnote over KVSNS #FFAAAA: Fail with //ENOTEMPTY// if entry exists in dentry list
loop #transparent For each element in dentry list
note over KVSNS: Delete the enrty from parent's the dentry list
KVSNS -&gt; KVSAL: kvsal_del()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_del(&quot;parent_ino.dentries.dir_ino&quot;)
CLOVIS -&gt; KVSAL: error code
KVSAL -&gt; KVSNS: error code
deactivate KVSAL
note over KVSNS: Delete the stats for given dir
KVSNS -&gt; KVSAL: kvsal_del()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_del(&quot;dir_ino.stat&quot;)
CLOVIS -&gt; KVSAL: error code
KVSAL -&gt; KVSNS:  error code
deactivate KVSAL
KVSNS -&gt; FSAL_KVSFS:  error code
deactivate KVSNS
FSAL_KVSFS -&gt; NFS_Server: error code
NFS_Server -&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="nfs-dir-readdir">
<span id="usecase-nfs-dir-readdir"></span><h3>nfs.dir.readdir<a class="headerlink" href="#nfs-dir-readdir" title="Permalink to this headline">¶</a></h3>
<p class="plantuml">
<img src="_images/plantuml-edf5f1ae874e9b0bf6a4709fe84e2503ca232ae9.png" alt="title Readdir workflow
participant NFS_Client
box &quot;NFS Ganesha&quot; #LightBlue
participant NFS_Server
participant FSAL_KVSFS
end box
box &quot;KVSFS&quot; #LightGreen
participant KVSNS
participant KVSAL
participant EXTSTORE
end box
database CLOVIS
NFS_Client -&gt; NFS_Server: readdir()
NFS_Server -&gt; FSAL_KVSFS: kvsfs_readdir()
FSAL_KVSFS -&gt; KVSNS: kvsns_readdir()
activate KVSNS
rnote over KVSNS
Check read access for given directory
end note
note over KVSNS: Get dentry list for the given dir from KV store
KVSNS -&gt; KVSAL: kvsal_get_list()
activate KVSAL
KVSAL -&gt; CLOVIS: m0kvs_get(&quot;dir_ino.dentries.*&quot;, val)
CLOVIS -&gt; KVSAL: value for the key
KVSAL -&gt; KVSNS:  value for the key
deactivate KVSAL
loop #transparent For each element in dentry list
note over KVSNS
1.Store the name of file in //kvsns_dentry_t//
2.Get the inode number using the name
from KV store
3.Get the stats for the file using
inode number
4.Store inode number and stats for
a file in //kvsns_dentry_t//
end note
end
KVSNS -&gt; FSAL_KVSFS:  error code
deactivate KVSNS
FSAL_KVSFS -&gt; NFS_Server: error code
NFS_Server -&gt; NFS_Client: error code"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="sns-repreb">
<span id="usecase-sns-repreb"></span><h3>sns.repreb<a class="headerlink" href="#sns-repreb" title="Permalink to this headline">¶</a></h3>
<p>Sns repair and rebalance are implemented as a mero services.
Halon triggers sns repair on drive failure and rebalance on drive replacement.
Repair and rebalance are distributed operations which are performed by every
node in parallel. Various resource contraints can be imposed on sns repair
and rebalance, e.g. memory, cpu or network bandwidth using resource manager.
Presently, only memory bandwidth constraints are imposed using buffer pool and
sliding window algorithm during sns repair and rebalance.</p>
<p class="plantuml">
<img src="_images/plantuml-1d5749454d5088422b3c01f21b6b42edf7614f62.png" alt="participant Halon
participant repreb1
participant repreb2
participant repreb3
participant repreb4
Halon -&gt; repreb1: Repair/rebalance trigger
repreb1 -&gt; repreb1: cm prepare
repreb1 -&gt; repreb1: cm ready
repreb1 -&gt; repreb2: Send initial sliding window
repreb1 -&gt; repreb3: Send initial sliding window
repreb1 -&gt; repreb4: Send initial sliding window
repreb1 -&gt; repreb1: cm start
repreb1 -&gt; Halon: reply start success/failure
Halon -&gt; repreb2: Repair/rebalance trigger
repreb2 -&gt; repreb2: cm prepare
repreb2 -&gt; repreb2: cm ready
repreb2 -&gt; repreb1: Send initial sliding window
repreb2 -&gt; repreb3: Send initial sliding window
repreb2 -&gt; repreb4: Send initial sliding window
repreb2 -&gt; repreb2: cm start
repreb2 -&gt; Halon: reply start success/failure
Halon -&gt; repreb3: Repair/rebalance trigger
repreb3 -&gt; repreb3: cm prepare
repreb3 -&gt; repreb3: cm ready
repreb3 -&gt; repreb1: Send initial sliding window
repreb3 -&gt; repreb2: Send initial sliding window
repreb3 -&gt; repreb4: Send initial sliding window
repreb3 -&gt; repreb3: cm start
repreb3 -&gt; Halon: reply start success/failure
Halon -&gt; repreb4: Repair/rebalance trigger
repreb4 -&gt; repreb4: cm prepare
repreb4 -&gt; repreb4: cm ready
repreb4 -&gt; repreb1: Send initial sliding window
repreb4 -&gt; repreb2: Send initial sliding window
repreb4 -&gt; repreb3: Send initial sliding window
repreb4 -&gt; repreb4: cm start
repreb4 -&gt; Halon: reply start success/failure"/>
</p>
</section>
</section>
<section id="encyclopaedia">
<h2>Encyclopædia<a class="headerlink" href="#encyclopaedia" title="Permalink to this headline">¶</a></h2>
<section id="entity-nfs">
<span id="id11"></span><h3>nfs<a class="headerlink" href="#entity-nfs" title="Permalink to this headline">¶</a></h3>
<p>Diagram shows the deployment of pNFS server over MERO. All the storage server
nodes work as NFS data servers and one of the nodes, takes up NFS metadata
server role. NFS metadata server node may optionally play NFS data server role
(provided the number of IO requests are controlled). NFS ganesha server stack
(user level implementation) is used, which will interface with Clovis which
in turn distributes the IO request to multiple MERO nodes.</p>
<img alt="_images/pNFS_Deployment.png" src="_images/pNFS_Deployment.png" />
<p>Shown below is the software components. NFS ganesha FSAL plugin named KVSFS
provides necessary hooks to plugin into NFS server implementation named KVSNS.
Data operations are redirected through abstraction layer EXT-STORE and metadata
(which uses Key-Value Store) through KVS-AL, which finally invokes corresponding
Clovis operations.</p>
<img alt="_images/pNFS_Architecture.png" src="_images/pNFS_Architecture.png" />
</section>
<section id="fdmi">
<span id="entity-fdmi"></span><h3>fdmi<a class="headerlink" href="#fdmi" title="Permalink to this headline">¶</a></h3>
<p>File Data Manipulation Interface (fdmi) is a scalable <a class="reference external" href="https://en.wikipedia.org/wiki/Publish%E2%80%93subscribe_pattern">publish-subscribe</a> Mero
interface. fdmi is a part of Clovis [<a class="reference internal" href="#entity-clovis">clovis</a>] interface and allows extending
Mero without changes to the core Mero code. By using FDMI external applications
(called <em>fdmi plugins</em> [<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>] or <em>fdmi apps</em> [<a class="reference internal" href="#entity-fdmi-app">fdmi.app</a>]),
potentially created by 3rd parties, can provide new functionality without
affecting performance and consistency of the core system. These applications can
run on dedicated servers, thus achieving the goal of horizontal
scalability. Examples of fdmi plugins are:</p>
<blockquote>
<div><ul class="simple">
<li><p>asynchronous replication within a cluster or between clusters or to a
non-Mero target;</p></li>
<li><p>backup, archive and other <a class="reference external" href="https://en.wikipedia.org/wiki/Information_lifecycle_management">ILM</a>
applications;</p></li>
<li><p>hierarchical storage management;</p></li>
<li><p>tier-management (burst buffer prefetching and destaging), background
compression, de-duplication;</p></li>
<li><p>online indexing;</p></li>
<li><p>compliance checking, logging, audit;</p></li>
<li><p>file system consistency checking.</p></li>
</ul>
</div></blockquote>
<img alt="_images/fdmi.dataflow.png" src="_images/fdmi.dataflow.png" />
<p>When a Mero instance executes a user request, it adds to its local fol [<a href="#id238"><span class="problematic" id="id239">`fol &lt;entity.fol_&gt;`_</span></a>]
a record with the details of the request. An fdmi plugin can define a <em>filter</em>
[<a class="reference internal" href="#entity-fdmi-filter">fdmi.filter</a>] that matches fol records of interest for the plugin by
inspecting their fields. A special fdmi service [<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>], running
within each Mero instance, matches each produced record against all filters and
sends the record to plugins with matching filters. The plugin receives all the
records, generated anywhere in the cluster matching its filters. This allows the
plugin to monitor certain aspects of the cluster activity and to react to them.</p>
<p class="plantuml">
<img src="_images/plantuml-43b10101e531cf2b38eafdf84c4216e592dcc175.png" alt="skinparam ArrowColor Blue
skinparam BoxPadding 10
skinparam ParticipantPadding 5

box &quot;mero core node&quot;
participant source
participant service
participant filter
participant batch
end box

box &quot;plugin node&quot;
participant plugin
end box

plugin -&gt; filter  : construct
filter -&gt; service : register
source -&gt; service : post(record)
service -&gt; filter : matches?(record)
service -&gt; batch  : add(record)
batch   -&gt; plugin : deliver
plugin  -&gt; service : reply(record)
service -&gt; source : put(record)
plugin  -&gt; service : done(record)
service -&gt; source : put(record)"/>
</p>
<p>As a key element of mero scalability architecture, fdmi allows mero core to
remain simple, clear and focused, while providing a framework to support future
features and capabilities, in which they act as tightly integrated
components. Core mero will not have to change to add new features, such as
later-developed functionality to support HSM; instead, an fdmi plugin will be
written. The ability to utilize additional nodes to run fdmi plugins is
important for horizontal scalability and compares favorably with the traditional
architectures, where new features have to be added to existing servers.</p>
<section id="fdmi-vs-posix">
<h4>fdmi vs. POSIX<a class="headerlink" href="#fdmi-vs-posix" title="Permalink to this headline">¶</a></h4>
<p>As a storage-level interface to data, fdmi overcomes the inherent limitations of
POSIX, by enabling plugins to directly manipulate the storage
infrastructure. This direct interaction allows storage applications to implement
changelogs, mirrors, snapshots, indexers and other complex data management
solutions.</p>
<p>As scale increases, ILM features (backup, migration, HSM, replication, etc.) hit
a POSIX “bottleneck”. POSIX is designed for per-file lookups via string-based
hierarchical namespace traversals; this is an extremely inefficient method to
operate on an entire file system. POSIX forces inherently storage-centric
utilities like HSM, replication, backup, and search to use the same
stat/open/read/write/close interface to data as applications use, causing
generally poor performance, scalability, recovery, and administration. In other
words, the fdmi approach to publishing batched records to subscribed users is
singularly effective because no form of scanning works at exascale.</p>
<p>Another problem that emerges at scale is storage application behavior in the
face of failure, either in the storage system it operates upon or in the
application itself. To avoid arbitrary inconsistencies, scalable solutions to
ILM requirements must be tightly integrated with the storage system
implementation, in particular by relying on logging changes and transactional
mechanisms capable of resuming interrupted data management processes.</p>
<p>On a higher level, there is a striking contrast between the file system and
database worlds. In the latter, the domain-specific SQL language underlies most
applications, making them portable (either without or with a modest effort)
between various RDBMS systems. For file systems, the only common language is
POSIX and portable backup or HSM applications are unheard of (except for
POSIX-based solutions, such as tar and rsync, which are not scalable and
generally incorrect). The development of fdmi creates the possibility of an
entirely new market for portable storage applications that are designed and
developed independently from storage systems. To this end, fdmi is portable and
can be implemented on non-Mero systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>component</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>none</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi-source">fdmi.source</a>], [<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>], [<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>],
[<a class="reference internal" href="#entity-fdmi-app">fdmi.app</a>], [<a class="reference internal" href="#entity-fdmi-filter">fdmi.filter</a>], [<a class="reference internal" href="#entity-fdmi-record">fdmi.record</a>],
[<a class="reference internal" href="#entity-fdmi-batch">fdmi.batch</a>], [<a class="reference internal" href="#entity-fdmi-reply">fdmi.reply</a>], [<a class="reference internal" href="#entity-fdmi-done">fdmi.done</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-rpc">rpc</a>], [<a href="#id240"><span class="problematic" id="id241">`fol &lt;entity.fol_&gt;`_</span></a>], [<a href="#id242"><span class="problematic" id="id243">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a href="#id244"><span class="problematic" id="id245">`async.replicator &lt;entity.async.replicator_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><ul class="simple">
<li><p>exactly-one-semantics: fdmi guarantees that each matching record will be
delivered exactly once, in the face of transient failures of Mero
instances. This includes the Mero instances where records are produced and
the instances where plugins execute. Status: not implemented.</p></li>
<li><p>transactional-consistency: optionally, a plugin can request that it is
made a participant of the distributed transaction [<a href="#id246"><span class="problematic" id="id247">`dtm.transaction &lt;entity.dtm.transaction_&gt;`_</span></a>]
to which a record belongs. In this case a failure of the plugin aborts the
transaction and the failure somewhere in the cluster would involve plugins
into recovery [<a href="#id248"><span class="problematic" id="id249">`dtm.recovery &lt;entity.dtm.recovery_&gt;`_</span></a>]. Status: not implemented.</p></li>
</ul>
</dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><ul class="simple">
<li><p>[] support read-only operations (which do not at the moment generate FOL
records)</p></li>
<li><p>[] store filters in an index (rather than in configuration data-base)</p></li>
<li><p>[] define filter language</p></li>
<li><p>[] export publish interface [<a class="reference internal" href="#entity-fdmi-source">fdmi.source</a>] as part of clovis</p></li>
<li><p>[] specify maximal batch size and age as filter parameters</p></li>
</ul>
</dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.google.com/document/d/1xj5BvLeWUBj1_0mwITa_0irFJf9TqBQgllpKZkjAds0">HLD</a></p></li>
<li><p><a class="reference external" href="https://docs.google.com/document/d/1ne7s-fMFKX9eLx8PE4RVBiDm5Z3xDByvAHHYG0-SZSI">high level decomposition</a></p></li>
<li><p><a class="reference external" href="https://docs.google.com/document/d/1FPLqbeExi_vb9h-_WZ0WETY42-kC08IdAyjTG-bwu8I">FDMI Framework and Its APIs</a></p></li>
<li><p><a class="reference external" href="https://docs.google.com/document/d/1weQya-S3b9uW7whD0I1du2MoXoo90gx6w1kCFvGpavQ/edit#heading=h.iqthjxx2ma8u">fdmi section in Mero in prose</a></p></li>
</ul>
</dd>
</dl>
</section>
</section>
<section id="fdmi-source">
<span id="entity-fdmi-source"></span><h3>fdmi.source<a class="headerlink" href="#fdmi-source" title="Permalink to this headline">¶</a></h3>
<p>fdmi source is an abstract interface within fdmi [<a class="reference internal" href="#entity-fdmi">fdmi</a>]. Implementations of
this interface provide new types of records published through
fdmi. Implementation of this interface post new records to the fdmi service
[<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>] for further processing.</p>
<p>Currently the only existing fdmi source implementation is based on fol
[<a href="#id250"><span class="problematic" id="id251">`fol &lt;entity.fol_&gt;`_</span></a>]. It posts fol records to fdmi.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>abstract interface</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>none</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a href="#id252"><span class="problematic" id="id253">`fol &lt;entity.fol_&gt;`_</span></a>], [<a href="#id254"><span class="problematic" id="id255">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><ul class="simple">
<li><p>[] support addb as a source</p></li>
</ul>
</dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="fdmi-record">
<span id="entity-fdmi-record"></span><h3>fdmi.record<a class="headerlink" href="#fdmi-record" title="Permalink to this headline">¶</a></h3>
<p>fdmi record is a structure published and subscribed to by means of fdmi. fdmi
sources [<a class="reference internal" href="#entity-fdmi-source">fdmi.source</a>] produce fdmi records and fdmi delivers these records
to the interested fdmi plugins [<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>].</p>
<p>A record is created within a fdmi source and then posted to the local fdmi
service [<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>].</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>abstract interface</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>none</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="fdmi-service">
<span id="entity-fdmi-service"></span><h3>fdmi.service<a class="headerlink" href="#fdmi-service" title="Permalink to this headline">¶</a></h3>
<p>fdmi service is a mero service [<a href="#id256"><span class="problematic" id="id257">`mero.service &lt;entity.mero.service_&gt;`_</span></a>] that runs within each mero instance
[<a href="#id258"><span class="problematic" id="id259">`mero.instance &lt;entity.mero.instance_&gt;`_</span></a>] and exports fdmi publish-subscribe interface to the fdmi
plugins [<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>].</p>
<p>fdmi service maintains the list of active filters [<a class="reference internal" href="#entity-fdmi-filter">fdmi.filter</a>]. fdmi
sources post records [<a class="reference internal" href="#entity-fdmi-record">fdmi.record</a>] to the service. The service matches
records against the filters. If a record matches a filter, the record is sent to
the plugin, which registered the filter. A record can match multiple filters and
can be sent to multiple plugins. Records are sent to plugins in batches
[<a class="reference internal" href="#entity-fdmi-batch">fdmi.batch</a>] to amortise the cost of network communication at the cost of
increased latency.</p>
<p>The service controls life time of the records, assuring that they exist until
processed by the plugin.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>service</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi-batch">fdmi.batch</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi-record">fdmi.record</a>], [<a class="reference internal" href="#entity-fdmi-source">fdmi.source</a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="fdmi-filter">
<span id="entity-fdmi-filter"></span><h3>fdmi.filter<a class="headerlink" href="#fdmi-filter" title="Permalink to this headline">¶</a></h3>
<p>An fdmi filter is an object created through fdmi [<a class="reference internal" href="#entity-fdmi">fdmi</a>] interface to
identify a sub-set of fdmi records [<a class="reference internal" href="#entity-fdmi-record">fdmi.record</a>]. An fdmi plugin
[<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>] creates a filter and then registers it globally in the
cluster. The filter, after is it registered, is available to all instances of
fdmi service [<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>] and is used by them to select which records
should be sent to the plugin, i.e., which records the plugin has subscribed to.</p>
<p>A plugin can create and register multiple filters. Filters are stored
persistently in a special index, used internally by the fdmi implementation.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>data structure</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi-batch">fdmi.batch</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi-record">fdmi.record</a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="fdmi-plugin">
<span id="entity-fdmi-plugin"></span><h3>fdmi.plugin<a class="headerlink" href="#fdmi-plugin" title="Permalink to this headline">¶</a></h3>
<p>An fdmi plugin is an application [<a href="#id260"><span class="problematic" id="id261">`application &lt;entity.application_&gt;`_</span></a>] that uses fdmi [<a class="reference internal" href="#entity-fdmi">fdmi</a>]
part of clovis [<a class="reference internal" href="#entity-clovis">clovis</a>] interface. Typically, a plugin would be an
executable, linked with the mero library and running on a dedicated node (i.e.,
not on one of the nodes where mero core services [<a href="#id262"><span class="problematic" id="id263">`service &lt;entity.service_&gt;`_</span></a>] are running), but
there is no technical restriction on where the fdmi interface is invoked: a
plugin can at the same time be a mero client [<a class="reference internal" href="#entity-mero-client">mero.client</a>], a front-end
application and so on.</p>
<p>A plugin constructs one or more filters [<a class="reference internal" href="#entity-fdmi-filter">fdmi.filter</a>] to monitor some
aspects of activity in the cluster. fdmi asynchronously delivers to the plugin
all published records [<a class="reference internal" href="#entity-fdmi-record">fdmi.record</a>] matching any of the filters and the
plugin can act on the records in any way.</p>
<p>A simplest plugin would just analyse the records for the purposes of
accumulating some statistics and producing reports.</p>
<p>More complex plugins could execute operations in the cluster (or outside of the
cluster) based on the received records. For example, re-executing received
records in a different cluster would result in a simple replication mechanism.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>application</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi-filter">fdmi.filter</a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="fdmi-reply">
<span id="entity-fdmi-reply"></span><h3>fdmi.reply<a class="headerlink" href="#fdmi-reply" title="Permalink to this headline">¶</a></h3>
<p>An fdmi reply is a notification sent by an fdmi plugin [<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>] back to
the fdmi service [<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>] which sent a record [<a class="reference internal" href="#entity-fdmi-record">fdmi.record</a>] to the
plugin. A reply signalises the service that the plugin has received and accepted
the record and is used the the service for flow control purposes. Reply is
different from a done [<a class="reference internal" href="#entity-fdmi-done">fdmi.done</a>] notification.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>application</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-rpc">rpc</a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>], [<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="fdmi-done">
<span id="entity-fdmi-done"></span><h3>fdmi.done<a class="headerlink" href="#fdmi-done" title="Permalink to this headline">¶</a></h3>
<p>An fdmi done is a notification sent by an fdmi plugin [<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>] back to
the fdmi service [<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>] which sent a record [<a class="reference internal" href="#entity-fdmi-record">fdmi.record</a>] to the
plugin. A done signalises the service that the plugin has completely processed
the record and the service can purge it from its queue. Specifically, the
service won’t resend done records in case of a plugin failure.</p>
<p>Done is different from fdmi reply [<a class="reference internal" href="#entity-fdmi-reply">fdmi.reply</a>].</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>application</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-rpc">rpc</a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>], [<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="fdmi-app">
<span id="entity-fdmi-app"></span><h3>fdmi.app<a class="headerlink" href="#fdmi-app" title="Permalink to this headline">¶</a></h3>
<p>The same as [<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>].</p>
</section>
<section id="fdmi-batch">
<span id="entity-fdmi-batch"></span><h3>fdmi.batch<a class="headerlink" href="#fdmi-batch" title="Permalink to this headline">¶</a></h3>
<p>A batch is a collection of fdmi records [<a class="reference internal" href="#entity-fdmi-record">fdmi.record</a>] in which an fdmi
service [<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>] aggregates all filtered but not still not sent
records for a particular fdmi plugin [<a class="reference internal" href="#entity-fdmi-plugin">fdmi.plugin</a>].</p>
<p>When a record matches a filter [<a class="reference internal" href="#entity-fdmi-filter">fdmi.filter</a>], registered by a plugin, the
service adds the record to the batch for this plugin. When the batch grows
larger than certain size, or is not sent longer than certain internal of time,
it is sent to the plugin and emptied. Batches are the method to achieve
scalability of fdmi publish-subscribe interface by reducing the overhead of
individual record delivery at the expense of increased delivery latency.</p>
<p>The maximal batch size and age are specified as parameters of the filter.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>application</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-fdmi">fdmi</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-fdmi-service">fdmi.service</a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-fdmi">mero.fdmi</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="conf-schema">
<span id="entity-conf-schema"></span><h3>conf.schema<a class="headerlink" href="#conf-schema" title="Permalink to this headline">¶</a></h3>
<p>Mero configuration schema represents relations between types of
configuration objects.</p>
<p>On the diagram below solid lines denote “is parent of” relation,
dashed lines — “refers to” relations, black arrows — one-to-one
relations, white arrows — one-to-many relations.</p>
<div class="graphviz"><img src="_images/graphviz-3e38114e9ad51c86ab399edefcbd505eb12bd2f7.png" alt="digraph mero_conf_schema {
  edge [arrowhead=onormal];  // most relations are &quot;one-to-many&quot;

  root -&gt; &quot;node&quot; [label=nodes];
  root -&gt; site [label=sites];
  root -&gt; pool [label=pools];
  root -&gt; profile [label=&quot;profiles\n(clients only)&quot;];
  root -&gt; fdmi_flt_grp [label=fdmi_flt_grps];
  fdmi_flt_grp -&gt; fdmi_filter [label=filters];

  &quot;node&quot; -&gt; process [label=processes];
  process -&gt; service [label=services];
  service -&gt; sdev [label=sdevs];
  site -&gt; rack [label=racks];
  rack -&gt; enclosure [label=encls];
  enclosure -&gt; controller [label=ctrls];
  controller -&gt; drive [label=drives];

  profile [label=&quot;profile\n(for clients)&quot;];
  profile -&gt; pool [style=dashed];

  pool -&gt; &quot;pool version&quot; [label=pvers];
  &quot;pool version&quot; -&gt; &quot;site-v&quot; [label=sitevs];
  &quot;site-v&quot; -&gt; &quot;rack-v&quot; [label=sitevs];
  &quot;rack-v&quot; -&gt; &quot;enclosure-v&quot; [label=children];
  &quot;enclosure-v&quot; -&gt; &quot;controller-v&quot; [label=children];
  &quot;controller-v&quot; -&gt; &quot;drive-v&quot; [label=children];

  edge [dir=back, weight=0, style=dashed, arrowhead=normal];
  &quot;node&quot; -&gt; controller;
  site -&gt; &quot;site-v&quot;;
  rack -&gt; &quot;rack-v&quot;;
  enclosure -&gt; &quot;enclosure-v&quot;;
  controller -&gt; &quot;controller-v&quot;;
  drive -&gt; &quot;drive-v&quot;;
  sdev -&gt; drive [dir=both];
}" class="graphviz" /></div>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>vvv</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-pool">pool</a>], [<a href="#id264"><span class="problematic" id="id265">`profile &lt;entity.profile_&gt;`_</span></a>], [<a href="#id266"><span class="problematic" id="id267">`mero.process &lt;entity.mero.process_&gt;`_</span></a>], [<a href="#id268"><span class="problematic" id="id269">`mero.service &lt;entity.mero.service_&gt;`_</span></a>],
[<a href="#id270"><span class="problematic" id="id271">`site &lt;entity.site_&gt;`_</span></a>], [<a class="reference internal" href="#entity-rack">rack</a>], [<a href="#id272"><span class="problematic" id="id273">`enclosure &lt;entity.enclosure_&gt;`_</span></a>], [<a href="#id274"><span class="problematic" id="id275">`controller &lt;entity.controller_&gt;`_</span></a>], [<a href="#id276"><span class="problematic" id="id277">`drive &lt;entity.drive_&gt;`_</span></a>],
[<a href="#id278"><span class="problematic" id="id279">`device &lt;entity.device_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="dix-client">
<span id="entity-dix-client"></span><h3>dix.client<a class="headerlink" href="#dix-client" title="Permalink to this headline">¶</a></h3>
<p>Distributed index client provides an interface to access and modify
distributed indices. It uses CAS client internally and extends its
functionality by providing indices distribution.</p>
</section>
<section id="dix-cm">
<span id="entity-dix-cm"></span><h3>dix.cm<a class="headerlink" href="#dix-cm" title="Permalink to this headline">¶</a></h3>
<p>DIX copy machine is a state machine living on each CAS node, which
performs data restructuring and handles device, container, node, etc.
failures.</p>
</section>
<section id="dix-cm-cp">
<span id="entity-dix-cm-cp"></span><h3>dix.cm.cp<a class="headerlink" href="#dix-cm-cp" title="Permalink to this headline">¶</a></h3>
<p>Copy packet is a special type of FOP, which arrives on corresponding nodes
where [<a class="reference internal" href="#entity-dix-cm">dix.cm</a>] lives and provides replica of data from
other node.</p>
</section>
<section id="dix-cm-iter">
<span id="entity-dix-cm-iter"></span><h3>dix.cm.iter<a class="headerlink" href="#dix-cm-iter" title="Permalink to this headline">¶</a></h3>
<p>Algorithm, which iterates over all [<a class="reference internal" href="#entity-dix-index">dix.index</a>] and all
[<a class="reference internal" href="#entity-dix-key">dix.key</a>] of Mero filesystem.</p>
</section>
<section id="dix-cm-repair">
<span id="entity-dix-cm-repair"></span><h3>dix.cm.repair<a class="headerlink" href="#dix-cm-repair" title="Permalink to this headline">¶</a></h3>
<p>Assume N = 1, K = 2 and two spare CAS services [<a class="reference internal" href="#entity-dix-cas">dix.cas</a>] are
available. In case of CAS failure, Repair operation will copy the
meta-data to spare from the replicas. There can be a update of
meta-data in spare CAS service from different replicas.</p>
</section>
<section id="dix-cm-rebalance">
<span id="entity-dix-cm-rebalance"></span><h3>dix.cm.rebalance<a class="headerlink" href="#dix-cm-rebalance" title="Permalink to this headline">¶</a></h3>
<p>In Rebalance operation meta-data from spare is copied to the restarted
CAS service node.</p>
</section>
<section id="dix-cm-direct-rebalance">
<span id="entity-dix-cm-direct-rebalance"></span><h3>dix.cm.direct_rebalance<a class="headerlink" href="#dix-cm-direct-rebalance" title="Permalink to this headline">¶</a></h3>
<p>After catalogue service restart indices will be restored using direct
rebalance from other replica services.</p>
</section>
<section id="dix-cm-trigger">
<span id="entity-dix-cm-trigger"></span><h3>dix.cm.trigger<a class="headerlink" href="#dix-cm-trigger" title="Permalink to this headline">¶</a></h3>
<p>Trigger foms are used to start repair, rebalance or direct rebalance.
It is triggered by halon by sending a trigger fop for the corresponding
operation.</p>
</section>
<section id="dix-layout">
<span id="entity-dix-layout"></span><h3>dix.layout<a class="headerlink" href="#dix-layout" title="Permalink to this headline">¶</a></h3>
<p>A hash function, imask and pool version are used to create layout, and is used
to distribute indices uniformly.</p>
</section>
<section id="dix-cas">
<span id="entity-dix-cas"></span><h3>dix.cas<a class="headerlink" href="#dix-cas" title="Permalink to this headline">¶</a></h3>
<p>Catalogue service (cas) is a Mero service exporting key-value
catalogues (indices). Users can access catalogues by sending
appropriate fops to an instance of the catalogue service. Externally,
a catalogue is a collection of key-value pairs, called records. A user
can insert and delete records, lookup records by key and iterate
through records in a certain order. A catalogue service does not
interpret keys or values, (except that keys are ordered as
bit-strings)—semantics are left to users.</p>
</section>
<section id="dix-cas-request">
<span id="entity-dix-cas-request"></span><h3>dix.cas.request<a class="headerlink" href="#dix-cas-request" title="Permalink to this headline">¶</a></h3>
<p>Representation of a request to remote CAS service.  Contains data to
be send over dix.cas.fops and IPC object to control the flow of this
transmission (dix.cas.rop).</p>
</section>
<section id="dix-cas-rop">
<span id="entity-dix-cas-rop"></span><h3>dix.cas.rop<a class="headerlink" href="#dix-cas-rop" title="Permalink to this headline">¶</a></h3>
<p>Introduces asynchronous wait mechanism to sending dix.cas.requests.</p>
</section>
<section id="dix-n">
<span id="entity-dix-n"></span><h3>dix.N<a class="headerlink" href="#dix-n" title="Permalink to this headline">¶</a></h3>
<p>(N + K) way replication done for meta-data.</p>
</section>
<section id="dix-p">
<span id="entity-dix-p"></span><h3>dix.P<a class="headerlink" href="#dix-p" title="Permalink to this headline">¶</a></h3>
<p>Poolwidth of CAS [<a class="reference internal" href="#entity-dix-cas">dix.cas</a>] services over which meta-data will be
distributed.</p>
</section>
<section id="dix-k">
<span id="entity-dix-k"></span><h3>dix.K<a class="headerlink" href="#dix-k" title="Permalink to this headline">¶</a></h3>
<p>It is the replication factor i.e. number of CAS [<a class="reference internal" href="#entity-dix-cas">dix.cas</a>] service
failures supported.</p>
</section>
<section id="dix-meta">
<span id="entity-dix-meta"></span><h3>dix.meta<a class="headerlink" href="#dix-meta" title="Permalink to this headline">¶</a></h3>
<p>Filesystem metadata can be accessed with dix sepcial functions,
implemented using generic ‘dix gets and puts’. This metadata is stored
inside three indeces called ‘root’, ‘layout’ and ‘layout-desc’. There
are three groups of functions to work with ‘root’, ‘layout’ and
‘layout-descr’ indices respectively. Operations for ‘root’ index are
synchronous, since they intended to be executed during provisioning.
Operations for ‘layout’, ‘layout-descr’ indices are asynchronous. User
can wait for asynchronous operation completion.</p>
</section>
<section id="dix-req">
<span id="entity-dix-req"></span><h3>dix.req<a class="headerlink" href="#dix-req" title="Permalink to this headline">¶</a></h3>
<p>DIX request is a set of keys, values and other IPC-related structures
which are used to access metadata on distributed CASes. DIX requests
provide the following functions: Create new index, Lookup component
catalogues existence for an index, Delete an index, Given start keys,
get records with the next keys from an index, Get records with the
given keys from an index, Put given records in an index, Delete
records with the given keys from an index.</p>
</section>
<section id="dix-key">
<span id="entity-dix-key"></span><h3>dix.key<a class="headerlink" href="#dix-key" title="Permalink to this headline">¶</a></h3>
<p>DIX operates with a bunch of keys that can be retrieved through the
DIX interface.  User supplies an array of records representing keys
for dix.req operation. Eventually, these keys come into CAS service,
their values are retrieved from internal catalogues and sent back to
the user.</p>
</section>
<section id="dix-val">
<span id="entity-dix-val"></span><h3>dix.val<a class="headerlink" href="#dix-val" title="Permalink to this headline">¶</a></h3>
<p>User supplies an array of records representing vals for dix.req
operation. See dix.key.</p>
</section>
<section id="dix-index">
<span id="entity-dix-index"></span><h3>dix.index<a class="headerlink" href="#dix-index" title="Permalink to this headline">¶</a></h3>
<p>Distributed index is an ordered container of key-value records.</p>
</section>
<section id="dix-root">
<span id="entity-dix-root"></span><h3>dix.root<a class="headerlink" href="#dix-root" title="Permalink to this headline">¶</a></h3>
<p>It’s a top level index which contains information about other indices.
It is created during bootstrap with m0dixinit.</p>
</section>
<section id="dix-imask">
<span id="entity-dix-imask"></span><h3>dix.imask<a class="headerlink" href="#dix-imask" title="Permalink to this headline">¶</a></h3>
<p>Identity mask is used to distibute meta-data index in addition to key.
If infinity identity mask is specified then key is used as it is and is
used for generic indices.</p>
</section>
<section id="dix-item">
<span id="entity-dix-item"></span><h3>dix.item<a class="headerlink" href="#dix-item" title="Permalink to this headline">¶</a></h3>
<p>Array of request items contexts. For index operations the item is
individual index, for record operations the item is individual record.</p>
</section>
<section id="dix-pver">
<span id="entity-dix-pver"></span><h3>dix.pver<a class="headerlink" href="#dix-pver" title="Permalink to this headline">¶</a></h3>
<p>DIX client [<a class="reference internal" href="#entity-dix-client">dix.client</a>] uses this pool version to distribute
meta-data among catalogue services.</p>
</section>
<section id="dix-cas-fop">
<span id="entity-dix-cas-fop"></span><h3>dix.cas.fop<a class="headerlink" href="#dix-cas-fop" title="Permalink to this headline">¶</a></h3>
<p>DIX client [<a class="reference internal" href="#entity-dix-client">dix.client</a>] uses cas fop to send or receive meta-data
from CAS [<a class="reference internal" href="#entity-dix-cas">dix.cas</a>].</p>
</section>
<section id="dix-di">
<span id="entity-dix-di"></span><h3>dix.di<a class="headerlink" href="#dix-di" title="Permalink to this headline">¶</a></h3>
<p>Store checksum as part of key value while creating the record and
verify it while reading from the KVS.</p>
</section>
<section id="cas">
<span id="entity-cas"></span><h3>cas<a class="headerlink" href="#cas" title="Permalink to this headline">¶</a></h3>
<p>Catalogue service (CAS) is a local (not distributed) Mero service
exporting key-value catalogues (indices). Users can access catalogues
by sending appropriate fops to an instance of the catalogue
service. Externally, a catalogue is a collection of key-value pairs,
called records. A user can insert and delete records, lookup records
by key and iterate through records in a certain order.</p>
</section>
<section id="unit">
<span id="entity-unit"></span><h3>unit<a class="headerlink" href="#unit" title="Permalink to this headline">¶</a></h3>
<p>Unit is a basic block of data using which mero will distribute data
using layouts.</p>
</section>
<section id="checksum">
<span id="entity-checksum"></span><h3>checksum<a class="headerlink" href="#checksum" title="Permalink to this headline">¶</a></h3>
<p>Checksum is computed using CRC-32 for each unit of data.</p>
</section>
<section id="parity-group">
<span id="entity-parity-group"></span><h3>parity.group<a class="headerlink" href="#parity-group" title="Permalink to this headline">¶</a></h3>
<p>Data is divided into a parity groups having (N + 2K) units each.</p>
</section>
<section id="mero-client">
<span id="entity-mero-client"></span><h3>mero.client<a class="headerlink" href="#mero-client" title="Permalink to this headline">¶</a></h3>
<p>Mero client can connect to configuration and halon and fetches all the
latest state from them. Then it can issue data or meta-data requests
to mero.  Mero client could be a clovis api user or fdmi plugin or a
balancer.</p>
</section>
<section id="entity-halon">
<span id="id13"></span><h3>halon<a class="headerlink" href="#entity-halon" title="Permalink to this headline">¶</a></h3>
<p>Halon is a software solution for high-availability of large clusters
and real-time automated recovery.</p>
<p>XXX</p>
</section>
<section id="interface-export">
<span id="entity-interface-export"></span><h3>interface.export<a class="headerlink" href="#interface-export" title="Permalink to this headline">¶</a></h3>
<p>Use adapt for io, sns erasure coding computation.</p>
</section>
<section id="adapt-md">
<span id="entity-adapt-md"></span><h3>adapt.md<a class="headerlink" href="#adapt-md" title="Permalink to this headline">¶</a></h3>
<p>Managing of md pool drives in pods also use adapt for checksum
computation if available.</p>
</section>
<section id="adapt-drivesets">
<span id="entity-adapt-drivesets"></span><h3>adapt.drivesets<a class="headerlink" href="#adapt-drivesets" title="Permalink to this headline">¶</a></h3>
<p>Use adapt for managing subset of drives in pods seaparetely.</p>
</section>
<section id="io-checksum">
<span id="entity-io-checksum"></span><h3>io.checksum<a class="headerlink" href="#io-checksum" title="Permalink to this headline">¶</a></h3>
<p>Compute the checksum for each unit of data and send it to the receiver
before the data, so that checksum can be verified and network
corruption can be detected. Similarly also store checksum for each
unit as part of AD meta-data, which can be verified during read
operation.</p>
</section>
<section id="misdirectedwrite-md">
<span id="entity-misdirectedwrite-md"></span><h3>misdirectedwrite.md<a class="headerlink" href="#misdirectedwrite-md" title="Permalink to this headline">¶</a></h3>
<p>During put Key value operation, if the keys may get changed due to
some network or memory corruption then records are stored in some
different location. It may corrupt the the records already present. So
every put opration should check the sanity of keys using checksum or
protection tag.</p>
</section>
<section id="ios">
<span id="entity-ios"></span><h3>ios<a class="headerlink" href="#ios" title="Permalink to this headline">¶</a></h3>
<p>IO service is a mero service which cater READ/WRITE object data operations. It
also services COB meta-data operations like CREATE, DELETE, TRUNCATE, GETATTR,
and SETATTR. IO service use RDMA to copy data from/to client with the help of
pre-allocated and pre-registred memory buffers which registered with RDMA hardware.</p>
<p class="plantuml">
<img src="_images/plantuml-46e0ead6e62e6b2714ed940d0373471d9890fe86.png" alt="title IO service READ operation

participant &quot;Mero client&quot; as C
participant &quot;Bulk client&quot; as BC
participant &quot;Bulk server&quot; as BS
participant IOservice as ios
participant &quot;Buffer pool&quot; as BP
participant STOB as S

C -&gt; BC : Store network buffers
C -&gt;&gt; ios : IO fop
note over ios : BE transaction\nopen
loop &quot;buffer discriptors&quot;
    ios -&gt; BP : acquire buffers
    note over ios : FOM goes to wait till\nbuffers available
    ios &lt;&lt;-- BP : Got buffers
    loop network buffers
        ios -&gt; S : Initiate STOB IO
        ios &lt;- S : STOB IO Launched
        activate S
    end
    note over ios : FOM goes to\nwait queue
    S -[#red]&gt; : &lt;font color=red&gt;&lt;b&gt; Drive Transient\n&lt;font color=red&gt;&lt;b&gt;Failure to HA
    destroy S
    loop network buffers
        ios &lt;&lt;-- S : STOB IO complete
    end
    note over ios : FOM wakeup
    loop network buffers
        BS &lt;- ios : Load network buffer
        BS -&gt; ios : Loaded network buffers
    end
    note over ios : FOM goes to\nwait queue
    BC &lt;&lt;- BS : RDMA transfer
    BC &lt;&lt;- BS : RDMA transfer
    BC &lt;&lt;- BS : RDMA transfer
    loop network buffers
        BS --&gt;&gt; ios : Zero copy complete
    end
    note over ios : FOM wakeup
    ios -&gt; BP : Release buffers
end
note over ios : BE transaction\ndone
C &lt;&lt;-- ios : IO reply fop"/>
</p>
<p class="plantuml">
<img src="_images/plantuml-f84be88128acbd0e26aa86734bf28045005de87f.png" alt="title IO service WRITE operation

participant &quot;Mero client&quot; as C
participant &quot;Bulk client&quot; as BC
participant &quot;Bulk server&quot; as BS
participant IOservice as ios
participant &quot;Buffer pool&quot; as BP
participant STOB as S

C -&gt; BC : Store network buffers
C -&gt;&gt; ios : IO fop
note over ios : BE transaction\nopen
loop &quot;buffer discriptors&quot;
    ios -&gt; BP : acquire buffers
    note over ios : FOM goes to wait till\nbuffers available
    ios &lt;&lt;-- BP : Got buffers
    loop network buffers
        BS &lt;- ios : Load network buffer
        BS -&gt; ios : Loaded network buffers
    end
    note over ios : FOM goes to\nwait queue
    BC -&gt;&gt; BS : RDMA transfer
    BC -&gt;&gt; BS : RDMA transfer
    BC -&gt;&gt; BS : RDMA transfer
    loop network buffers
        BS --&gt;&gt; ios : Zero copy complete
    end
    note over ios : FOM wakeup
    loop network buffers
        ios -&gt; S : Initiate STOB IO
        ios &lt;- S : STOB IO Launched
        activate S
    end
    note over ios : FOM goes to\nwait queue
    S -[#red]&gt; : &lt;font color=red&gt;&lt;b&gt; Drive Transient\n&lt;font color=red&gt;&lt;b&gt;Failure to HA
    destroy S
    loop network buffers
        ios &lt;&lt;-- S : STOB IO complete
    end
    note over ios : FOM wakeup
    ios -&gt; BP : Release buffers
end
note over ios : BE transaction\ndone
C &lt;&lt;-- ios : IO reply fop"/>
</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>component</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-ios">ios</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-ios-bufferpool">ios.bufferpool</a>], [<a class="reference internal" href="#entity-ios-rdma">ios.rdma</a>], [<a class="reference internal" href="#entity-ios-stobio">ios.stobio</a>],
[<a class="reference internal" href="#entity-ios-cobdomain">ios.cobdomain</a>], [<a class="reference internal" href="#entity-ios-locality">ios.locality</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p>[<a href="#id280"><span class="problematic" id="id281">`_usecase.clovis.multi-site.create &lt;entity._usecase.clovis.multi-site.create_&gt;`_</span></a>],
[<a href="#id282"><span class="problematic" id="id283">`_usecase.clovis.multi-site.write &lt;entity._usecase.clovis.multi-site.write_&gt;`_</span></a>],
[<a href="#id284"><span class="problematic" id="id285">`_usecase.clovis.multi-site.read &lt;entity._usecase.clovis.multi-site.read_&gt;`_</span></a>],
[<a href="#id286"><span class="problematic" id="id287">`_usecase.clovis.multi-site.delete &lt;entity._usecase.clovis.multi-site.delete_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>rajanikant</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-rpc">rpc</a>], [<a class="reference internal" href="#entity-rdma">rdma</a>], [<a class="reference internal" href="#entity-stob">stob</a>], [<a href="#id288"><span class="problematic" id="id289">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="ios-bufferpool">
<span id="entity-ios-bufferpool"></span><h3>ios.bufferpool<a class="headerlink" href="#ios-bufferpool" title="Permalink to this headline">¶</a></h3>
<p>Buffer pool is pre-allocated and pre-registered memory buffers. These buffers
address are registered with RDMA hardware. IO service create, initialise and
make provision for configured number of buffers for network domain. IO service
request for batch of buffers, and initiate RDMA data transfer with acquired
buffers. It start accumulate buffers till it manage to get required numbers of
buffers and start releasing as data transfer completes. Buffer pool exports
asynchronus interface to acquire buffers. IO service put IO FOM into wait queue
if buffers not ava</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>none</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-ios-bufferpool">ios.bufferpool</a>], [<a class="reference internal" href="#entity-ios-rdma">ios.rdma</a>], [<a class="reference internal" href="#entity-ios-stobio">ios.stobio</a>],
[<a class="reference internal" href="#entity-ios-cobdomain">ios.cobdomain</a>], [<a class="reference internal" href="#entity-ios-locality">ios.locality</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>rajanikant</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-rpc">rpc</a>], [<a class="reference internal" href="#entity-rdma">rdma</a>], [<a class="reference internal" href="#entity-stob">stob</a>], [<a href="#id290"><span class="problematic" id="id291">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="ios-rdma">
<span id="entity-ios-rdma"></span><h3>ios.rdma<a class="headerlink" href="#ios-rdma" title="Permalink to this headline">¶</a></h3>
<p>IO service use bulk transfer mechanism implemented on the top of lnet (Lustre
Networking module). It use active/passive send/receive network queues to initiate
data transfer. Server act as active side and client as passive side. Client
stores network buffers to passive queues and server push/pull for READ/WRITE
respectively. IO service put IO FOM to wait queue while RDMA mechanism transfer
buffers from client to server and moves to run queue on completion event.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>none</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>rajanikant</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-rpc">rpc</a>], [<a class="reference internal" href="#entity-rdma">rdma</a>], [<a href="#id292"><span class="problematic" id="id293">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="ios-stobio">
<span id="entity-ios-stobio"></span><h3>ios.stobio<a class="headerlink" href="#ios-stobio" title="Permalink to this headline">¶</a></h3>
<p>STOB IO is asynchronous direct io operation for storage objects. IO service builds
an IO operation description and queues it against a storage object. IO completion
or failure notification is done by signalling to IO service supplied channel (an
instance of m0_chan). IO service launch io operation batch by batch depending on
available batch of acquired network buffer. IO service put IO FOM to wait queue
while STOB IO going on and move it to run queue on io completion event from STOB
IO.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>none</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>rajanikant</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-balloc">balloc</a>], [<a href="#id294"><span class="problematic" id="id295">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="ios-cobdomain">
<span id="entity-ios-cobdomain"></span><h3>ios.cobdomain<a class="headerlink" href="#ios-cobdomain" title="Permalink to this headline">¶</a></h3>
<p>Component object (COB) is a component (stripe) of a file, referencing a single
storage object and containing metadata describing the object. Mero keep COB for
object in [<a class="reference internal" href="#entity-be">be</a>]. This is on separate meta-data drive (other than data drive).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>none</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-ios-cobdomain-cob">ios.cobdomain.cob</a>], [<a class="reference internal" href="#entity-ios-cobdomain-crow">ios.cobdomain.crow</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>rajanikant</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-be">be</a>], [<a href="#id296"><span class="problematic" id="id297">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="ios-cobdomain-cob">
<span id="entity-ios-cobdomain-cob"></span><h3>ios.cobdomain.cob<a class="headerlink" href="#ios-cobdomain-cob" title="Permalink to this headline">¶</a></h3>
<p>Component object (COB) is a component (stripe) of a file, referencing a single
storage object and containing metadata describing the object. IO service create
cob for mero object in [<a class="reference internal" href="#entity-be">be</a>]. IO service also keep object attributes like -</p>
<ul class="simple">
<li><p>namespace information: parent object id, name, links, pool version</p></li>
<li><p>file attributes: owner/mode/group, size, m/a/ctime, acls</p></li>
</ul>
<p>IO service serve following cob operation like create, delete, truncate, get attr
setattr.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-ios-cobdomain">ios.cobdomain</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>rajanikant</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-rpc">rpc</a>], [<a class="reference internal" href="#entity-rdma">rdma</a>], [<a class="reference internal" href="#entity-stob">stob</a>], [<a href="#id298"><span class="problematic" id="id299">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="ios-cobdomain-crow">
<span id="entity-ios-cobdomain-crow"></span><h3>ios.cobdomain.crow<a class="headerlink" href="#ios-cobdomain-crow" title="Permalink to this headline">¶</a></h3>
<p>Component object operation are initiated by user before creating objects. But cob
create operation can be differed till data write on particular object. This is
create on write. IO service create COB on WRITE require.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-ios-cobdomain">ios.cobdomain</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>rajanikant</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a href="#id300"><span class="problematic" id="id301">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="ios-locality">
<span id="entity-ios-locality"></span><h3>ios.locality<a class="headerlink" href="#ios-locality" title="Permalink to this headline">¶</a></h3>
<p>A locality is a partition of computational resources dedicated to fom execution
on the node. So while creation of any FOM one locality is assigned to it and it
is there for lifetime of FOM. Some user need to provide interface to select
locality for particular FOM. IO service select locality by hashing file identifier
to distribute foms to execute on different locality.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>none</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>rajanikant</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a href="#id302"><span class="problematic" id="id303">`addb &lt;entity.addb_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="entity-provisioner">
<span id="id14"></span><h3>provisioner<a class="headerlink" href="#entity-provisioner" title="Permalink to this headline">¶</a></h3>
</section>
<section id="provisioner-node">
<span id="entity-provisioner-node"></span><h3>provisioner.node<a class="headerlink" href="#provisioner-node" title="Permalink to this headline">¶</a></h3>
</section>
<section id="provisioner-node-role">
<span id="entity-provisioner-node-role"></span><h3>provisioner.node.role<a class="headerlink" href="#provisioner-node-role" title="Permalink to this headline">¶</a></h3>
</section>
<section id="provisioner-re-image">
<span id="entity-provisioner-re-image"></span><h3>provisioner.re.image<a class="headerlink" href="#provisioner-re-image" title="Permalink to this headline">¶</a></h3>
</section>
<section id="provisioner-node-network">
<span id="entity-provisioner-node-network"></span><h3>provisioner.node.network<a class="headerlink" href="#provisioner-node-network" title="Permalink to this headline">¶</a></h3>
</section>
<section id="provisioner-node-service">
<span id="entity-provisioner-node-service"></span><h3>provisioner.node.service<a class="headerlink" href="#provisioner-node-service" title="Permalink to this headline">¶</a></h3>
</section>
<section id="provisioner-package">
<span id="entity-provisioner-package"></span><h3>provisioner.package<a class="headerlink" href="#provisioner-package" title="Permalink to this headline">¶</a></h3>
</section>
<section id="sale">
<span id="entity-sale"></span><h3>sale<a class="headerlink" href="#sale" title="Permalink to this headline">¶</a></h3>
</section>
<section id="manufacturing">
<span id="entity-manufacturing"></span><h3>manufacturing<a class="headerlink" href="#manufacturing" title="Permalink to this headline">¶</a></h3>
</section>
<section id="shipment">
<span id="entity-shipment"></span><h3>shipment<a class="headerlink" href="#shipment" title="Permalink to this headline">¶</a></h3>
</section>
<section id="assembly">
<span id="entity-assembly"></span><h3>assembly<a class="headerlink" href="#assembly" title="Permalink to this headline">¶</a></h3>
</section>
<section id="operation">
<span id="entity-operation"></span><h3>operation<a class="headerlink" href="#operation" title="Permalink to this headline">¶</a></h3>
</section>
<section id="eol">
<span id="entity-eol"></span><h3>eol<a class="headerlink" href="#eol" title="Permalink to this headline">¶</a></h3>
</section>
<section id="eol-secure-delete">
<span id="entity-eol-secure-delete"></span><h3>eol.secure.delete<a class="headerlink" href="#eol-secure-delete" title="Permalink to this headline">¶</a></h3>
</section>
<section id="be">
<span id="entity-be"></span><h3>be<a class="headerlink" href="#be" title="Permalink to this headline">¶</a></h3>
<p>Meta-data back-end (BE) is a module presenting an interface for a transactional
local meta-data storage. BE users manipulate and access meta-data structures in
memory. BE maps this memory to persistent storage. User groups meta-data updates
in transactions [<a class="reference internal" href="#entity-be-tx">be.tx</a>]. BE guarantees that transactions are atomic in the
face of process failures. BE provides support for a few frequently used
data-structures: double linked list [<a class="reference internal" href="#entity-be-list">be.list</a>], B-tree [<a class="reference internal" href="#entity-be-btree">be.btree</a>] and
extmap [<a class="reference internal" href="#entity-be-extmap">BE.extmap</a>].</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>component</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a href="#id304"><span class="problematic" id="id305">`mero &lt;entity.mero_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-be-tx">be.tx</a>], [<a class="reference internal" href="#entity-be-credit">be.credit</a>], [<a class="reference internal" href="#entity-be-seg">be.seg</a>], [<a class="reference internal" href="#entity-be-reg">be.reg</a>],
[<a class="reference internal" href="#entity-be-domain">be.domain</a>], [<a class="reference internal" href="#entity-be-engine">be.engine</a>], [<a class="reference internal" href="#entity-be-group">be.group</a>], [<a class="reference internal" href="#entity-be-list">be.list</a>],
[<a class="reference internal" href="#entity-be-allocator">be.allocator</a>], [<a class="reference internal" href="#entity-be-alloc-oom">be.alloc.oom</a>], [<a class="reference internal" href="#entity-be-btree">be.btree</a>],
[<a class="reference internal" href="#entity-be-extmap">be.extmap</a>], [<a class="reference internal" href="#entity-be-paged">be.paged</a>], [<a class="reference internal" href="#entity-be-io">be.io</a>], [<a class="reference internal" href="#entity-be-log">be.log</a>],
[<a class="reference internal" href="#entity-be-recovery">be.recovery</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>max, anatoliy, dpodgorniy</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-stob">stob</a>], [<a href="#id306"><span class="problematic" id="id307">`reqh &lt;entity.reqh_&gt;`_</span></a>], [<a href="#id308"><span class="problematic" id="id309">`sm &lt;entity.sm_&gt;`_</span></a>], [<a href="#id310"><span class="problematic" id="id311">`fom &lt;entity.fom_&gt;`_</span></a>], [<a href="#id312"><span class="problematic" id="id313">`xcode &lt;entity.xcode_&gt;`_</span></a>], [<a href="#id314"><span class="problematic" id="id315">`addb &lt;entity.addb_&gt;`_</span></a>],
[<a href="#id316"><span class="problematic" id="id317">`ha &lt;entity.ha_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero-be">mero.be</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.google.com/document/d/1z2SY_6x6gD1QylVOfRx0HIun2YcVOhOeZY4-qsnHbp8/edit">HLD of meta-data back-end</a></p></li>
<li><p><a class="reference external" href="https://docs.google.com/document/d/1uwmzKU8fbc2BOgEAQP-h_UScG8kdZ6GU7-yCIVxpAII/edit">Mero meta-data back-end guide</a></p></li>
<li><p><a class="reference external" href="https://docs.google.com/presentation/d/1XEPZDvgpidjYh8ZgVoeP3Sdq3AN5cKW92L4hbAPYU90/edit">BE - The metadata backend</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="be-tx">
<span id="entity-be-tx"></span><h3>be.tx<a class="headerlink" href="#be-tx" title="Permalink to this headline">¶</a></h3>
<p>A transaction is a collection of updates. User adds an update to a transaction
by capturing the update region [<a class="reference internal" href="#entity-be-reg">be.reg</a>]. User explicitly closes a
transaction. BE guarantees that a closed transaction is atomic with respect to
process crashes that happen after transaction close call returns. That is,
after such a crash, either all or none of transaction updates will be present
in the segment [<a class="reference internal" href="#entity-be-seg">be.seg</a>] memory when the segment is opened next time. If a
process crashes before a transaction closes, BE guarantees that none of
transaction updates will be present in the segment memory (see BE recovery
[<a class="reference internal" href="#entity-be-recovery">be.recovery</a>]).</p>
</section>
<section id="be-tx-payload">
<span id="entity-be-tx-payload"></span><h3>be.tx.payload<a class="headerlink" href="#be-tx-payload" title="Permalink to this headline">¶</a></h3>
<p>A memory buffer associated with the transaction [<a class="reference internal" href="#entity-be-tx">be.tx</a>]. It’s supposed to
be filled by the user. The payload is available to the user during the BE
recovery [<a class="reference internal" href="#entity-be-recovery">be.recovery</a>].</p>
</section>
<section id="be-credit">
<span id="entity-be-credit"></span><h3>be.credit<a class="headerlink" href="#be-credit" title="Permalink to this headline">¶</a></h3>
<p>A credit is a measure of a group of updates. A credit is a pair (nr, size),
where nr is the number of updates and size is total size in bytes of modified
regions.</p>
</section>
<section id="be-seg">
<span id="entity-be-seg"></span><h3>be.seg<a class="headerlink" href="#be-seg" title="Permalink to this headline">¶</a></h3>
<p>A segment is a stob [<a class="reference internal" href="#entity-stob">stob</a>] mapped to an extent in process address space. Each address
in the extent uniquely corresponds to the offset in the stob and vice versa.
Stob is divided into blocks of fixed size. Memory extent is divided into pages
of fixed size. Page size is a multiple of block size (it follows that stob size
is a multiple of page size). At a given moment in time, some pages are
up-to-date (their contents is the same as of the corresponding stob blocks) and
some are dirty (their contents was modified relative to the stob blocks). In
the initial implementation all pages are up-to-date, when the segment is
opened. In the later versions, pages will be loaded dynamically on demand. The
memory extent to which a segment is mapped is called segment memory;</p>
</section>
<section id="be-reg">
<span id="entity-be-reg"></span><h3>be.reg<a class="headerlink" href="#be-reg" title="Permalink to this headline">¶</a></h3>
<p>A region is an extent within segment memory.  A (meta-data) update is a
modification of some region;</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>data structure</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-be">be</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>max, anatoliy, dpodgorniy</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.google.com/document/d/1z2SY_6x6gD1QylVOfRx0HIun2YcVOhOeZY4-qsnHbp8/edit">HLD of meta-data back-end</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="be-domain">
<span id="entity-be-domain"></span><h3>be.domain<a class="headerlink" href="#be-domain" title="Permalink to this headline">¶</a></h3>
<p>The top-level BE [<a class="reference internal" href="#entity-be">be</a>] data structure. Contains everything necessary to run
BE.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>data structure</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-be">be</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-be-engine">be.engine</a>], [<a class="reference internal" href="#entity-be-paged">be.paged</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>max, anatoliy, dpodgorniy</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="be-engine">
<span id="entity-be-engine"></span><h3>be.engine<a class="headerlink" href="#be-engine" title="Permalink to this headline">¶</a></h3>
<p>BE transaction engine.</p>
</section>
<section id="be-group">
<span id="entity-be-group"></span><h3>be.group<a class="headerlink" href="#be-group" title="Permalink to this headline">¶</a></h3>
<p>Transaction group is a collection of transactions [<a class="reference internal" href="#entity-be-tx">be.tx</a>] that are written
to the log [<a class="reference internal" href="#entity-be-log">be.log</a>] and recovered [<a class="reference internal" href="#entity-be-recovery">be.recovery</a>] together.</p>
</section>
<section id="be-list">
<span id="entity-be-list"></span><h3>be.list<a class="headerlink" href="#be-list" title="Permalink to this headline">¶</a></h3>
<p>Persistent intrusive double-linked list. The ambient objects should be stored
in BE segment [<a class="reference internal" href="#entity-be-seg">be.seg</a>].</p>
</section>
<section id="be-allocator">
<span id="entity-be-allocator"></span><h3>be.allocator<a class="headerlink" href="#be-allocator" title="Permalink to this headline">¶</a></h3>
<p>Allocator provides API to allocate and free memory in BE segment [<a class="reference internal" href="#entity-be-seg">be.seg</a>].
Memory is allocated from the segment using first-fit algorithm. The allocator
data structures are based on BE list [<a class="reference internal" href="#entity-be-list">be.list</a>].</p>
</section>
<section id="be-alloc-oom">
<span id="entity-be-alloc-oom"></span><h3>be.alloc.oom<a class="headerlink" href="#be-alloc-oom" title="Permalink to this headline">¶</a></h3>
<p>A situation that happens when there is no free space in BE segment [<a class="reference internal" href="#entity-be-seg">be.seg</a>]
left that has the required size and alignment. In this case the allocator
[<a class="reference internal" href="#entity-be-allocator">be.allocator</a>] returns NULL as a pointer and -ENOMEM as the return code.
The error handling in this case is totally on the user of the allocator.</p>
</section>
<section id="be-btree">
<span id="entity-be-btree"></span><h3>be.btree<a class="headerlink" href="#be-btree" title="Permalink to this headline">¶</a></h3>
<p>B-tree is a persistent data structure that resides inside
[<a href="#id318"><span class="problematic" id="id319">`be.segment &lt;entity.be.segment_&gt;`_</span></a>]. It provides Key-Value store asynchronous interface
to the user. B-trees are commonly used in storage systems which employ
their special locality pattern to access keys and values that can be
stored and loaded from disk in efficient manner. Typical operations
over B-tree which user can execute are: create tree, delete tree,
insert (key, val), delete (key), update (key, val), lookup (key).</p>
</section>
<section id="be-extmap">
<span id="entity-be-extmap"></span><h3>be.extmap<a class="headerlink" href="#be-extmap" title="Permalink to this headline">¶</a></h3>
<p>Extent map is a persistent transactional collection of extents in an abstract
numerical name-space with a numerical value associated to each extent. It’s
built on top of BE btree [<a class="reference internal" href="#entity-be-btree">be.btree</a>].</p>
</section>
<section id="be-paged">
<span id="entity-be-paged"></span><h3>be.paged<a class="headerlink" href="#be-paged" title="Permalink to this headline">¶</a></h3>
<p>PageD is a cache manager for segment stob I/O. It’s designed to add a
support of big segments into BE as far as we can’t keep all segments
in memory because total size of segments may exceed virtual memory
space; it’s also can be used to optimize segment stob writes.</p>
</section>
<section id="be-paged-page">
<span id="entity-be-paged-page"></span><h3>be.paged.page<a class="headerlink" href="#be-paged-page" title="Permalink to this headline">¶</a></h3>
<p>Page is a memory space from (start address to start address + page
size) corresponding to data, stored inside BE segment at given offset
and page size. One can imagine a page as an in-memory read cache of
the given “extent” inside segment.</p>
</section>
<section id="be-paged-cellar">
<span id="entity-be-paged-cellar"></span><h3>be.paged.cellar<a class="headerlink" href="#be-paged-cellar" title="Permalink to this headline">¶</a></h3>
<p>Cellar page looks like a page, containing closed be.tx
updates. Represents a write cache of pages from (start address to
start address + page size) written into be.segment at given offset and
page size.</p>
</section>
<section id="be-paged-request">
<span id="entity-be-paged-request"></span><h3>be.paged.request<a class="headerlink" href="#be-paged-request" title="Permalink to this headline">¶</a></h3>
<p>PageD request is a set of page references, flags and synchronization
objects used to be processed inside PageD FOM tick(). Encapsulates
methods to notify caller of this request that it’s finished.</p>
</section>
<section id="be-paged-fom">
<span id="entity-be-paged-fom"></span><h3>be.paged.fom<a class="headerlink" href="#be-paged-fom" title="Permalink to this headline">¶</a></h3>
<p>PageD FOM is a long-living specific FOM which is used to process
requests sent by the user to PageD.  It’s woken up when PageD request
occurs. PageD processes requests according to their type which can be
READ, WRITE, MANAGE.</p>
</section>
<section id="be-io">
<span id="entity-be-io"></span><h3>be.io<a class="headerlink" href="#be-io" title="Permalink to this headline">¶</a></h3>
<p>m0_be_io is an abstraction on top of m0_stob_io [<a class="reference internal" href="#entity-stob-io">stob.io</a>]. It makes all kinds
of stob I/O inside BE easier.</p>
<p>BE io is used by BE log [<a class="reference internal" href="#entity-be-log">be.log</a>] and BE paged [<a class="reference internal" href="#entity-be-paged">be.paged</a>] for the
segment [<a class="reference internal" href="#entity-be-seg">be.seg</a>] I/O.</p>
</section>
<section id="be-log">
<span id="entity-be-log"></span><h3>be.log<a class="headerlink" href="#be-log" title="Permalink to this headline">¶</a></h3>
<p>BE [<a class="reference internal" href="#entity-be">be</a>] uses write-ahead logging. Log is used as a place to write information about
transactions [<a class="reference internal" href="#entity-be-tx">be.tx</a>] to make the transactions recoverable [<a class="reference internal" href="#entity-be-recovery">be.recovery</a>].</p>
</section>
<section id="be-recovery">
<span id="entity-be-recovery"></span><h3>be.recovery<a class="headerlink" href="#be-recovery" title="Permalink to this headline">¶</a></h3>
<p>BE [<a class="reference internal" href="#entity-be">be</a>] allows users to modify segments [<a class="reference internal" href="#entity-be-seg">be.seg</a>] in transactional
[<a class="reference internal" href="#entity-be-tx">be.tx</a>] way. A segment is backed with a linux stob [<a class="reference internal" href="#entity-stob-linux">stob.linux</a>], which
doesn’t provide atomic writes. BE should have consistent segments even after
crash. Therefore BE should have a part that can recover BE segments data after
crash. This part is called BE recovery.</p>
<p>The recovery algorithm applies to the BE segment all transactions that are
stored in the log [<a class="reference internal" href="#entity-be-log">be.log</a>] but are not completely written to the BE
segment.</p>
</section>
<section id="stob">
<span id="entity-stob"></span><h3>stob<a class="headerlink" href="#stob" title="Permalink to this headline">¶</a></h3>
<p>Storage object is a fundamental abstraction of M0. Storage objects offer a
linear address space for data and may have redundancy and may have integrity
data.</p>
<p>There are multiple types of storage objects, used for various purposes and
providing various extensions of the basic storage object interface described
below. Specifically, containers for data and meta-data are implemented as
special types of storage objects.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>component</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-stob-ad">stob.ad</a>], [<a class="reference internal" href="#entity-stob-linux">stob.linux</a>], [<a class="reference internal" href="#entity-stob-io">stob.io</a>],
[<a class="reference internal" href="#entity-stob-domain">stob.domain</a>], [<a class="reference internal" href="#entity-stob-type">stob.type</a>], [<a class="reference internal" href="#entity-stob-ioq">stob.ioq</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>max</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a href="#id320"><span class="problematic" id="id321">`lib &lt;entity.lib_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-stob-domain">stob.domain</a>], [<a class="reference internal" href="#entity-stob-ad">stob.ad</a>], [<a class="reference internal" href="#entity-stob-linux">stob.linux</a>], [<a class="reference internal" href="#entity-stob-io">stob.io</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p>stob/stob.h</p></li>
</ul>
</dd>
</dl>
</section>
<section id="stob-ad">
<span id="entity-stob-ad"></span><h3>stob.ad<a class="headerlink" href="#stob-ad" title="Permalink to this headline">¶</a></h3>
<p>Storage object type based on Allocation Data (AD) stored in BE segment
[<a class="reference internal" href="#entity-be-seg">be.seg</a>].</p>
<p>It uses uses BE [<a class="reference internal" href="#entity-be">be</a>] to store extent map [<a class="reference internal" href="#entity-be-extmap">be.extmap</a>] which keeps track
of mapping between logical offsets in AD stobs and physical offsets within
underlying stob.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>component</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-stob">stob</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>none</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>max, anatoliy, dpodgorniy</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-be">be</a>], [<a class="reference internal" href="#entity-stob-linux">stob.linux</a>], [<a class="reference internal" href="#entity-balloc">balloc</a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p>stob/ad.h</p></li>
</ul>
</dd>
</dl>
</section>
<section id="stob-linux">
<span id="entity-stob-linux"></span><h3>stob.linux<a class="headerlink" href="#stob-linux" title="Permalink to this headline">¶</a></h3>
<p>Implementation of m0_stob on top of Linux files.</p>
<p>A linux storage object is simply a file on a local file system. A linux storage
object domain is a directory containing a directory where files, corresponding
to storage objects are stored in. A name of a file is built from the
corresponding storage object local identifier (m0_stob_id).</p>
<p>A linux storage object domain is identified by the path to its directory.</p>
<p>When an in-memory representation for an object is created, no file system
operations are performed. It is only when the object is “located”
(m0_stob_locate()) or “created” (m0_stob_create()) when actual open(2)
system call is made. If the call was successful, the file descriptor
(m0_stob_linux::sl_fd) remains open until the object is destroyed.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>component</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-stob">stob</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>max, anatoliy, dpodgorniy</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p>stob/linux.h</p></li>
</ul>
</dd>
</dl>
</section>
<section id="stob-io">
<span id="entity-stob-io"></span><h3>stob.io<a class="headerlink" href="#stob-io" title="Permalink to this headline">¶</a></h3>
<p>Asynchronous Direct Io Extensible User interface (adieu) for storage objects.</p>
<p>adieu is an interface for a non-blocking (asynchronous) 0-copy (direct)
vectored IO against storage objects.</p>
<p>A user of this interface builds an IO operation description and queues it
against a storage object. IO completion or failure notification is done by
signalling a user supplied m0_chan. As usual, the user can either wait on the
chan or register a call-back with it.</p>
<p>adieu supports scatter-gather type of IO operations (that is, vectored on both
input and output data).</p>
<p>adieu can work both on local and remote storage objects. adieu IO operations
are executed as part of a distributed transaction.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>component</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-stob">stob</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>max, anatoliy, dpodgorniy</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p>stob/io.h</p></li>
</ul>
</dd>
</dl>
</section>
<section id="stob-domain">
<span id="entity-stob-domain"></span><h3>stob.domain<a class="headerlink" href="#stob-domain" title="Permalink to this headline">¶</a></h3>
<p>Stob domain is a collection of storage objects [<a class="reference internal" href="#entity-stob">stob</a>] of the same type.  A
stob type [<a class="reference internal" href="#entity-stob-type">stob.type</a>] may have multiple domains, which are linked together
to its type.</p>
<p>A storage domain comes with an operation to find a storage object in the
domain. A domain might cache storage objects and use some kind of index to
speed up object lookup. This caching and indexing are not visible at the
generic level.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>max, anatoliy, dpodgorniy</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p>stob/domain.h</p></li>
</ul>
</dd>
</dl>
</section>
<section id="stob-type">
<span id="entity-stob-type"></span><h3>stob.type<a class="headerlink" href="#stob-type" title="Permalink to this headline">¶</a></h3>
<p>Stob type defines a set of operations that can be performed on a particular
stob domain [<a class="reference internal" href="#entity-stob-domain">stob.domain</a>].</p>
</section>
<section id="stob-ioq">
<span id="entity-stob-ioq"></span><h3>stob.ioq<a class="headerlink" href="#stob-ioq" title="Permalink to this headline">¶</a></h3>
<p>adieu implementation for Linux stob [<a class="reference internal" href="#entity-stob-linux">stob.linux</a>] is based on Linux specific
asynchronous IO interfaces: io_{setup,destroy,submit,cancel,getevents}().</p>
<p>IO admission control and queueing in Linux stob adieu are implemented on a
storage object domain [<a class="reference internal" href="#entity-stob-domain">stob.domain</a>] level, that is, each domain has its own
set of queues, threads and thresholds.</p>
</section>
<section id="balloc">
<span id="entity-balloc"></span><h3>balloc<a class="headerlink" href="#balloc" title="Permalink to this headline">¶</a></h3>
<p>M0 Data Block Allocator.</p>
<p>Balloc is a multi-block allocator, with pre-allocation. All metadata about
block allocation is stored in BE segment [<a class="reference internal" href="#entity-be-seg">be.seg</a>].</p>
</section>
<section id="net">
<span id="entity-net"></span><h3>net<a class="headerlink" href="#net" title="Permalink to this headline">¶</a></h3>
<p>The networking module provides an asynchronous, event-based message passing
service, with support for asynchronous bulk data transfer (if used with an RDMA
capable transport).</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p>net/net.h</p></li>
<li><p><a class="reference external" href="https://docs.google.com/document/d/1oGQQpJsYV779386NtFSlSlRddJHYE8Bo5Asr4ZO4DS8/edit">HLD of Mero LNet Transport</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="net-rdma">
<span id="entity-net-rdma"></span><h3>net.rdma<a class="headerlink" href="#net-rdma" title="Permalink to this headline">¶</a></h3>
<p>Remote Direct Memory Access - a feature that allows network buffer
[<a class="reference internal" href="#entity-net-buf">net.buf</a>] transfer over the network without involving neither sender’s nor
receiver’s CPU/caches for the data transfer.</p>
</section>
<section id="net-lnet">
<span id="entity-net-lnet"></span><h3>net.lnet<a class="headerlink" href="#net-lnet" title="Permalink to this headline">¶</a></h3>
<p>The Lustre Networking module. It implements version 3.2 of the Portals Message
Passing Interface, and provides access to a number of different transport
protocols including InfiniBand and TCP over Ethernet.</p>
</section>
<section id="net-devm0lnet">
<span id="entity-net-devm0lnet"></span><h3>net.devm0lnet<a class="headerlink" href="#net-devm0lnet" title="Permalink to this headline">¶</a></h3>
<p>The Device driver [<a href="#id322"><span class="problematic" id="id323">`m0mero.ko &lt;entity.m0mero.ko_&gt;`_</span></a>] provides access to the Kernel Core LNET
[<a class="reference internal" href="#entity-net-lnet">net.lnet</a>] implementation through ioctl requests on the “/dev/m0lnet”
device.</p>
</section>
<section id="net-tm">
<span id="entity-net-tm"></span><h3>net.tm<a class="headerlink" href="#net-tm" title="Permalink to this headline">¶</a></h3>
<p>Transfer machine - this data structure tracks message buffers [<a class="reference internal" href="#entity-net-buf">net.buf</a>] and
supports callbacks to notify the application of changes in state associated
with these buffers.</p>
</section>
<section id="net-buf">
<span id="entity-net-buf"></span><h3>net.buf<a class="headerlink" href="#net-buf" title="Permalink to this headline">¶</a></h3>
<p>Network Buffer - a memory area used to send and receive data to/from the
network [<a class="reference internal" href="#entity-net">net</a>].</p>
</section>
<section id="net-ep">
<span id="entity-net-ep"></span><h3>net.ep<a class="headerlink" href="#net-ep" title="Permalink to this headline">¶</a></h3>
<p>Addressable network [<a class="reference internal" href="#entity-net">net</a>] end point.</p>
</section>
<section id="net-domain">
<span id="entity-net-domain"></span><h3>net.domain<a class="headerlink" href="#net-domain" title="Permalink to this headline">¶</a></h3>
<p>Network domain - a collection of network [<a class="reference internal" href="#entity-net">net</a>] resources.</p>
</section>
<section id="net-buffer-pool">
<span id="entity-net-buffer-pool"></span><h3>net.buffer_pool<a class="headerlink" href="#net-buffer-pool" title="Permalink to this headline">¶</a></h3>
<p>Network buffer pool allocates and manages a pool of network buffers.
Users request a buffer from the pool and after its usage is over
gives back to the pool.</p>
</section>
<section id="system-upgrade">
<span id="entity-system-upgrade"></span><h3>system.upgrade<a class="headerlink" href="#system-upgrade" title="Permalink to this headline">¶</a></h3>
</section>
<section id="system-downgrade">
<span id="entity-system-downgrade"></span><h3>system.downgrade<a class="headerlink" href="#system-downgrade" title="Permalink to this headline">¶</a></h3>
</section>
<section id="fs-readonly">
<span id="entity-fs-readonly"></span><h3>fs.readonly<a class="headerlink" href="#fs-readonly" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Use-cases</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Owners</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Uses</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Used</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Properties</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Invariants</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">State machines</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Components</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Features</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Tests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">History</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Known problems</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Requests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Questions</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Alternatives</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">References</dt>
<dd class="field-even"><p></p></dd>
</dl>
</section>
<section id="s3-region">
<span id="entity-s3-region"></span><h3>s3.region<a class="headerlink" href="#s3-region" title="Permalink to this headline">¶</a></h3>
<p>Cloud computing resources are hosted in multiple locations world-wide. These locations are composed of S3 Regions and Availability Zones. Each S3 Region is a separate geographic area. Each S3 Region has multiple, isolated locations known as Availability Zones. Resources aren’t replicated across S3 Regions unless we do so specifically.</p>
</section>
<section id="s3-bucket">
<span id="entity-s3-bucket"></span><h3>s3.bucket<a class="headerlink" href="#s3-bucket" title="Permalink to this headline">¶</a></h3>
<p>s3 bucket is a logical container wherein we upload all objects.
We can upload any number of objects to the bucket. S3 provides API to manage bucket.</p>
</section>
<section id="s3-bucket-name">
<span id="entity-s3-bucket-name"></span><h3>s3.bucket.name<a class="headerlink" href="#s3-bucket-name" title="Permalink to this headline">¶</a></h3>
<p>Once a S3 bucket is created its name cannot be changed. Below are the rules for naming S3 bucket
in all regions.</p>
<blockquote>
<div><ul class="simple">
<li><p>Bucket names must be unique across all existing bucket names in S3</p></li>
<li><p>Bucket names must comply with DNS naming conventions.</p></li>
<li><p>Bucket names must be at least 3 and no more than 63 characters long.</p></li>
<li><p>Bucket names must not contain uppercase characters or underscores.</p></li>
<li><p>Bucket names must start with a lowercase letter or number.</p></li>
<li><p>Bucket names must be a series of one or more labels. Adjacent labels are separated by a single period (.). Bucket names can contain lowercase letters, numbers, and hyphens. Each label must start and end with a lowercase letter or a number.</p></li>
<li><p>Bucket names must not be formatted as an IP address (for example, 192.178.62.32).</p></li>
<li><p>In case of virtual hosted–style buckets with Secure Sockets Layer (SSL), the SSL wildcard certificate only matches buckets that don’t contain periods. To work around this, use HTTP or write your own certificate verification logic. Its recommended that we do not use periods (“.”) in bucket names when using virtual hosted–style buckets.</p></li>
</ul>
</div></blockquote>
</section>
<section id="s3-object">
<span id="entity-s3-object"></span><h3>s3.object<a class="headerlink" href="#s3-object" title="Permalink to this headline">¶</a></h3>
<p>In S3 data is stored as objects within resource called buckets. Objects consist of object data and its metadata. Metadata is a set of name-value pairs that describe the Object. There are two kinds of Object metadata system metadata and user-defined metadata.</p>
</section>
<section id="s3-object-name">
<span id="entity-s3-object-name"></span><h3>s3.object.name<a class="headerlink" href="#s3-object-name" title="Permalink to this headline">¶</a></h3>
</section>
<section id="s3-bucket-operation">
<span id="entity-s3-bucket-operation"></span><h3>s3.bucket.operation<a class="headerlink" href="#s3-bucket-operation" title="Permalink to this headline">¶</a></h3>
<p>Following are the supported bucket operations</p>
<blockquote>
<div><ul class="simple">
<li><p>DELETE Bucket</p></li>
<li><p>DELETE Bucket policy</p></li>
<li><p>DELETE Bucket replication</p></li>
<li><p>DELETE Bucket tagging</p></li>
<li><p>GET Bucket (List Objects)</p></li>
<li><p>GET Bucket acl</p></li>
<li><p>GET Bucket location</p></li>
<li><p>GET BucketPolicyStatus</p></li>
<li><p>GET Bucket Object versions</p></li>
<li><p>GET Bucket policy</p></li>
<li><p>GET Bucket replication</p></li>
<li><p>GET Bucket tagging</p></li>
<li><p>GET Bucket versioning</p></li>
<li><p>HEAD Bucket</p></li>
<li><p>List Multipart Uploads</p></li>
<li><p>PUT Bucket</p></li>
<li><p>PUT Bucket acl</p></li>
<li><p>PUT Bucket policy</p></li>
<li><p>PUT Bucket replication</p></li>
<li><p>PUT Bucket tagging</p></li>
<li><p>PUT Bucket versioning</p></li>
</ul>
</div></blockquote>
</section>
<section id="s3-object-operation">
<span id="entity-s3-object-operation"></span><h3>s3.object.operation<a class="headerlink" href="#s3-object-operation" title="Permalink to this headline">¶</a></h3>
<p>Following are the supported object operations</p>
<blockquote>
<div><ul class="simple">
<li><p>Delete Multiple Objects</p></li>
<li><p>DELETE Object</p></li>
<li><p>DELETE Object tagging</p></li>
<li><p>GET Object</p></li>
<li><p>GET Object ACL</p></li>
<li><p>GET Object tagging</p></li>
<li><p>HEAD Object</p></li>
<li><p>PUT Object</p></li>
<li><p>PUT Object - Copy</p></li>
<li><p>PUT Object acl</p></li>
<li><p>PUT Object tagging</p></li>
<li><p>Abort Multipart Upload</p></li>
<li><p>Complete Multipart Upload</p></li>
<li><p>Initiate Multipart Upload</p></li>
<li><p>List Parts</p></li>
<li><p>Upload Part</p></li>
</ul>
</div></blockquote>
</section>
<section id="s3-endpoint">
<span id="entity-s3-endpoint"></span><h3>s3.endpoint<a class="headerlink" href="#s3-endpoint" title="Permalink to this headline">¶</a></h3>
<p>An endpoint is a URL that is entry point for the S3 service.</p>
</section>
<section id="s3-bucket-tagging">
<span id="entity-s3-bucket-tagging"></span><h3>s3.bucket.tagging<a class="headerlink" href="#s3-bucket-tagging" title="Permalink to this headline">¶</a></h3>
<dl class="simple">
<dt>Bucket Tagging (Cost allocation tagging) is to label the S3 buckets with a tag that consists of a key and a value in order to track its costs. Cost allocation tagging can be used also for other resources like S3 objects. Various benefits of tagging</dt><dd><ul class="simple">
<li><p>Categories the resources</p></li>
<li><p>Resources can be identified easily</p></li>
<li><p>Helps in management of resources</p></li>
<li><p>Helps in cost calculation</p></li>
</ul>
</dd>
</dl>
</section>
<section id="s3-user">
<span id="entity-s3-user"></span><h3>s3.user<a class="headerlink" href="#s3-user" title="Permalink to this headline">¶</a></h3>
<p>User identity created to grant access to any S3 resources, like bucket, object etc.</p>
</section>
<section id="s3-account">
<span id="entity-s3-account"></span><h3>s3.account<a class="headerlink" href="#s3-account" title="Permalink to this headline">¶</a></h3>
<p>Account is a container of a set of users and helps support multi-tenancy.</p>
</section>
<section id="s3-subaccount">
<span id="entity-s3-subaccount"></span><h3>s3.subaccount<a class="headerlink" href="#s3-subaccount" title="Permalink to this headline">¶</a></h3>
<p>Account can be divided into smaller subaccounts to group specific set of users.</p>
</section>
<section id="s3-statistics">
<span id="entity-s3-statistics"></span><h3>s3.statistics<a class="headerlink" href="#s3-statistics" title="Permalink to this headline">¶</a></h3>
<p>S3 statistics give visibility into the S3 operations(GET/PUT/DELETE etc) for different sources like Bucket, Object etc.</p>
</section>
<section id="s3-availability-zones">
<span id="entity-s3-availability-zones"></span><h3>s3.availability.zones<a class="headerlink" href="#s3-availability-zones" title="Permalink to this headline">¶</a></h3>
<p>Availability zones in AWS are like deployment sites which are physically seperate in order to achieve better durability and failover.</p>
</section>
<section id="s3-service">
<span id="entity-s3-service"></span><h3>s3.service<a class="headerlink" href="#s3-service" title="Permalink to this headline">¶</a></h3>
<p>S3 as a service provides a mechanism using REST APIs to perform various operations on object storage.</p>
</section>
<section id="s3-api">
<span id="entity-s3-api"></span><h3>s3.api<a class="headerlink" href="#s3-api" title="Permalink to this headline">¶</a></h3>
<p>A set of HTTP APIs to perform various operations on object storage.</p>
</section>
<section id="s3-client">
<span id="entity-s3-client"></span><h3>s3.client<a class="headerlink" href="#s3-client" title="Permalink to this headline">¶</a></h3>
<p>Client application using S3 REST APIs to consumer object storage features.</p>
</section>
<section id="s3-dns">
<span id="entity-s3-dns"></span><h3>s3.dns<a class="headerlink" href="#s3-dns" title="Permalink to this headline">¶</a></h3>
</section>
<section id="s3-loadbalancer-haproxy">
<span id="entity-s3-loadbalancer"></span><h3>s3.loadbalancer (haproxy)<a class="headerlink" href="#s3-loadbalancer-haproxy" title="Permalink to this headline">¶</a></h3>
<p>Load balancer manages distribution of workload across a deployed service.</p>
</section>
<section id="s3-put">
<span id="entity-s3-put"></span><h3>s3.PUT<a class="headerlink" href="#s3-put" title="Permalink to this headline">¶</a></h3>
<p>Http REST API used to upload Object.</p>
</section>
<section id="s3-policies">
<span id="entity-s3-policies"></span><h3>s3.policies<a class="headerlink" href="#s3-policies" title="Permalink to this headline">¶</a></h3>
<p>A set of rules to define access permissions to various S3 resources for specific identity.</p>
</section>
<section id="s3-server">
<span id="entity-s3-server"></span><h3>s3.server<a class="headerlink" href="#s3-server" title="Permalink to this headline">¶</a></h3>
<p>A instance of server providing S3 interface over seagate object storage.</p>
</section>
<section id="s3-auth-server">
<span id="entity-s3-auth-server"></span><h3>s3.auth.server<a class="headerlink" href="#s3-auth-server" title="Permalink to this headline">¶</a></h3>
<p>Server instance providing REST APIs to create and manage Accounts/Users and perform Authentication and Authorization for S3 server.</p>
</section>
<section id="s3-failover">
<span id="entity-s3-failover"></span><h3>s3.failover<a class="headerlink" href="#s3-failover" title="Permalink to this headline">¶</a></h3>
</section>
<section id="s3-sse">
<span id="entity-s3-sse"></span><h3>s3.sse<a class="headerlink" href="#s3-sse" title="Permalink to this headline">¶</a></h3>
<p>Server side encryption feature in S3. Object are encrypted in memory before storing on disk.</p>
</section>
<section id="rpc">
<span id="entity-rpc"></span><h3>rpc<a class="headerlink" href="#rpc" title="Permalink to this headline">¶</a></h3>
<p>RPC is a high level part of Mero network stack. It contains operations allowing
user to send [<a class="reference internal" href="#entity-rpc-item">rpc.item</a>]s, containing file operation packets (FOP) to network
destinations. RPC layer speaks about FOPs being sent from and to end-points and
RPCs, which are containers for FOPs, being sent to services.  RPC is a part of a
Mero serivices as well as a Mero clients.</p>
</section>
<section id="rpc-item">
<span id="entity-rpc-item"></span><h3>rpc.item<a class="headerlink" href="#rpc-item" title="Permalink to this headline">¶</a></h3>
<p>RPC item is a portion of information sent over RPC. Typicaly FOPs aggregate such
items inside itself, which allows them to be sent over the network.</p>
</section>
<section id="rpc-connection">
<span id="entity-rpc-connection"></span><h3>rpc.connection<a class="headerlink" href="#rpc-connection" title="Permalink to this headline">¶</a></h3>
<p>RPC connection is a container of session. Typically, user can create several
sessions commint onto the same end-point for its needs.</p>
</section>
<section id="rpc-session">
<span id="entity-rpc-session"></span><h3>rpc.session<a class="headerlink" href="#rpc-session" title="Permalink to this headline">¶</a></h3>
<p>RPC session is a long-lived Mero service object. Clients may establish sessions,
FOPs are sent over these sessions to the server side. Sender may also terminate
sessions and check out whether it’s failed.</p>
</section>
<section id="rpc-formation">
<span id="entity-rpc-formation"></span><h3>rpc.formation<a class="headerlink" href="#rpc-formation" title="Permalink to this headline">¶</a></h3>
<p>Formation algorithm acts on a cache of RPC items. It decides the items to be
selected from the cache and it puts them together in an RPC object. The
formation algorithm makes sure that maximum size of an RPC object is limited so
that it makes optimal use of network bandwidth</p>
</section>
<section id="rpc-timeout">
<span id="entity-rpc-timeout"></span><h3>rpc.timeout<a class="headerlink" href="#rpc-timeout" title="Permalink to this headline">¶</a></h3>
<p>RPC timeout controls how long data sent over RPC connection may remain
unacknowledged by the client or server side before a connection is forcefully
moved to terminated or failed state.</p>
<p>When rpc item reply is not received within a timeout, then rpc item is
marked as failed with timeout.</p>
</section>
<section id="rpc-resend">
<span id="entity-rpc-resend"></span><h3>rpc.resend<a class="headerlink" href="#rpc-resend" title="Permalink to this headline">¶</a></h3>
<p>RPC items are resend ‘nr’ times if item reply is not received within a
resend time interval.</p>
</section>
<section id="rpc-reply">
<span id="entity-rpc-reply"></span><h3>rpc.reply<a class="headerlink" href="#rpc-reply" title="Permalink to this headline">¶</a></h3>
<p>For rpc items which are not a one way items, receiver send the data
back in rpc reply.</p>
</section>
<section id="sns-parity-math">
<span id="entity-sns-parity-math"></span><h3>sns.parity_math<a class="headerlink" href="#sns-parity-math" title="Permalink to this headline">¶</a></h3>
<p>Provide math base for algorithms of SNS parity (checksums) calculation
for given data units, quick update of parity units in case of minor
data changes, repair algorithms in case of failure.</p>
</section>
<section id="rconfc">
<span id="entity-rconfc"></span><h3>rconfc<a class="headerlink" href="#rconfc" title="Permalink to this headline">¶</a></h3>
<p>Redundant Configuration Client</p>
<p>Redundant configuration client library – rconfc – provides an interface for
Mero applications working in cluster with multiple configuration servers
[<a href="#id324"><span class="problematic" id="id325">`confd &lt;entity.confd_&gt;`_</span></a>].</p>
<p>Rconfc supplements confc functionality and processes situations when cluster
dynamically changes configuration or loses connection to some of confd servers.</p>
</section>
<section id="fop">
<span id="entity-fop"></span><h3>fop<a class="headerlink" href="#fop" title="Permalink to this headline">¶</a></h3>
<p>FOP, file operation packet, a description of file operation suitable for sending
over network and storing on a storage device. File operation packet (FOP)
identifies file operation type and operation parameters.</p>
</section>
<section id="fop-entrypoint">
<span id="entity-fop-entrypoint"></span><h3>fop.entrypoint<a class="headerlink" href="#fop-entrypoint" title="Permalink to this headline">¶</a></h3>
<p>The entrypoint fop.</p>
<p>When a new process wants to join the cluster it sends so-called entrypoint fop
to Halon [<a class="reference internal" href="#entity-halon">halon</a>]. The fop contains information about the process. Then
Halon decides what to do with the process (allow it to join or not, for
example), and then sends entrypoint reply fop with all the information needed
to work in the cluster. This includes, among other things, the active RM
[<a href="#id326"><span class="problematic" id="id327">`rm.active &lt;entity.rm.active_&gt;`_</span></a>] and the list of confds [<a href="#id328"><span class="problematic" id="id329">`confd &lt;entity.confd_&gt;`_</span></a>] from which the process can
get the cluster configuration [<a href="#id330"><span class="problematic" id="id331">`conf &lt;entity.conf_&gt;`_</span></a>].</p>
</section>
<section id="confd-quorum">
<span id="entity-confd-quorum"></span><h3>confd.quorum<a class="headerlink" href="#confd-quorum" title="Permalink to this headline">¶</a></h3>
<p>After the entrypoint reply fop [<a class="reference internal" href="#entity-fop-entrypoint">fop.entrypoint</a>] is received rconfc
[<a class="reference internal" href="#entity-rconfc">rconfc</a>] queries the version of configuration on every confd [<a href="#id332"><span class="problematic" id="id333">`confd &lt;entity.confd_&gt;`_</span></a>]
from the list of confds. The quorum value tells the minimal number of confds
that should have the same version for rconfc to return the configuration from
these confds to the user.</p>
</section>
<section id="throughput">
<span id="entity-throughput"></span><h3>throughput<a class="headerlink" href="#throughput" title="Permalink to this headline">¶</a></h3>
<p>Throughput indicates how fast the data can be processed.</p>
<p>It can be measured in bytes/s, bits/s, object operations/s etc.</p>
<dl class="field-list simple">
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Throughput">https://en.wikipedia.org/wiki/Throughput</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="queue-depth">
<span id="entity-queue-depth"></span><h3>queue.depth<a class="headerlink" href="#queue-depth" title="Permalink to this headline">¶</a></h3>
<p>The queue depth indicates how many operations are sent to the device but the
completion (either successful or unsuccessful) hasn’t been received from the
device yet. For PODS [<a href="#id334"><span class="problematic" id="id335">`pods &lt;entity.pods_&gt;`_</span></a>] we need to have a large amount of operations (&gt;
100) queued at the same time, so the PODS controllers can achieve maximum
performance.</p>
<dl class="field-list simple">
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/IOPS">https://en.wikipedia.org/wiki/IOPS</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Native_Command_Queuing">https://en.wikipedia.org/wiki/Native_Command_Queuing</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="rdma">
<span id="entity-rdma"></span><h3>rdma<a class="headerlink" href="#rdma" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p>[<a class="reference internal" href="#entity-net-rdma">net.rdma</a>]</p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Remote_direct_memory_access">https://en.wikipedia.org/wiki/Remote_direct_memory_access</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="bitrot">
<span id="entity-bitrot"></span><h3>bitrot<a class="headerlink" href="#bitrot" title="Permalink to this headline">¶</a></h3>
<p>This is the case when the data on drive gets corrupted due to some bit flip
and subsequent read on that data fails the checksum verification. This is
handled by triggering a background scrub [<a href="#id336"><span class="problematic" id="id337">`durability.bitrot &lt;entity.durability.bitrot_&gt;`_</span></a>] operation.</p>
</section>
<section id="bitrot-md">
<span id="entity-bitrot-md"></span><h3>bitrot.md<a class="headerlink" href="#bitrot-md" title="Permalink to this headline">¶</a></h3>
<p>A bit rot case [<a class="reference internal" href="#entity-bitrot">bitrot</a>] when the metadata becomes corrupted due to a bit
rot. It’s supposed to be detected with checksums in every BE object
[<a href="#id338"><span class="problematic" id="id339">`be.obj &lt;entity.be.obj_&gt;`_</span></a>]. The only solution we have now to handle the metadata bit rot is
to consider all segments in this drive as lost and then repair all the missing
data using SNS rebalace [<a href="#id340"><span class="problematic" id="id341">`sns.rebalance &lt;entity.sns.rebalance_&gt;`_</span></a>] or SNS direct rebalance
[<a href="#id342"><span class="problematic" id="id343">`sns.rebalance.direct &lt;entity.sns.rebalance.direct_&gt;`_</span></a>] for data and DIX rebalance [<a href="#id344"><span class="problematic" id="id345">`dix.rebalance &lt;entity.dix.rebalance_&gt;`_</span></a>] or
DIX direct rebalance [<a href="#id346"><span class="problematic" id="id347">`dix.rebalance.direct &lt;entity.dix.rebalance.direct_&gt;`_</span></a>] for the missing distributed
indexes [<a href="#id348"><span class="problematic" id="id349">`dix &lt;entity.dix_&gt;`_</span></a>].</p>
</section>
<section id="fop-cob-check">
<span id="entity-fop-cob-check"></span><h3>fop.cob.check<a class="headerlink" href="#fop-cob-check" title="Permalink to this headline">¶</a></h3>
<p>A fop to verify DI checksum [<a class="reference internal" href="#entity-checksum">checksum</a>].</p>
<p>The DI mismatch can happen during the BSC scan [<a href="#id350"><span class="problematic" id="id351">`bsc.scan &lt;entity.bsc.scan_&gt;`_</span></a>] or read I/O from
Clovis [<a class="reference internal" href="#entity-clovis">clovis</a>]. This fop can trigger DI checksum verification for a
particular offset within a particular cob (this includes data, parity and spare
units) without returning data back to the Clovis application. If the DI
checksum mismatch is detected the unit is handled in the same way as if it was
detected by read I/O or BSC scan.</p>
</section>
<section id="bsc">
<span id="entity-bsc"></span><h3>bsc<a class="headerlink" href="#bsc" title="Permalink to this headline">¶</a></h3>
<p>Background is a mero service that detects as well as repairs the corrupted data
block. Background scrub can be triggered in case of checksum mismatch during a
typical read io or by the background scrub [<a class="reference internal" href="#entity-bsc-scanner">bsc.scanner</a>].</p>
</section>
<section id="bsc-scanner">
<span id="entity-bsc-scanner"></span><h3>bsc.scanner<a class="headerlink" href="#bsc-scanner" title="Permalink to this headline">¶</a></h3>
<p>Background scrub scanner is a part of the background scrub service and iterates over
allocated mero data block space ([<a href="#id352"><span class="problematic" id="id353">`balloc &lt;component.balloc_&gt;`_</span></a>]) to detect any corruption using the
[<a href="#id354"><span class="problematic" id="id355">`di &lt;entity.di_&gt;`_</span></a>] interface. On detecting the corruption, scanner submits a
[<a class="reference internal" href="#entity-bsc-repair-request">bsc.repair.request</a>].</p>
</section>
<section id="bsc-repair-request">
<span id="entity-bsc-repair-request"></span><h3>bsc.repair.request<a class="headerlink" href="#bsc-repair-request" title="Permalink to this headline">¶</a></h3>
<p>A background scrub repair request can be submitted to background scrub
([<a href="#id356"><span class="problematic" id="id357">`durability.bitrot &lt;entity.durability.bitrot_&gt;`_</span></a>]) in context of a read i/o or by the background scrub scanner.</p>
</section>
<section id="bsc-bad-list">
<span id="entity-bsc-bad-list"></span><h3>bsc.bad.list<a class="headerlink" href="#bsc-bad-list" title="Permalink to this headline">¶</a></h3>
<p>We can encounter DI [<a class="reference internal" href="#entity-checksum">checksum</a>] data mismatch for a data/parity/spare unit. It’s
known that such units doesn’t have the right data, but they may still have at
least parts of the data. The BSC bad list contains all the units with the DI
checksum that doesn’t match the data along with the connections to the files
the units are the part of. This way the system administrator still can recover
whatever is left from such units. It’s also possible that the bit rot is
transient, i.e. next read would return the data that matches the DI checksum,
so it also should be possible to do something about it.</p>
<p>The bad list comes with the list management capability, like enumerating all
the failed units with their files, removing the “DI has failed” flags,
re-checking the failed units to see if the DI mismatch persists etc.</p>
</section>
<section id="bsc-request-list">
<span id="entity-bsc-request-list"></span><h3>bsc.request.list<a class="headerlink" href="#bsc-request-list" title="Permalink to this headline">¶</a></h3>
<p>Background scrub persists the in-progress scrub requests list in [<a class="reference internal" href="#entity-be">be</a>] in-order
to continue the operation post node restart.</p>
</section>
<section id="bsc-scrubber">
<span id="entity-bsc-scrubber"></span><h3>bsc.scrubber<a class="headerlink" href="#bsc-scrubber" title="Permalink to this headline">¶</a></h3>
<p>Scrubber processes the [<a class="reference internal" href="#entity-bsc-repair-request">bsc.repair.request</a>] using the mero fom infrastructure.</p>
</section>
<section id="balance-capacity">
<span id="entity-balance-capacity"></span><h3>balance.capacity<a class="headerlink" href="#balance-capacity" title="Permalink to this headline">¶</a></h3>
<p>Balance capacity runs as a mero service on every mero node. Every participating mero node is
elected as a co-ordinator in turns. Every co-ordinator completes its part of balancing and hands
over control back to halon, which in turn elects the next co-ordinator. Halon provides required
policy support to the participating nodes to identify if a particular file needs balancing or
not.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>service</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>none</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a href="#id358"><span class="problematic" id="id359">`balcap.coordinator &lt;entity.balcap.coordinator_&gt;`_</span></a>], [<a href="#id360"><span class="problematic" id="id361">`balcap.service &lt;entity.balcap.service_&gt;`_</span></a>], [<a href="#id362"><span class="problematic" id="id363">`balcap.policy &lt;entity.balcap.policy_&gt;`_</span></a>],
[<a href="#id364"><span class="problematic" id="id365">`balcap.restripe &lt;entity.balcap.restripe_&gt;`_</span></a>], [<a href="#id366"><span class="problematic" id="id367">`balcap.rm &lt;entity.balcap.rm_&gt;`_</span></a>], [<a href="#id368"><span class="problematic" id="id369">`balcap.bufferpool &lt;entity.balcap.bufferpool_&gt;`_</span></a>],
[<a href="#id370"><span class="problematic" id="id371">`balcap.bsc &lt;entity.balcap.bsc_&gt;`_</span></a>], [<a href="#id372"><span class="problematic" id="id373">`balcap.cob.version &lt;entity.balcap.cob.version_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>mandar, nachiket</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p>[<a href="#id374"><span class="problematic" id="id375">`rm &lt;entity.rm_&gt;`_</span></a>], [<a href="#id376"><span class="problematic" id="id377">`layout &lt;entity.layout_&gt;`_</span></a>], [<a href="#id378"><span class="problematic" id="id379">`pool.policy &lt;entity.pool.policy_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-halon">halon</a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><ul class="simple">
<li><p>policy-based-balance: balance capacity consults the policy provided by
halon for every object that is encountered on the storage is being
balanced.</p></li>
<li><p>fault-tolerant: balance capacity uses layout to rebuild the data on the
fly in-case of io errors. Co-ordinator failures are appropriately handled
with the help of Halon and dtm0.</p></li>
<li><p>flow control: Progress of balance capacity can be controlled by defining
appropriate rm resources and limits, e.g. buffer pool.</p></li>
</ul>
</dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a href="#id380"><span class="problematic" id="id381">`scaleout &lt;component.scaleout_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><ul class="simple">
<li><dl class="simple">
<dt>[] export policy interface for objects that can be invoked to check if the</dt><dd><p>corresponding object requires balance.</p>
</dd>
</dl>
</li>
</ul>
</dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="balance-capacity-pool">
<span id="entity-balance-capacity-pool"></span><h3>balance.capacity.pool<a class="headerlink" href="#balance-capacity-pool" title="Permalink to this headline">¶</a></h3>
<p>On pool modification, i.e. on addition of some new hardware to the pool, based on some
policy, halon triggers a capacity balance operation on the modified pool.</p>
</section>
<section id="balance-capacity-policy">
<span id="entity-balance-capacity-policy"></span><h3>balance.capacity.policy<a class="headerlink" href="#balance-capacity-policy" title="Permalink to this headline">¶</a></h3>
<p>This is the capacity balance policy configured at Halon in-order to decided the following,
- when to start balance capacity operation,
- when to stop balance capacity operation,
- if a particular file needs balancing or not.</p>
</section>
<section id="balance-capacity-index">
<span id="entity-balance-capacity-index"></span><h3>balance.capacity.index<a class="headerlink" href="#balance-capacity-index" title="Permalink to this headline">¶</a></h3>
<p>This is about balancing the [<a class="reference internal" href="#entity-dix-index">dix.index</a>] metadata across the storage.</p>
</section>
<section id="balance-capacity-restripe">
<span id="entity-balance-restripe"></span><h3>balance.capacity.restripe<a class="headerlink" href="#balance-capacity-restripe" title="Permalink to this headline">¶</a></h3>
<p>During balance capacity, it is possible that the existing data may have to be restriped,
e.g. the if initial data was striped using 8 + 2 layout, it may have to striped using
16 + 4.</p>
</section>
<section id="balance-capacity-coordinator">
<span id="entity-balance-coordinator"></span><h3>balance.capacity.coordinator<a class="headerlink" href="#balance-capacity-coordinator" title="Permalink to this headline">¶</a></h3>
<p>Balance capacity coordinator is selected by Halon before starting the balance operation.
Coordinator is the one who drives the balance operation. Every node acts as a coordinator
in a sequential manner. Coordinator pull the relevant data from relevant nodes and
redirects it to its new location.</p>
</section>
<section id="balance-capacity-layout-set">
<span id="entity-balance-layout-set"></span><h3>balance.capacity.layout.set<a class="headerlink" href="#balance-capacity-layout-set" title="Permalink to this headline">¶</a></h3>
<p>Balancing operation also changes a file’s layout which is updated after the file is completely
balanced. File layout will be changed using dtm0.</p>
</section>
<section id="balance-capacity-bsc-request">
<span id="entity-balance-capacity-bsc-request"></span><h3>balance.capacity.bsc.request<a class="headerlink" href="#balance-capacity-bsc-request" title="Permalink to this headline">¶</a></h3>
<p>If balance capacity io operation encounters a data or metadata corruption, it submits a background
scrub ([<a class="reference internal" href="#entity-bsc">bsc</a>]) request for the corrupted data in context of that io.</p>
</section>
<section id="balance-capacity-rm">
<span id="entity-balance-capacity-rm"></span><h3>balance.capacity.rm<a class="headerlink" href="#balance-capacity-rm" title="Permalink to this headline">¶</a></h3>
<p>Balance capacity uses file locks implemented as a resource, managed by resource manager,
to handle concurrent io.</p>
</section>
<section id="balance-capacity-bufferpool">
<span id="entity-balance-capacity-bufferpool"></span><h3>balance.capacity.bufferpool<a class="headerlink" href="#balance-capacity-bufferpool" title="Permalink to this headline">¶</a></h3>
<p>Balance capacity uses buffer pools to read and write data. Buffer pool size can be tuned
in-order to impose any memory bandwidth constraints on balance capacity operation.</p>
</section>
<section id="balance-capacity-dtm0">
<span id="entity-balance-capacity-dtm0"></span><h3>balance.capacity.dtm0<a class="headerlink" href="#balance-capacity-dtm0" title="Permalink to this headline">¶</a></h3>
<p>Meta data update failures during balance capacity operations make use of DTM0. Pending
transactions are redone by dtm0.</p>
</section>
<section id="balance-capacity-cob-versioning">
<span id="entity-balance-capacity-cob-versioning"></span><h3>balance.capacity.cob.versioning<a class="headerlink" href="#balance-capacity-cob-versioning" title="Permalink to this headline">¶</a></h3>
<p>Version attribute is added to cob on its creation. During balance operation, the old
cob is mantained until the data is relocated and the corresponding metadata is
successfully updated in DIX. The old cob is cleanedup after the metadata update.
Any failure during the metadata update is handled with the help of dtm0.</p>
</section>
<section id="balance-capacity-flowcontrol">
<span id="entity-balance-capacity-flowcontrol"></span><h3>balance.capacity.flowcontrol<a class="headerlink" href="#balance-capacity-flowcontrol" title="Permalink to this headline">¶</a></h3>
<p>Balance capacity operation flow can be controlled using various resource manager constraints
like memory, network, cpu, etc. For example, memory constraints can be applied through buffer
pools.</p>
</section>
<section id="balance-capacity-evacuate">
<span id="entity-balance-capacity-evacuate"></span><h3>balance.capacity.evacuate<a class="headerlink" href="#balance-capacity-evacuate" title="Permalink to this headline">¶</a></h3>
<p>Balancing can also be required in case the storage capacity is reduced.</p>
</section>
<section id="pdclust">
<span id="entity-pdclust"></span><h3>pdclust<a class="headerlink" href="#pdclust" title="Permalink to this headline">¶</a></h3>
<p>Mero uses parity declustered layout for storing objects. Mero’s implementation of pdclust layout
has two advantages:</p>
<blockquote>
<div><dl class="simple">
<dt>-Formulaic layout: object offset is translated to disk and disk offset using a formula,</dt><dd><p>hence a lookup table is not needed.</p>
</dd>
</dl>
<p>-Improved IO and recovery performance.</p>
</div></blockquote>
<p>Under this layout every object is divided into chunks known as [<a class="reference internal" href="#entity-pdclust-unit">pdclust.unit</a>] and parity
is calculated for collection of such units. Such a collection is known as a parity group. Number of
parities to be calculated per parity group is configurable. Eg. If
object size is 65 MB, and unit size is 1 MB. Then a possible way is to form 9 parity groups,
each consisting of 8 units, and say 3 parity units per group (3 parities calculated over 8 units).</p>
</section>
<section id="pdclust-unit">
<span id="entity-pdclust-unit"></span><h3>pdclust.unit<a class="headerlink" href="#pdclust-unit" title="Permalink to this headline">¶</a></h3>
<p>Data of an object is divided into fixed sized chunks known as units..</p>
</section>
<section id="pdclust-paritygroup">
<span id="entity-pdclust-paritygroup"></span><h3>pdclust.paritygroup<a class="headerlink" href="#pdclust-paritygroup" title="Permalink to this headline">¶</a></h3>
<p>A parity group is a collection of [<a class="reference internal" href="#entity-pdclust-unit">pdclust.unit</a>]s along with a set of parities calculated over them. It also includes
spare units (to which repaired units from a parity group go).</p>
</section>
<section id="pdclust-target">
<span id="entity-pdclust-target"></span><h3>pdclust.target<a class="headerlink" href="#pdclust-target" title="Permalink to this headline">¶</a></h3>
<p>Target stores the unit of a parity group into a [<a class="reference internal" href="#entity-pdclust-targetframe">pdclust.targetframe</a>].</p>
</section>
<section id="pdclust-targetframe">
<span id="entity-pdclust-targetframe"></span><h3>pdclust.targetframe<a class="headerlink" href="#pdclust-targetframe" title="Permalink to this headline">¶</a></h3>
<p>Target frame represents a basic storage block in a logical storage space associated with an object on a given target.
Frame size is same as the unit size associated with an object.</p>
</section>
<section id="failuredomain">
<span id="entity-failuredomain"></span><h3>failuredomain<a class="headerlink" href="#failuredomain" title="Permalink to this headline">¶</a></h3>
<p>Any hardware resource or collection of thereof, failure of which can potentially cause a loss
of object data is called as a failure domain. The typical set of failure domains
includes (but is not limited to):</p>
<blockquote>
<div><ul class="simple">
<li><p>site;</p></li>
<li><p>rack;</p></li>
<li><p>enclosure;</p></li>
<li><p>controller;</p></li>
<li><p>disk.</p></li>
</ul>
</div></blockquote>
</section>
<section id="failuredomain-tree">
<span id="entity-failuredomain-tree"></span><h3>failuredomain.tree<a class="headerlink" href="#failuredomain-tree" title="Permalink to this headline">¶</a></h3>
<p>A hierarchial topology in which various [<a class="reference internal" href="#entity-failuredomain">failuredomain</a>] are arranged is
known as a failure domains tree. With every [<a class="reference internal" href="#entity-pool-pver">pool.pver</a>] there are associated
a collection of failure domains trees.</p>
</section>
<section id="pool">
<span id="entity-pool"></span><h3>pool<a class="headerlink" href="#pool" title="Permalink to this headline">¶</a></h3>
<p>A pool provides an abstraction for collection of configuration objects that can
potentially be used to store Mero objects.
These objects form a tree hierarchy of which a pool is the root node.</p>
</section>
<section id="pool-pver">
<span id="entity-pool-pver"></span><h3>pool.pver<a class="headerlink" href="#pool-pver" title="Permalink to this headline">¶</a></h3>
<p>A pool version is a subtree of a pool [<a class="reference internal" href="#entity-pool">pool</a>]. The layout of an object gets
associated with a pool version. Multiple pool versions (possibly with
overlapping subtrees) can be formed over a given pool.  A pool version can have
a presence either in memory or in configuration database or at both places. Mero
has three types of pool versions:</p>
<blockquote>
<div><ul class="simple">
<li><p>[<a class="reference internal" href="#entity-pool-pver-actual">pool.pver.actual</a>];</p></li>
<li><p>[<a class="reference internal" href="#entity-pool-pver-formulaic">pool.pver.formulaic</a>];</p></li>
<li><p>[<a class="reference internal" href="#entity-pool-pver-virtual">pool.pver.virtual</a>];</p></li>
</ul>
</div></blockquote>
<table class="colwidths-given docutils align-default" id="id18">
<caption><span class="caption-text">Pool version</span><a class="headerlink" href="#id18" title="Permalink to this table">¶</a></caption>
<colgroup>
<col style="width: 43%" />
<col style="width: 29%" />
<col style="width: 29%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Pool version type</p></th>
<th class="head"><p>In memory</p></th>
<th class="head"><p>In conf DB</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Actual</p></td>
<td><p>Present</p></td>
<td><p>Present</p></td>
</tr>
<tr class="row-odd"><td><p>Formulaic</p></td>
<td><p>Absent</p></td>
<td><p>Present</p></td>
</tr>
<tr class="row-even"><td><p>Virtual</p></td>
<td><p>Present</p></td>
<td><p>Absent</p></td>
</tr>
</tbody>
</table>
<figure class="align-default" id="id19">
<img alt="_images/pver.relations.png" src="_images/pver.relations.png" />
<figcaption>
<p><span class="caption-text">Relation in formulaic and virtual pool versions.</span><a class="headerlink" href="#id19" title="Permalink to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="pool-pver-actual">
<span id="entity-pool-pver-actual"></span><h3>pool.pver.actual<a class="headerlink" href="#pool-pver-actual" title="Permalink to this headline">¶</a></h3>
<p>An actual pool version is also known as a base pool version. All the configuration objects that constitute an
actual pool version are known at the time of Mero bootstrap and hence an actual pool version is present in
persistent configuration schema.</p>
</section>
<section id="pool-pver-formulaic">
<span id="entity-pool-pver-formulaic"></span><h3>pool.pver.formulaic<a class="headerlink" href="#pool-pver-formulaic" title="Permalink to this headline">¶</a></h3>
<p>A formulaic pool version is present in conf DB and is always associated with one
of the actual pool versions [<a class="reference internal" href="#entity-pool-pver-actual">pool.pver.actual</a>].  It only indicates how many
failures at various levels of actual pool version can be allowed to create new
pool versions that would skip the failed objects.</p>
</section>
<section id="pool-pver-virtual">
<span id="entity-pool-pver-virtual"></span><h3>pool.pver.virtual<a class="headerlink" href="#pool-pver-virtual" title="Permalink to this headline">¶</a></h3>
<p>A virtual pool version is an instance of formulaic pool version
[<a class="reference internal" href="#entity-pool-pver-formulaic">pool.pver.formulaic</a>] and hence is always associated with an actual pool
version [<a class="reference internal" href="#entity-pool-pver-actual">pool.pver.actual</a>] and a set of failed configuration objects. An in
memory instance of a virtual pool version gets created only when it needs to be
associated with an object.</p>
</section>
<section id="pool-pver-allowancevector">
<span id="entity-pool-pver-allowancevector"></span><h3>pool.pver.allowancevector<a class="headerlink" href="#pool-pver-allowancevector" title="Permalink to this headline">¶</a></h3>
<p>An allowance vector associated with a pool version [<a class="reference internal" href="#entity-pool-pver">pool.pver</a>] has dimension
same as the height of pool version tree and each level of it indicates the
allowed number of failures at that level in pool version tree that can be
accommodated to create a formulaic pool version [<a class="reference internal" href="#entity-pool-pver-formulaic">pool.pver.formulaic</a>].</p>
</section>
<section id="pool-pver-tolerancevector">
<span id="entity-pool-pver-tolerancevector"></span><h3>pool.pver.tolerancevector<a class="headerlink" href="#pool-pver-tolerancevector" title="Permalink to this headline">¶</a></h3>
<p>A tolerance vector associated with a pool version [<a class="reference internal" href="#entity-pool-pver">pool.pver</a>] has dimension
same as the height of pool version tree, and it indicates the number of failures
that can be tolerated for reading an object, at each level of the tree.</p>
</section>
<section id="pool-pver-pooldev">
<span id="entity-pool-pver-pooldev"></span><h3>pool.pver.pooldev<a class="headerlink" href="#pool-pver-pooldev" title="Permalink to this headline">¶</a></h3>
<p>In memory representation for a storage device used by pools component.</p>
</section>
<section id="pool-pver-poolmachine">
<span id="entity-pool-pver-poolmachine"></span><h3>pool.pver.poolmachine<a class="headerlink" href="#pool-pver-poolmachine" title="Permalink to this headline">¶</a></h3>
<p>An abstraction for the collection of pooldevs [<a class="reference internal" href="#entity-pool-pver-pooldev">pool.pver.pooldev</a>] present in
a pool version.</p>
</section>
<section id="pool-pver-selectionpolicy">
<span id="entity-pool-pver-selectionpolicy"></span><h3>pool.pver.selectionpolicy<a class="headerlink" href="#pool-pver-selectionpolicy" title="Permalink to this headline">¶</a></h3>
<p>A pool version [<a class="reference internal" href="#entity-pool-pver">pool.pver</a>] can be constructed out of a pool [<a class="reference internal" href="#entity-pool">pool</a>] using
different policies. E.g., removing failed devices or removing most populated
devices, or removing devices with most bad blocks (as perceived by Mero)
etc. Pool versions are searched as per policy defined with pool while <a class="reference internal" href="#usecase-clovis-multi-site-create">create
object [`clovis.multi-site.create</a>] operation.</p>
</section>
<section id="pool-pver-poolmachine-poolmachinestate">
<span id="entity-pool-pver-poolmachine-poolmachinestate"></span><h3>pool.pver.poolmachine.poolmachinestate<a class="headerlink" href="#pool-pver-poolmachine-poolmachinestate" title="Permalink to this headline">¶</a></h3>
<p>The state of devices that are part of a pool machine [<a class="reference internal" href="#entity-pool-pver-poolmachine">pool.pver.poolmachine</a>] indicates the availability of device.
The possible states are:
:: M0_PNDS_UNKNOWN, M0_PNDS_ONLINE, M0_PNDS_FAILED, M0_PNDS_OFFLINE,</p>
<blockquote>
<div><p>M0_PNDS_SNS_REPAIRING, M0_PNDS_SNS_REPAIRED</p>
</div></blockquote>
</section>
<section id="entity-hld">
<span id="id16"></span><h3>hld<a class="headerlink" href="#entity-hld" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>document</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a href="#id382"><span class="problematic" id="id383">`development.process &lt;entity.development.process_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#usecase-development-cycle">development.cycle</a>]</p>
</dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="dld">
<span id="entity-dld"></span><h3>dld<a class="headerlink" href="#dld" title="Permalink to this headline">¶</a></h3>
<p>Detailed level design (dld) is a document specifying a software module or
modules in detail sufficient to start coding.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>document</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a href="#id384"><span class="problematic" id="id385">`development.process &lt;entity.development.process_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#usecase-development-cycle">development.cycle</a>]</p>
</dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="dldinsp">
<span id="entity-dldinsp"></span><h3>dldinsp<a class="headerlink" href="#dldinsp" title="Permalink to this headline">¶</a></h3>
<p>dld inspection is a process of reviewing a dld with the purpose of verifying
that it conforms to the appropriate hld [<a class="reference internal" href="#entity-hld">hld</a>] and the architecture
specification.</p>
<p>Inspections can be internal (done by the dld authors) or external. An inspection
starts with the formal checks including:</p>
<blockquote>
<div><ul class="simple">
<li><p>conformance to the dld style guide;</p></li>
<li><p>dld must include the list of use cases and the list should be complete;</p></li>
<li><p>dld must describe all the data-structures introduced and their invariants;</p></li>
<li><p>dld must describe concurrency control policies, including:</p>
<ul>
<li><p>locks, description of data-structures and invariants protected by the locks;</p></li>
<li><p>lock ordering;</p></li>
<li><p>wait channels and condition variables;</p></li>
<li><p>concurrency assumptions;</p></li>
</ul>
</li>
<li><p>memory management and ownership of allocated objects;</p></li>
<li><p>interfaces and their implementations, including pre- and post- conditions
of all functions;</p></li>
<li><p>liveness of data structures and allocated memory;</p></li>
<li><p>description of possible failures and their handling.</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>process</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a href="#id386"><span class="problematic" id="id387">`development.process &lt;entity.development.process_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#usecase-development-cycle">development.cycle</a>]</p>
</dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="codeinsp">
<span id="entity-codeinsp"></span><h3>codeinsp<a class="headerlink" href="#codeinsp" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>document</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a href="#id388"><span class="problematic" id="id389">`development.process &lt;entity.development.process_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#usecase-development-cycle">development.cycle</a>]</p>
</dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="rack">
<span id="entity-rack"></span><h3>rack<a class="headerlink" href="#rack" title="Permalink to this headline">¶</a></h3>
<img alt="images/eos.rack.png" src="images/eos.rack.png" />
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>hardware</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a href="#id390"><span class="problematic" id="id391">`hardware &lt;entity.hardware_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a href="#id392"><span class="problematic" id="id393">`enclosure &lt;entity.enclosure_&gt;`_</span></a>], [<a href="#id394"><span class="problematic" id="id395">`switch &lt;entity.switch_&gt;`_</span></a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="clovis">
<span id="entity-clovis"></span><h3>clovis<a class="headerlink" href="#clovis" title="Permalink to this headline">¶</a></h3>
<p>clovis (not an acronym) is the external interface that Mero provides to
applications. It replaces the traditional file-system access interfaces and
protocols (posix, nfs, cifs, etc.) as well as proprietary control
interfaces. The clovis interface consists of sub-interfaces:</p>
<blockquote>
<div><ul class="simple">
<li><p>clovis access sub-interface that provides basic storage abstractions: data
object, key-value index, transaction, operation;</p></li>
<li><p>clovis extension sub-interface that provides access to the fdmi
sub-system;</p></li>
<li><p>clovis management sub-interface that provides features for system
configuration, deployment, monitoring and analysis.</p></li>
</ul>
</div></blockquote>
<p>The goals of the clovis interface design are:</p>
<blockquote>
<div><ul class="simple">
<li><p>scalable</p>
<ul>
<li><p>no central meta-data,</p></li>
<li><p>tunable consistency guarantees,</p></li>
<li><p>aggregation, containers;</p></li>
</ul>
</li>
<li><p>complete</p>
<ul>
<li><p>storage access,</p></li>
<li><p>management,</p></li>
<li><p>monitoring;</p></li>
</ul>
</li>
<li><p>portable</p>
<ul>
<li><p>not tied to POSIX,</p></li>
<li><p>user space and kernel;</p></li>
</ul>
</li>
<li><p>flexible;</p></li>
<li><p>no fixed meta-data scheme;</p></li>
<li><p>extensibility, plugins;</p></li>
<li><p>re-usable concepts;</p></li>
<li><p>trusted users can extend system: layouts, resources;</p></li>
<li><p>simple security mechanism: capabilities</p></li>
</ul>
</div></blockquote>
<p>There are several typical clovis use cases:</p>
<blockquote>
<div><ul class="simple">
<li><p>in the simplest case, an application uses only access interface. Storage
objects are used to keep data and key-value indices for meta-data,
effectively using Mero as a scalable transactional object store;</p></li>
<li><p>alternatively, a special front-end application can use clovis to implement
a “standard” interface, like posix, hdf5 or s3, enabling existing
applications to run on top of Mero;</p></li>
<li><p>by using clovis extension interface, an application can extend core Mero
functionality and add more features without modifying core code or
hampering scalability.</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>interface</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a href="#id396"><span class="problematic" id="id397">`mero &lt;entity.mero_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#entity-clovis-object">clovis.object</a>], [<a class="reference internal" href="#entity-clovis-index">clovis.index</a>], [<a class="reference internal" href="#entity-clovis-container">clovis.container</a>],
[<a class="reference internal" href="#entity-clovis-operation">clovis.operation</a>]</p>
</dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p>[<a href="#id398"><span class="problematic" id="id399">`s3 &lt;entity.s3_&gt;`_</span></a>], [<a class="reference internal" href="#entity-nfs">nfs</a>]</p>
</dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><ul class="simple">
<li><p><a class="reference external" href="https://docs.google.com/presentation/d/1gh3qtPK6l69VjORMWkogMCO24kGEJ4dDjIdcNGkSFtk">Clovis presentation</a></p></li>
<li><p><a class="reference external" href="https://docs.google.com/document/d/1weQya-S3b9uW7whD0I1du2MoXoo90gx6w1kCFvGpavQ/edit#heading=h.pmj23otvi9c">Clovis section in Mero in prose</a></p></li>
<li><p><a class="reference external" href="https://docs.google.com/presentation/d/1TEa6AKxdnqTowLdVSxuP7jefElO3eQwoxQ8SBDmXrds">Clovis introduction presentation</a></p></li>
</ul>
</dd>
</dl>
</section>
<section id="clovis-entity">
<span id="entity-clovis-entity"></span><h3>clovis.entity<a class="headerlink" href="#clovis-entity" title="Permalink to this headline">¶</a></h3>
<p>clovis objects [<a class="reference internal" href="#entity-clovis-object">clovis.object</a>], indices [<a class="reference internal" href="#entity-clovis-index">clovis.index</a>] and containers
[<a class="reference internal" href="#entity-clovis-container">clovis.container</a>] are collectively known as clovis <em>entities</em>. An entity is
uniquely identified by a cluster-wide never reused identifier called fid
[<a href="#id400"><span class="problematic" id="id401">`fid &lt;entity.fid_&gt;`_</span></a>], selected by the user when the entity is created. A fid is 128-bits
wide with 8 most significant bits identifying the entity type. mero provides a
fid allocator [<a href="#id402"><span class="problematic" id="id403">`fid.allocator &lt;entity.fid.allocator_&gt;`_</span></a>] interface to generate unique fids.</p>
<p>clovis provides bulk operations on entities, which is an ability to invoke a
specified server-side function with contents of an entity as parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p>for an object this means invoking the function with object data-blocks as
input parameters;</p></li>
<li><p>for an index this means invoking the function with index key-value records
as parameters;</p></li>
<li><p>for a container this means invoking the function with the fid of each
container element as a parameter.</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>interface</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a href="#id404"><span class="problematic" id="id405">`mero &lt;entity.mero_&gt;`_</span></a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="clovis-object">
<span id="entity-clovis-object"></span><h3>clovis.object<a class="headerlink" href="#clovis-object" title="Permalink to this headline">¶</a></h3>
<p>A (data) object is used to store large amounts of data. An object is an array of
fixed size blocks (block size specified at object creation time), indexed by
64-bit integers. Data, stored in the object, can be read or overwritten at the
block granularity. Contrary to more traditional object stores and file system,
an object has no attributes associated with it, except for an 128-bit
identifier, selected by the application when the object is created. By design,
all meta-data, if any, associated with the object must be stored separately in
the key-value indices [<a class="reference internal" href="#entity-clovis-index">clovis.index</a>]. Instead of per-object attributes, an
object has block attributes (<strong>not currently implemented</strong>), associated with
every block. Such block attributes are used by application to store meta-data
required in data IO path, for example, data integrity check-sums, or
cryptographic attributes. Storing such per-block meta-data attributes in a
key-value index would incur a cost of separate network round-trip in every IO
operation. Mero stores attributes together with its internal meta-data, which is
accessed to locate the data blocks, thus avoiding an extra cost of attribute
lookup. Data IO to an object is fully vectored: data transfer (read or write) is
done between a sequence of application-provided buffers and a sequence of block
extents within the object. IO semantics is deliberately weak. The implementation
has complete freedom is executing actual in any order without ordering
guarantees in case of failure halfway through the operation.  Additional
operations are provided to pre-allocate particular data-blocks and free
allocated data-blocks.</p>
<img alt="images/clovis.object.png" src="images/clovis.object.png" />
<p>Note: the clovis interface calls in the diagram above are pseudo-code.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>interface</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-clovis">clovis</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><ul class="simple">
<li><p>[] implement block attributes</p></li>
</ul>
</dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="clovis-index">
<span id="entity-clovis-index"></span><h3>clovis.index<a class="headerlink" href="#clovis-index" title="Permalink to this headline">¶</a></h3>
<p>A key-value index is used to store meta-data and small amounts of data (in the
sense that it is more efficient to use objects [<a class="reference internal" href="#entity-clovis-object">clovis.object</a>] to store
large amounts of data). An index stores records, where a record is a key-value
pair. Indices have a fairly standard repertoire of operations to insert, delete,
lookup and iterate records. The interface is fully vectored (multiple records
can be updated or queried at once). An application can create an arbitrary
number of indices, each named by a 128-bit identifier, assigned by the
application. As in case of objects, an index has no application-visible
attributes.</p>
<p>The plural of “index” is “indices”.</p>
<img alt="images/clovis.index.png" src="images/clovis.index.png" />
<p>Note: the clovis interface calls in the diagram above are pseudo-code.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>interface</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-clovis">clovis</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="clovis-container">
<span id="entity-clovis-container"></span><h3>clovis.container<a class="headerlink" href="#clovis-container" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>interface</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-clovis">clovis</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="clovis-operation">
<span id="entity-clovis-operation"></span><h3>clovis.operation<a class="headerlink" href="#clovis-operation" title="Permalink to this headline">¶</a></h3>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>interface</p>
</dd>
<dt class="field-even">Parents</dt>
<dd class="field-even"><p>[<a class="reference internal" href="#entity-clovis">clovis</a>]</p>
</dd>
<dt class="field-odd">Sub-entities</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Use-cases</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Owners</dt>
<dd class="field-odd"><p>nikita</p>
</dd>
<dt class="field-even">Uses</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Used</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Properties</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Invariants</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">State machines</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Components</dt>
<dd class="field-odd"><p>[<a class="reference internal" href="#component-mero">mero</a>]</p>
</dd>
<dt class="field-even">Features</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Tests</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">History</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Known problems</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Requests</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">Questions</dt>
<dd class="field-odd"><p></p></dd>
<dt class="field-even">Alternatives</dt>
<dd class="field-even"><p></p></dd>
<dt class="field-odd">References</dt>
<dd class="field-odd"><p></p></dd>
</dl>
</section>
<section id="copymachine">
<span id="entity-copymachine"></span><h3>copymachine<a class="headerlink" href="#copymachine" title="Permalink to this headline">¶</a></h3>
<p>Copymachine is a generic state machine based framework that can be used to implement a distributed operation
like sns repair and rebalance. It provides some common functionality that can be used by specific operations,
e.g. resource throttling and state persistence.</p>
</section>
<section id="copymachine-pump">
<span id="entity-copymachine-pump"></span><h3>copymachine.pump<a class="headerlink" href="#copymachine-pump" title="Permalink to this headline">¶</a></h3>
<p>Copymachine pump is an entity that is part of generic copy machine framework. Copy machine pump is
implemented using mero fom infrastructure. Copy machine pump creates copy packets ([<a href="#id406"><span class="problematic" id="id407">`copymachine.copypacket &lt;entity.copymachine.copypacket_&gt;`_</span></a>])
and invokes the operation (e.g. repair/rebalance) specific data iterator to populate the copy packet.</p>
</section>
<section id="copymachine-aggregation-group">
<span id="entity-copymachine-aggregation-group"></span><h3>copymachine.aggregation.group<a class="headerlink" href="#copymachine-aggregation-group" title="Permalink to this headline">¶</a></h3>
<p>Aggregation group represents a collection of copy packets that share the common properties, e.g. a parity
group.</p>
</section>
<section id="copymachine-copypacket">
<span id="entity-copymachin-copypacket"></span><h3>copymachine.copypacket<a class="headerlink" href="#copymachine-copypacket" title="Permalink to this headline">¶</a></h3>
<p>Copymachine copypacket is part of the generic copy machine framework and has some common information that can
be used by the specific operations. Specific operation like sns repair or rebalance can inherit from this
generic copymachine copypacket and have their own specific information augmented to it.</p>
</section>
<section id="copymachine-proxy">
<span id="entity-copymachine-proxy"></span><h3>copymachine.proxy<a class="headerlink" href="#copymachine-proxy" title="Permalink to this headline">¶</a></h3>
<p>Copymachine proxy represents a remote copymachine on another node in cluster. It is an entity in proxy
protocol and is used to implement the sliding window protocol. A typical copy machine proxy maintains
the state and progress of remote copymachine. Proxy protocol can be used to notify about the failure
of a remote copy machine to others participating in the distributed operation.</p>
</section>
<section id="copymachine-proxy-update">
<span id="entity-copymachine-proxy-update"></span><h3>copymachine.proxy.update<a class="headerlink" href="#copymachine-proxy-update" title="Permalink to this headline">¶</a></h3>
<p>As the state of copymachine changes the peer copymachines are updated through the proxy protocol
via the corressponding proxies.</p>
</section>
<section id="copymachine-sliding-window">
<span id="entity-copymachine-sliding-window"></span><h3>copymachine.sliding.window<a class="headerlink" href="#copymachine-sliding-window" title="Permalink to this headline">¶</a></h3>
<p>Various resource constraints can be imposed using sliding window. Presently for sns repair and rebalance,
the memory constraints are imposed using buffer pool. So, sender and receiver of the data create data
packets ([<a href="#id408"><span class="problematic" id="id409">`copymachine.copypacket &lt;entity.copymachine.copypacket_&gt;`_</span></a>]) only if the required space is available in the relevant buffer
pools. As the copy packets are created, which are typically part of an aggregation group
([<a class="reference internal" href="#entity-copymachine-aggregation-group">copymachine.aggregation.group</a>]), the corresponding aggregation group is added to the sliding window.
The update to the sliding window is then notified to the copy machine peers and the sender can then send
and receiver can receive the data accordingly.</p>
<p class="plantuml">
<img src="_images/plantuml-d16c32a562e8a4acd5a664eea23c2a2aca4d26af.png" alt="participant sender
participant sendRecvProxy
participant bufferPoolOut
participant bufferPoolIn
participant receiver
participant recvSendProxy

sender &lt;-&gt; bufferPoolOut: has space Yes/No
sender -&gt; sender: outgoing aggregation group create
receiver &lt;-&gt; bufferPoolIn: has space Yes/No
receiver -&gt; receiver: incoming aggregation group create
receiver &lt;-&gt; recvSendProxy: isUpdated ? No
receiver -&gt; sender: sw[lo, hi] update send
sender -&gt; sendRecvProxy: update proxy
sender -&gt; receiver: send copy packets as per sw[lo, hi]"/>
</p>
</section>
<section id="copymachine-status">
<span id="entity-copymachine-status"></span><h3>copymachine.status<a class="headerlink" href="#copymachine-status" title="Permalink to this headline">¶</a></h3>
<p>Copymachine can typically be in prepare, ready, started, failed or stopped state. This state is communicated
to the peer copymachines through proxies.</p>
</section>
<section id="copymachine-sns-repreb">
<span id="entity-copymachine-sns-repreb"></span><h3>copymachine.sns.repreb<a class="headerlink" href="#copymachine-sns-repreb" title="Permalink to this headline">¶</a></h3>
<p>Sns repair and rebalance are implemented as mero services which use and extend the generic copy machine
framework.</p>
</section>
<section id="copymachine-sns-repreb-trigger">
<span id="entity-copymachine-sns-repreb-trigger"></span><h3>copymachine.sns.repreb.trigger<a class="headerlink" href="#copymachine-sns-repreb-trigger" title="Permalink to this headline">¶</a></h3>
<p>Sns repair or rebalance are implemented as copy machines. On a drive failure, halon triggers sns repair and
triggers sns rebalance on drive replacement.</p>
<p class="plantuml">
<img src="_images/plantuml-a4fb9d8e1d4aa5370e110fd429b22b0c6166b4af.png" alt="participant Halon as H
participant repreb1 as rr1
participant agStore as ags
participant BE
participant swUpdateFom as swu
participant repreb2 as rr2

H -&gt; rr1:   Repair/Rebalance trigger
H -&gt; rr2:   Repair/Rebalance trigger
rr1 -&gt; rr1: cm prepare
rr1 -&gt; ags: AG store start
ags -&gt; BE: fetch saved sw
BE -&gt; ags: data ready
ags -&gt; ags: initialise local SW
ags -&gt; swu: start/update SW
rr1 -&gt; rr1: cm ready
rr1 -&gt; rr2: Send initial sliding window
rr1 -&gt; rr1: cm start
rr1 -&gt; H: reply start success/failure
rr2 -&gt; rr2: cm prepare
rr2 -&gt; rr2: cm ready
rr2 -&gt; rr1: Send initial sliding window
rr2 -&gt; rr2: cm start
rr2 -&gt; H: reply start success/failure"/>
</p>
</section>
<section id="copymachine-sns-repreb-copypacket">
<span id="entity-copymachine-sns-repreb-copypacket"></span><h3>copymachine.sns.repreb.copypacket<a class="headerlink" href="#copymachine-sns-repreb-copypacket" title="Permalink to this headline">¶</a></h3>
<p>Sns copy machines (repair and rebalance) inherit and augment generic copy packet which is used to carry
data from storage to some peer copymachine.</p>
<p class="plantuml">
<img src="_images/plantuml-ca6c11c5d30fd305bf8f8b6baf8383e5f1f9ef66.png" alt="participant pump
participant snscm
participant Iter
participant cpFom
participant stob
participant parityMath
participant proxy
participant repreb2

pump -&gt; snscm: create copy packet
snscm -&gt; pump: success
pump -&gt; Iter: copy packet metadata fill
Iter -&gt; Iter: file/group/cob next
Iter -&gt; Iter: cp setup
Iter -&gt; pump: copy packet ready
pump -&gt; cpFom: launch copy packet fom
cpFom -&gt; cpFom: INIT
cpFom -&gt; cpFom: READ
cpFom -&gt; stob: read data
stob -&gt; cpFom: read success/failure
cpFom -&gt; cpFom: XFORM/FINI
cpFom &lt;-&gt; parityMath: transform data and accumulate
cpFom -&gt; cpFom: SWCHECK
cpFom &lt;-&gt; proxy: Can send ? Yes/No
cpFom -&gt; cpFom: SEND
cpFom &lt;-&gt; repreb2: copy packet send/Ack
cpFom -&gt; cpFom: FINI"/>
</p>
</section>
<section id="copymachine-sns-repreb-aggregation-group">
<span id="entity-sns-repreb-aggregation-group"></span><h3>copymachine.sns.repreb.aggregation.group<a class="headerlink" href="#copymachine-sns-repreb-aggregation-group" title="Permalink to this headline">¶</a></h3>
<p>Similar to copy packet, sns aggregation group is derived from its generic counter part and stores additional
information that is specific to the operation.</p>
</section>
<section id="copymachine-sns-repreb-agiter">
<span id="entity-copymachine-sns-repreb-agiter"></span><h3>copymachine.sns.repreb.agiter<a class="headerlink" href="#copymachine-sns-repreb-agiter" title="Permalink to this headline">¶</a></h3>
<p>Sns aggregation group iterator, iterates over file namespare and identifies and creates aggregation groups
that have incoming copy packets from the peer copy machines. Aggregation group iterator is invoked in
context of copy machine sliding window update fom.</p>
</section>
<section id="copymachine-sns-repreb-iter">
<span id="entity-copymachine-sns-repreb-iter"></span><h3>copymachine.sns.repreb.iter<a class="headerlink" href="#copymachine-sns-repreb-iter" title="Permalink to this headline">¶</a></h3>
<p>Sns repair/rebalance iterator or data iterator, iterates over file namespace and identifies and creates aggregation
groups having data that is to be sent to some other peer copy machine in the cluster with respect to failure.</p>
<p class="plantuml">
<img src="_images/plantuml-fa4b9943b7e2043173197a6af38ad0c28a50f48a.png" alt="participant pump
participant iter
participant cobDomain
participant RM
participant MD
participant layout
participant bufferPool

pump -&gt; iter : setup copy packet
iter -&gt; iter : FID_NEXT
iter &lt;-&gt; cobDomain : file next
iter &lt;-&gt; iter : FID LOCK(no-op in oostore)
iter -&gt; iter : ATTR_LAYOUT_FETCH
iter -&gt; MD : attr fetch request
MD -&gt; iter : attr fetch success/failure
iter -&gt; iter : GROUP_NEXT
iter &lt;-&gt; layout : identify next relevant group
iter -&gt; iter : COB NEXT
iter &lt;-&gt; layout : identify next unit cob
iter -&gt; iter : CP SETUP
iter &lt;-&gt; bufferPool : buffer fetch
iter -&gt; pump : cp ready"/>
</p>
</section>
<section id="copymachine-sns-repreb-storage">
<span id="entity-copymachine-sns-repreb-storage"></span><h3>copymachine.sns.repreb.storage<a class="headerlink" href="#copymachine-sns-repreb-storage" title="Permalink to this headline">¶</a></h3>
<p>Sns repair/rebalance reads and writes data to storage using mero stob infrastructure. Storage is one of the phases
of sns copy packet fom through which the io is performed.</p>
</section>
<section id="copymachine-sns-repreb-xform">
<span id="entity-copymachine-sns-repreb-xform"></span><h3>copymachine.sns.repreb.xform<a class="headerlink" href="#copymachine-sns-repreb-xform" title="Permalink to this headline">¶</a></h3>
<p>After reading data sns repair performs certain tranformations on relevant data in-order to recover the missing
data.</p>
</section>
<section id="copymachine-sns-repreb-net">
<span id="entity-copymachine-sns-repreb-net"></span><h3>copymachine.sns.repreb.net<a class="headerlink" href="#copymachine-sns-repreb-net" title="Permalink to this headline">¶</a></h3>
<p>Every sns repair/rebalance after transforming its local data to partially recover the missing data, the
recovered piece of missing data is sent to its relevant destination.</p>
</section>
<section id="copymachine-sns-repreb-halon">
<span id="entity-copymachine-sns-repreb-halon"></span><h3>copymachine.sns.repreb.halon<a class="headerlink" href="#copymachine-sns-repreb-halon" title="Permalink to this headline">¶</a></h3>
<p>Halon is responsible to send appropriate commands to the sns repair/rebalance services in the cluster,
which comprises of start, quiesce, resume, abort and status of sns repair/rebalance operation.</p>
</section>
<section id="copymachine-sns-repreb-layout">
<span id="entity-copymachine-sns-repreb-layout"></span><h3>copymachine.sns.repreb.layout<a class="headerlink" href="#copymachine-sns-repreb-layout" title="Permalink to this headline">¶</a></h3>
<p>Sns repair/rebalance uses layout to identify the remaining live as well the target units in the cluster
during a recovery operation.</p>
</section>
<section id="copymachine-sns-repreb-paritymath">
<span id="entity-copymachine-sns-repreb-paritymath"></span><h3>copymachine.sns.repreb.paritymath<a class="headerlink" href="#copymachine-sns-repreb-paritymath" title="Permalink to this headline">¶</a></h3>
<p>Sns parity math module provides the data transformation assistence during sns repair operation.</p>
</section>
<section id="copymachine-sns-repreb-bufferpool">
<span id="entity-copymachine-sns-repreb-bufferpool"></span><h3>copymachine.sns.repreb.bufferpool<a class="headerlink" href="#copymachine-sns-repreb-bufferpool" title="Permalink to this headline">¶</a></h3>
<p>Sns repair/rebalance provisions a fixed size on incoming and outgoing bufferpool when the operation
starts. The buffers required for io and transformations are provided though these 2 bufferpool.
They also help in imposing memory bandwidth contraints on the repair/rebalance operations.</p>
</section>
<section id="copymachine-sns-repreb-be">
<span id="entity-copymachine-sns-repreb-be"></span><h3>copymachine.sns.repreb.be<a class="headerlink" href="#copymachine-sns-repreb-be" title="Permalink to this headline">¶</a></h3>
<p>Sns repair/rebalance uses mero backend (be) to persist the progress of the operation, mainly the
last aggregation group ([<a href="#id410"><span class="problematic" id="id411">`copymachine.sns.repreb.aggregation.group &lt;entity.copymachine.sns.repreb.aggregation.group_&gt;`_</span></a>]) successfully processed.</p>
</section>
<section id="copymachine-sns-repreb-di">
<span id="entity-copymachine-sns-repreb-di"></span><h3>copymachine.sns.repreb.di<a class="headerlink" href="#copymachine-sns-repreb-di" title="Permalink to this headline">¶</a></h3>
<p>Sns repair/rebalance uses mero di to read and write checksums during io operations. On checksum
mismatch, a background scrub request is submitted to repair the relevant corrupted data block.
It is possible that the drive failure is reported in subsequent io failures.</p>
</section>
<section id="copymachine-sns-repreb-bsc">
<span id="entity-copymachine-sns-repreb-bsc"></span><h3>copymachine.sns.repreb.bsc<a class="headerlink" href="#copymachine-sns-repreb-bsc" title="Permalink to this headline">¶</a></h3>
<p>Background scrub request is submitted in case of checksum mismatch during sns read operation.
Repair will wait until the relevant block is repaired or marked as permanently failed.</p>
</section>
<section id="copymachine-sns-repreb-ccio">
<span id="entity-copymachine-sns-repreb-ccio"></span><h3>copymachine.sns.repreb.ccio<a class="headerlink" href="#copymachine-sns-repreb-ccio" title="Permalink to this headline">¶</a></h3>
<p>Concurrent io is supported during sns repair/rebalance operations. Sns uses proxy protocol,
support from mero stob layer or file locks inorder to maintain operational consistency.</p>
</section>
<section id="copymachine-sns-repreb-rm">
<span id="entity-copymachine-sns-repreb-rm"></span><h3>copymachine.sns.repreb.rm<a class="headerlink" href="#copymachine-sns-repreb-rm" title="Permalink to this headline">¶</a></h3>
<p>It is possible that sns uses file locks managed my mero resource manager (rm) inorder to
maintain operational consistency during concurrent io.</p>
</section>
<section id="copymachine-sns-repreb-pause-resume">
<span id="entity-copymachine-sns-repreb-pause-resume"></span><h3>copymachine.sns.repreb.pause.resume<a class="headerlink" href="#copymachine-sns-repreb-pause-resume" title="Permalink to this headline">¶</a></h3>
<p>Sns repair/rebalance operation can be paused and resumed by halon due to various reasons,
transient device failure during the operation, for instance.</p>
</section>
<section id="copymachine-sns-repreb-abort">
<span id="entity-copymachine-sns-repreb-abort"></span><h3>copymachine.sns.repreb.abort<a class="headerlink" href="#copymachine-sns-repreb-abort" title="Permalink to this headline">¶</a></h3>
<p>Halon may abort sns repair/rebalance operation due to failures when operation is in
progress.</p>
</section>
<section id="metadata-internal-cob">
<span id="entity-metadata-internal-cob"></span><h3>metadata.internal.cob:<a class="headerlink" href="#metadata-internal-cob" title="Permalink to this headline">¶</a></h3>
<p>Component objects are created as part of mero file creation, which are part of mero internal
metadata that uses mero backend ([<a class="reference internal" href="#entity-be">be</a>]), on a particular mero node.
Failure to read or write the mero internal metadata due to metadata drive failure or bitrot
triggers direct rebalance.</p>
</section>
<section id="metadata-internal-cob-attr">
<span id="entity-metadata-internal-cob-attr"></span><h3>metadata.internal.cob.attr<a class="headerlink" href="#metadata-internal-cob-attr" title="Permalink to this headline">¶</a></h3>
<p>Cob attributes are stored as part of cob metadata in mero backend.</p>
</section>
<section id="metadata-internal-balloc">
<span id="entity-metadata-internal-balloc"></span><h3>metadata.internal.balloc<a class="headerlink" href="#metadata-internal-balloc" title="Permalink to this headline">¶</a></h3>
<p>Mero block allocator ([<a class="reference internal" href="#entity-balloc">balloc</a>]) for a particular block device is part of mero internal metadata.
Balloc corruption is treated as disk failure and can trigger direct disk rebalance or node rebalance.</p>
</section>
<section id="metadata-internal-sns">
<span id="entity-metadata-internal-sns"></span><h3>metadata.internal.sns<a class="headerlink" href="#metadata-internal-sns" title="Permalink to this headline">¶</a></h3>
<p>Any corruption to internal metadata is treated as metadata drive failure and may trigger direct sns
rebalance.</p>
</section>
<section id="metadata-internal-be-checksum">
<span id="entity-metadata-internal-be-checksum"></span><h3>metadata.internal.be.checksum<a class="headerlink" href="#metadata-internal-be-checksum" title="Permalink to this headline">¶</a></h3>
<p>Mero backend ([<a class="reference internal" href="#entity-be">be</a>]) maintains internal checksum per be extent or segment in-order to detect
metadata bitrot.</p>
</section>
<section id="metadata-external-s3">
<span id="entity-metadata-external-s3"></span><h3>metadata.external.s3<a class="headerlink" href="#metadata-external-s3" title="Permalink to this headline">¶</a></h3>
<p>External metadata is typically the application specific metadata that is stored in Mero.
S3 is one of the applications that uses mero distributed key value store ([<a class="reference internal" href="#component-mero-dix">mero.dix</a>]). This
interface can be accesed using clovis C-API.</p>
</section>
<section id="metadata-external-clovis">
<span id="entity-metadata-external-clovis"></span><h3>metadata.external.clovis<a class="headerlink" href="#metadata-external-clovis" title="Permalink to this headline">¶</a></h3>
<p>Clovis is the mero C-API that provides interfaces to access the external metadata.</p>
</section>
<section id="metadata-external-be-checksum">
<span id="entity-metadata-external-be-checksum"></span><h3>metadata.external.be.checksum<a class="headerlink" href="#metadata-external-be-checksum" title="Permalink to this headline">¶</a></h3>
<p>Mero backend ([<a class="reference internal" href="#entity-be">be</a>]) maintains internal checksum per be extent or may be for overall be segment.
This checksum can be used to detect bitrot in eaternal metadata. In case of bitrot, direct dix
rebalance is triggered.</p>
</section>
<section id="metadata-external-bitrot">
<span id="entity-metadata-external-bitrot"></span><h3>metadata.external.bitrot<a class="headerlink" href="#metadata-external-bitrot" title="Permalink to this headline">¶</a></h3>
<p>Bitrot in external metadata is handled by starting DIX ([<a class="reference internal" href="#component-mero-dix">mero.dix</a>]) rebalance.</p>
</section>
<section id="metadata-external-dix-dtm0">
<span id="entity-metadata-external-dix-dtm0"></span><h3>metadata.external.dix.dtm0<a class="headerlink" href="#metadata-external-dix-dtm0" title="Permalink to this headline">¶</a></h3>
<p>External metadata transactions are executed through dtm0. Failures during a distributed
transaction, e.g. node restart during object creation in [<a class="reference internal" href="#component-mero-dix">mero.dix</a>] using synchronous
replication scheme, are handled by redoing the incomplete part of the transaction.</p>
</section>
<section id="metadata-external-directrebalance">
<span id="entity-metadata-external-directrebalance"></span><h3>metadata.external.directrebalance<a class="headerlink" href="#metadata-external-directrebalance" title="Permalink to this headline">¶</a></h3>
<p>Direct rebalance ([<a href="#id412"><span class="problematic" id="id413">`dix.direct_rebalance &lt;component.dix.direct_rebalance_&gt;`_</span></a>]) is triggered in case of permanent failures
such as metadata drive failure.</p>
</section>
<section id="ha-halon-model">
<span id="entity-ha-halon-model"></span><h3>ha.halon.model<a class="headerlink" href="#ha-halon-model" title="Permalink to this headline">¶</a></h3>
<p>TS
- replicas with quorum;
- persistence (optional, can be turned on and off);
- RC migration is invisible to other TS and SATs;
- can be connected to SATs and/or TSes.</p>
<p>SAT
- no persistence;
- can be connected to SATs and/or TSes;
- can communicate with other components.</p>
<p>Messaging
- messages are reliable: either the message is delivered or source and/or</p>
<blockquote>
<div><p>destination is failed permanently;</p>
</div></blockquote>
<ul>
<li><p>messages between the same source and destination are ordered;</p></li>
<li><p>the same message can’t be delived twice;</p></li>
<li><p>p2p messages:
- TS to TS;
- TS to SAT;
- SAT to SAT;
- TS or SAT to other component;</p></li>
<li><p>broadcast messages:
- TS to all SATs.</p></li>
<li><p>message contains:
- src</p>
<blockquote>
<div><ul class="simple">
<li><p>fid</p></li>
<li><p>current epoch</p></li>
<li><p>start epoch</p></li>
<li><p>software version</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>dst
- fid (if available)</p></li>
</ul>
</li>
<li><p>message interface:
- send() function</p>
<blockquote>
<div><ul class="simple">
<li><p>in
- message
- destination</p></li>
<li><p>out
- error code (success, destination is dead)</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>received() callback</p></li>
</ul>
</li>
</ul>
</section>
<section id="ha-state">
<span id="entity-ha-state"></span><h3>ha.state<a class="headerlink" href="#ha-state" title="Permalink to this headline">¶</a></h3>
<p>HA state is an attribute of a conf object [<a href="#id414"><span class="problematic" id="id415">`conf.obj &lt;entity.conf.obj_&gt;`_</span></a>] that tells what code
can do with the object.</p>
<p>List of HA states: ONLINE, TRANSIENT, FAILED.</p>
<p>The semantics of HA states may be different for different conf object types.</p>
<p>The users of HA states must assume that HA states may change at any moment.</p>
<p>pool
ONLINE - the pool can be used for I/O (data or metadata).
TRANSIENT - the pool must not be used for I/O.
FAILED - N/A.</p>
<p>node, process, service, sdev
ONLINE - the node/process/service is running, sdev can serve I/O requests.
TRANSIENT - the node/process/service is not running, but it may become ONLINE
again. sdev can’t serve I/O requests.
FAILED - the node/process/service is not going to be running. All internal
states associated with the node/process/service can be wiped.</p>
<p>site/rack/enclosure/controller/drive
ONLINE - can be used now
TRANSIENT - can’t be used right now, but may become ONLINE in the future.
FAILED - physically broken, needs replacement.</p>
<p>pver has no HA state. In every place where pver HA state may be needed the
pver’s pool HA state must be used.</p>
<p>root has no HA state.</p>
<p>Use cases:
1. cluster start/stop;
2. mkfs;
3. dynamic clients;
4. software update;
5. failover;
6. process start (including BE recovery);
7. hardware addition/removal/replacement/movement;
8. software (node/process/service) addition/removal/replacement/movement;
9. admin disables something (that corresponds to a conf object) (puts HOLD);
10. cancelling of I/O operations;
11. state interpretation by current data and metadata I/O path;
12. DTM recovery;
13. fsck (interactive/non-interactive);
14. data integrity verification;
15. disaster recovery;
16. RC migration;
17. loss of TS quorum;
18. cluster management when there is no quorum;
19. detecting failed processes by rpc timeouts from other processes;
20. cluster mkfs/start/stop with missing/failed drives/nodes;
21. active RM migration;
22. 10k nodes scalability;
23. pool modifications;
24. controlled (m0d) and not controlled (clovis app) Mero processes.</p>
<p>Notes:
- fids are not reused;
- assumption: Halon doesn’t use RPC for internal communications (need to</p>
<blockquote>
<div><p>verify);</p>
</div></blockquote>
<ul class="simple">
<li><p>current client: Clovis, data/metadata I/O.</p></li>
</ul>
</section>
<section id="ha-state-hold">
<span id="entity-ha-state-hold"></span><h3>ha.state.hold<a class="headerlink" href="#ha-state-hold" title="Permalink to this headline">¶</a></h3>
<p>A HOLD can be put on a conf object. The user can also remove a HOLD that was
put on a conf object before.</p>
<p>Semantics: a conf object with a HOLD can’t have ONLINE HA state.</p>
<p>Internally each conf object has a bool flag called FAILED_FLAG that tells if
the object is failed or not and a list of HOLDs. HA state is calculated this
way:
- if the object has FAILED_FLAG set then it’s in FAILED state;
- if the object has HOLDs then it’s in TRANSIENT state;
- otherwise it’s ONLINE.</p>
<p>Each HOLD has an owner. HOLD owner must be one of the conf objects in the
configuration or a Halon rule instance. HOLD is removed automatically iff:
- the conf object that is the owner is FAILED and it’s not in the configuration;
- the rule instance that is the owner is finished.</p>
<p>HA state can be calculated ignoring a set of HOLDs. In this case the HA state
calculations are performed the same way as if every HOLD from the set doesn’t
exist.</p>
<p>Each HOLD has 2 values associated with it: a 64-bit value and a short string.
The semantics of those values are defined by the HOLD owners are should be
completely ignored by everyone else.</p>
<p>Halon provides interfaces to put HOLDs on conf objects and to remove HOLDs from
conf objects.</p>
</section>
<section id="ha-state-dependency">
<span id="entity-ha-state-dependency"></span><h3>ha.state.dependency<a class="headerlink" href="#ha-state-dependency" title="Permalink to this headline">¶</a></h3>
<p>There are state changes to conf objects that lead to state changes to another
objects. Such kind of state changes are called dependent state changes. They
are managed by Halon.</p>
<p>Dependent state changes are calculated without ignoring HOLDs.</p>
<p>HA states dependencies:
- if a node goes from ONLINE to TRANSIENT all processes on the node receive a</p>
<blockquote>
<div><p>HOLD with the node as the owner. The associated 64-bit value is 0, the string
is “inherited”. If the node goes back to ONLINE the hold is removed;</p>
</div></blockquote>
<ul class="simple">
<li><p>the same HOLD logic is applied to a process and every service in this
process;</p></li>
<li><p>if a node has FAILED_FLAG set the FAILED_FLAG is set for all processes on the
node;</p></li>
<li><p>the same applies for a process with FAILED_FLAG set and all services in the
process;</p></li>
<li><p>if a drive goes to TRANSIENT or FAILED state a HOLD is put on all storage
devices that are using this drive. The HOLD value is 0, the string is
“dependent”. If the drive goes back to ONLINE the HOLD is removed;</p></li>
<li><p>the same logic applies to a controller and the controller’s node.</p></li>
</ul>
</section>
<section id="ha-state-epoch">
<span id="entity-ha-state-epoch"></span><h3>ha.state.epoch<a class="headerlink" href="#ha-state-epoch" title="Permalink to this headline">¶</a></h3>
<p>Each HA state change has an epoch associated with the change. The epoch is a
64-bit number.
TODO explain better.</p>
<p>HA epoch properties:
- If a state change to state_0 for an object with fid_0 happened in epoch_0,</p>
<blockquote>
<div><p>and then after some time a state change to state_1 happened with an object
with fid_1 in epoch_1, then epoch_0 &lt; epoch_1;</p>
</div></blockquote>
<ul class="simple">
<li><p>dependent state changes (directly or indirectly) can have the same epoch.</p></li>
</ul>
<p>Use of epoch:
- epoch is defined for a configuration, not for a single object;
- “Mero process uses HA epoch epoch_0” means the processe’s latest received HA</p>
<blockquote>
<div><p>state change from Halon has HA epoch epoch_0;</p>
</div></blockquote>
<ul class="simple">
<li><p>Mero RPC [<a class="reference internal" href="#component-mero-rpc">mero.rpc</a>] sends processes HA epoch in each rpc item and on the
receiving end the epoch is compared (somehow) to the receiving processes HA
epoch. Then RPC layer decides if it can process the rpc item.</p></li>
</ul>
</section>
<section id="ha-state-broadcast">
<span id="entity-ha-state-broadcast"></span><h3>ha.state.broadcast<a class="headerlink" href="#ha-state-broadcast" title="Permalink to this headline">¶</a></h3>
<p>Halon decides when HA state of an object changes. On each such change Halon
broadcasts object fid and the new HA state to each Mero process. A set of HA
state changes can be broadcasted as a single broadcast message.</p>
<p>Properties:
- all Mero processes receive exactly the same HA state broadcast messages;
- if a Mero process receives broadcast messages A, then B, then C, then each</p>
<blockquote>
<div><p>Mero process receives them in the the following order: A, then B, then C,
i.e. each process receives broadcast messages from Halon in exactly the same
order.</p>
</div></blockquote>
<p>The broadcast consists of:
- a set of (object fid, new object HA state) pairs;
- HA epoch.</p>
<p>All state changes for a single epoch are broadcasted in a single broadcast
message, i.e. 2 different broadcast messages must have 2 different HA epochs.
If a broadcast message with epoch_0 arrives before a broadcast message with
epoch_1, then epoch_0 &lt; epoch_1.</p>
</section>
<section id="ha-conf">
<span id="entity-ha-conf"></span><h3>ha.conf<a class="headerlink" href="#ha-conf" title="Permalink to this headline">¶</a></h3>
<p>Mero configuration for the HA purposes is defined as a subset of RG available
to Mero as a set of conf objects.</p>
</section>
<section id="conf-object-categories">
<span id="entity-conf-object-categories"></span><h3>conf.object.categories<a class="headerlink" href="#conf-object-categories" title="Permalink to this headline">¶</a></h3>
<p>List of conf object categories:
- software: node, process, service, sdev;
- hardware: site, rack, enclosure, controller, drive;
- pools/profiles: profile, pool, pver, obj-v.</p>
</section>
<section id="ha-hold-handler">
<span id="entity-ha-hold-handler"></span><h3>ha.hold.handler<a class="headerlink" href="#ha-hold-handler" title="Permalink to this headline">¶</a></h3>
<p>HOLD handler is a set of methods and HOLD-based conditions.</p>
<p>Each conf object has a set of HOLD handlers. The HOLD handlers can be added
when the object is created and during the lifetime of the object. All HOLD
handlers are removed just before the object is destroyed and they can be
removed when the object is alive.</p>
<p>HOLD handler basic methods:
- add() is called when the HOLD handler is added to the conf object;
- del() is called when the HOLD handler is removed from the conf object.</p>
<p>Each condition has 2 HOLD handlers associated with it: one is called when the
condition changes state from False to True, another one is called when the
condition changes state from True to False.</p>
<p>HOLD handler methods signature:
- in: RG, conf object fid, last RC migration epoch;
- out: messages to send, RG diff, HOLD diff, HOLD handlers diff.</p>
</section>
<section id="ha-hold-handler-queue">
<span id="entity-ha-hold-handler-queue"></span><h3>ha.hold.handler.queue<a class="headerlink" href="#ha-hold-handler-queue" title="Permalink to this headline">¶</a></h3>
<p>HA handler queue is a queue of HOLD handler methods.</p>
<p>Each conf object has a HOLD handler FIFO queue.</p>
<p>How the queue is managed:
- when an object is created it has initial list of HOLD handlers. For each HOLD</p>
<blockquote>
<div><p>handler add() method is added to the queue;</p>
</div></blockquote>
<ul class="simple">
<li><p>when a new HOLD handler is added add() method is added to the queue;</p></li>
<li><p>when it’s decided that a conf object is going to be removed del() method for
each HOLD handler is added to the queue in the reverse (relatively to the
add() method) order;</p></li>
<li><p>when a HOLD handler is removed from the object del() method for the HOLD
handler is added to the queue;</p></li>
<li><p>when a HOLD is added or removed from a conf object each condition for each
HOLD handler is evaluated before and after the HOLD. If the condition changes
state the corresponding method is added to the queue;</p></li>
<li><p>after an add() or del() for a HOLD handler method is added to the queue the
queue is scanned for the pairs of add() and del() methods for the same HOLD
handler. If such pairs are foind both methods from the pair are removed from
the queue;</p></li>
<li><p>after a condition change method is added the queue is scanned to find pairs
of condition change handlers for the same HOLD method. All methods from all
such pairs are removed from the queue;</p></li>
</ul>
<p>Options:
- option 1:</p>
<blockquote>
<div><ul class="simple">
<li><p>all methods from the queue are executed asynchronously, one by one. When
the method finishes execution it’s removed from the queue;</p></li>
</ul>
</div></blockquote>
<ul>
<li><p>option 2:
- all methods from the queue are executed one by one. Each execution leads</p>
<blockquote>
<div><p>either to “method went to sleep” case or “method is done”. If a method goes
to sleep it’s going to be executed next time it an be (tricky thing: how to
determine this?). If the “method is done” it’s removed from the queue.</p>
</div></blockquote>
</li>
</ul>
</section>
<section id="conf-object-persistence">
<span id="entity-conf-object-persistence"></span><h3>conf.object.persistence<a class="headerlink" href="#conf-object-persistence" title="Permalink to this headline">¶</a></h3>
<p>Each conf object has at least the following in a persistent storage (RG):
- fid;
- FAILED_FLAG;
- list of HOLDs;
- list of HOLD handlers;
- HOLD handler queue.</p>
</section>
<section id="ha-hold-example">
<span id="entity-ha-hold-example"></span><h3>ha.hold.example<a class="headerlink" href="#ha-hold-example" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p>general
- default-shutdown-hold</p>
<blockquote>
<div><ul class="simple">
<li><p>add()
- copy “shutdown” hold from parent
- remove default-shutdown-hold</p></li>
</ul>
</div></blockquote>
</li>
<li><p>node(server)
- default-shutdown-hold
- mero-kernel-config
- mero-kernel-start</p></li>
<li><p>process(m0d)
- default-shutdown-hold
- m0d-config
- m0d-start
- m0d-mkfs</p></li>
<li><p>service(m0d)
- default-shutdown-hold
- service-mkfs
- service-start</p></li>
<li><p>sdev
- default-shutdown-hold
- sdev-mkfs
- sdev-start</p></li>
</ul>
<p>Node addition
- node-add node(server)</p>
<blockquote>
<div><ul class="simple">
<li><p>default-shutdown-hold.add()</p></li>
<li><p>mero-kernel-start.add()
- put “mero-kernel-is-not-running” hold</p></li>
</ul>
</div></blockquote>
<ul>
<li><p>process-add process(m0d)
- default-shutdown-hold.add()
- m0d-start.add()</p>
<blockquote>
<div><ul class="simple">
<li><p>put “m0d-is-not-running” hold</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>m0d-mkfs.add()
- put “mkfs” hold</p></li>
</ul>
</li>
<li><p>service-add service(m0d)
- default-shutdown-hold.add()
- service-mkfs.add()</p>
<blockquote>
<div><ul class="simple">
<li><p>put “mkfs” hold</p></li>
</ul>
</div></blockquote>
</li>
<li><p>sdev-add sdev
- default-shutdown-hold.add()
- sdev-mkfs.add()</p>
<blockquote>
<div><ul class="simple">
<li><p>put “mkfs” hold</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>Node first start
- node “-shutdown”</p>
<blockquote>
<div><ul class="simple">
<li><p>mero-kernel-config “-shutdown”
- make /etc/sysconfig/mero-kernel with all the configuration
- remove mero-kernel-config</p></li>
<li><p>mero-kernel-start “-shutdown”
- systemctl start mero-kernel
- remove “mero-kernel-is-not-running” hold
- remove “shutdown” from all the processes on the node</p></li>
</ul>
</div></blockquote>
<ul>
<li><p>process “-shutdown”
- m0d-config “-shutdown”</p>
<blockquote>
<div><ul class="simple">
<li><p>put /etc/sysconfig/m0d-FID</p></li>
<li><p>remove m0d-config</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>m0d-start “-shutdown”
- systemctl start <a class="reference external" href="mailto:m0d&#37;&#52;&#48;FID">m0d<span>&#64;</span>FID</a>
- remove “m0d-is-not-running” hold
- remove “shutdown” from all the services in the process</p></li>
<li><p>m0d-mkfs “-shutdown” “+mkfs”
- send message: m0d-run-mkfs
- wait for the reply
- remove “mkfs” hold
- remove m0d-mkfs</p></li>
</ul>
</li>
<li><p>service “-shutdown”
- service-mkfs “-shutdown” “+mkfs”</p>
<blockquote>
<div><ul class="simple">
<li><p>send message: service-run-mkfs</p></li>
<li><p>wait for the reply</p></li>
<li><p>remove “mkfs” hold</p></li>
<li><p>remove service-mkfs</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>service-start “-shutdown”
- send message: m0d-service-start
- wait for the reply
- remove “shutdown” holds from all sdevs in the service</p></li>
</ul>
</li>
<li><p>sdev “-shutdown”
- sdev-mkfs “-shutdown” “+mkfs”</p>
<blockquote>
<div><ul class="simple">
<li><p>send message: sdev-run-mkfs</p></li>
<li><p>wait for the reply</p></li>
<li><p>remove “mkfs” hold</p></li>
<li><p>remove sdev-mkfs</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>sdev-start “-shutdown”
- send message: sdev-start
- wait for the reply</p></li>
</ul>
</li>
</ul>
<p>Node subsequent start
- node “-shutdown”</p>
<blockquote>
<div><ul class="simple">
<li><p>mero-kernel-start “-shutdown”</p></li>
</ul>
</div></blockquote>
<ul class="simple">
<li><p>process “-shutdown”
- m0d-start “-shutdown”</p></li>
<li><p>service “-shutdown”
- service-start “-shutdown”</p></li>
<li><p>sdev “-shutdown”
- sdev-start “-shutdown”</p></li>
</ul>
</section>
<section id="ha-draft">
<span id="entity-ha-draft"></span><h3>ha.draft<a class="headerlink" href="#ha-draft" title="Permalink to this headline">¶</a></h3>
<p>HILL - top level, nowhere to go from here
H - hold
B - branch
W - wait
A - action
S - HA state change</p>
<p>controller</p>
<p>A: check if powered off, turn off if not
B: OK: nop</p>
<blockquote>
<div><p>FAILED: nop</p>
</div></blockquote>
<p>W: wait for the node to go to H: power off
A: put H: power off on the node
HILL
A: remove H: power off from the node
S: transient -&gt; online
B: OK: reset failure count</p>
<blockquote>
<div><dl class="simple">
<dt>FAIL: inc failure count</dt><dd><p>if == 3: put H: failed
else: v, +H-H restart</p>
</dd>
</dl>
</div></blockquote>
<p>W: power on timeout
A: check if powered on, turn on if not
H: restart
H: shutdown
H: power off
H: failed
.: add</p>
<p>node</p>
<p>S: online-&gt;transient
B: OK: nop</p>
<blockquote>
<div><p>FAILED: +H-H restart(controller)</p>
</div></blockquote>
<p>W: wait for all processes to stop
B: OK: nop</p>
<blockquote>
<div><p>FAILED: +H-H restart(controller)</p>
</div></blockquote>
<p>W: wait till it’s stopped
A: stop halond
B: OK: nop</p>
<blockquote>
<div><p>FAILED: +H-H restart(controller)</p>
</div></blockquote>
<p>W: wait till it’s stopped
A: stop mero-kernel
A: put H: power off on all node processes
HILL
A: remove H: power off from the all node processes
B: OK: nop</p>
<blockquote>
<div><p>FAIL: v, +H-H restart(controller)</p>
</div></blockquote>
<p>A: start mero-kernel
A: put /etc/sysconfig/mero-kernel</p>
<blockquote>
<div><p>remove this A on success</p>
</div></blockquote>
<dl class="simple">
<dt>B: OK: nop</dt><dd><p>FAIL: v, +H-H restart(controller)</p>
</dd>
</dl>
<p>W: wait for halond to connect to the cluster
A: start halond
S: transient -&gt; online
A: run halon-cleanup</p>
<blockquote>
<div><p>remove this A on success</p>
</div></blockquote>
<dl class="simple">
<dt>B: OK: nop</dt><dd><p>FAIL: v, +H-H restart(controller)</p>
</dd>
</dl>
<p>W: for system to boot
H: restart
H: shutdown
H: power off
H: failed
.: add</p>
<p>process</p>
<p>S: online-&gt;transient
B: OK: nop</p>
<blockquote>
<div><p>FAIL: SIGKILL it</p>
</div></blockquote>
<p>W: wait for the process to stop
A: send process stop
B: OK: nop</p>
<blockquote>
<div><p>FAIL: nop?</p>
</div></blockquote>
<p>W: wait for all services to stop
A: put H: power off on all process services
HILL
A: remove H: power off from all process services
B: OK: nop</p>
<blockquote>
<div><p>FAIL: v, +H-H restart</p>
</div></blockquote>
<p>W: process start is successful
A: send process start
B: OK: remove previous W and A</p>
<blockquote>
<div><p>FAIL: v, +H-H restart</p>
</div></blockquote>
<p>W: process mkfs is successful
A: send process mkfs
B: OK: nop</p>
<blockquote>
<div><p>FAIL: v, +H-H restart</p>
</div></blockquote>
<p>W: wait for the incoming connection
A: start m0d if not already
A: run <a class="reference external" href="mailto:m0d-cleanup&#37;&#52;&#48;FID">m0d-cleanup<span>&#64;</span>FID</a></p>
<blockquote>
<div><p>remove this A on success</p>
</div></blockquote>
<p>S: transient -&gt; online
H: restart
H: shutdown
H: power off
H: failed
.: add</p>
<p>service</p>
<p>S: online -&gt; transient
B: OK: nop</p>
<blockquote>
<div><p>FAIL: nop?</p>
</div></blockquote>
<p>W: wait for reply
A: send service stop
B: OK: nop</p>
<blockquote>
<div><p>FAIL: nop?</p>
</div></blockquote>
<p>W: wait for sdevs to stop
A: put H: power off on all service sdevs
HILL
A: remove H: power off from the all service sdevs
B: OK: nop</p>
<blockquote>
<div><p>FAIL: v, +H-H restart</p>
</div></blockquote>
<p>W: service start is successful
A: send service start
B: OK: remove previous W and A</p>
<blockquote>
<div><p>FAIL: v, +H-H restart</p>
</div></blockquote>
<p>W: service mkfs is successful
A: send service mkfs
S: transient -&gt; online
H: restart
H: shutdown
H: power off
H: failed
.: add</p>
<p>sdev</p>
<p>S: online -&gt; transient
B: OK: nop</p>
<blockquote>
<div><p>FAIL: nop?</p>
</div></blockquote>
<p>W: wait for reply
A: send sdev stop
HILL
B: OK: nop</p>
<blockquote>
<div><p>FAIL: v, +H-H restart</p>
</div></blockquote>
<p>W: sdev start is successful
A: send sdev start
B: OK: remove previous W and A</p>
<blockquote>
<div><p>FAIL: v, +H-H restart</p>
</div></blockquote>
<p>W: sdev mkfs is successful
A: send sdev mkfs
S: transient -&gt; online
H: restart
H: shutdown
H: power off
H: failed
.: add</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="#">EOS</a></h1>









<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
  <div>
    <h3><a href="#">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">EOS architecture specification</a><ul>
<li><a class="reference internal" href="#overall-system-description">Overall system description</a></li>
<li><a class="reference internal" href="#high-level-decomposition">High level decomposition</a></li>
<li><a class="reference internal" href="#requirements">Requirements</a></li>
<li><a class="reference internal" href="#architectural-diagrams">Architectural diagrams</a><ul>
<li><a class="reference internal" href="#component-and-connector">Component and connector</a></li>
<li><a class="reference internal" href="#use-depends-diagram-software-components">Use-depends diagram (software components)</a></li>
<li><a class="reference internal" href="#data-flow-control-flow">Data flow, control flow</a></li>
<li><a class="reference internal" href="#deployment">Deployment</a></li>
</ul>
</li>
<li><a class="reference internal" href="#components">Components</a><ul>
<li><a class="reference internal" href="#eos">eos</a></li>
<li><a class="reference internal" href="#mero">mero</a></li>
<li><a class="reference internal" href="#component-s3">s3</a></li>
<li><a class="reference internal" href="#component-nfs">nfs</a></li>
<li><a class="reference internal" href="#halon">halon</a></li>
<li><a class="reference internal" href="#provisioner">provisioner</a></li>
<li><a class="reference internal" href="#component-ras">ras</a></li>
<li><a class="reference internal" href="#management-ui">management ui</a></li>
<li><a class="reference internal" href="#os">os</a></li>
<li><a class="reference internal" href="#mero-clovis">mero.clovis</a></li>
<li><a class="reference internal" href="#mero-rpc">mero.rpc</a></li>
<li><a class="reference internal" href="#mero-reqh">mero.reqh</a></li>
<li><a class="reference internal" href="#mero-be">mero.be</a></li>
<li><a class="reference internal" href="#mero-stob">mero.stob</a></li>
<li><a class="reference internal" href="#mero-dtm">mero.dtm</a></li>
<li><a class="reference internal" href="#mero-pdclust">mero.pdclust</a></li>
<li><a class="reference internal" href="#mero-ios">mero.ios</a></li>
<li><a class="reference internal" href="#mero-dix">mero.dix</a></li>
<li><a class="reference internal" href="#mero-cob">mero.cob</a></li>
<li><a class="reference internal" href="#mero-cas">mero.cas</a></li>
<li><a class="reference internal" href="#mero-cm">mero.cm</a></li>
<li><a class="reference internal" href="#mero-conf">mero.conf</a></li>
<li><a class="reference internal" href="#mero-lib">mero.lib</a></li>
<li><a class="reference internal" href="#mero-addb">mero.addb</a></li>
<li><a class="reference internal" href="#mero-fol">mero.fol</a></li>
<li><a class="reference internal" href="#mero-layout">mero.layout</a></li>
<li><a class="reference internal" href="#mero-pool">mero.pool</a></li>
<li><a class="reference internal" href="#mero-spiel">mero.spiel</a></li>
<li><a class="reference internal" href="#mero-balloc">mero.balloc</a></li>
<li><a class="reference internal" href="#mero-fdmi">mero.fdmi</a></li>
<li><a class="reference internal" href="#mero-lf">mero.lf</a></li>
<li><a class="reference internal" href="#mero-fid">mero.fid</a></li>
<li><a class="reference internal" href="#mero-rm">mero.rm</a></li>
<li><a class="reference internal" href="#mero-xcode">mero.xcode</a></li>
<li><a class="reference internal" href="#mero-net">mero.net</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-cases">Use cases</a><ul>
<li><a class="reference internal" href="#product-life-cycle">product.life.cycle</a></li>
<li><a class="reference internal" href="#development-cycle">development.cycle</a></li>
<li><a class="reference internal" href="#deployment-life-cycle">deployment.life.cycle</a></li>
<li><a class="reference internal" href="#durability-bitrot">durability.bitrot</a><ul>
<li><a class="reference internal" href="#bsc-repair">bsc.repair</a></li>
</ul>
</li>
<li><a class="reference internal" href="#durability-misdirected-write">durability.misdirected.write</a></li>
<li><a class="reference internal" href="#metadata-internal-bitrot">metadata-internal.bitrot</a></li>
<li><a class="reference internal" href="#clovis-multi-site-create">clovis.multi-site.create</a></li>
<li><a class="reference internal" href="#clovis-multi-site-write">clovis.multi-site.write</a></li>
<li><a class="reference internal" href="#clovis-multi-site-read">clovis.multi-site.read</a></li>
<li><a class="reference internal" href="#clovis-multi-site-delete">clovis.multi-site.delete</a></li>
<li><a class="reference internal" href="#s3-access-single-regions-multisite-replication">s3.access.single.regions.multisite.replication</a></li>
<li><a class="reference internal" href="#s3-access-single-regions-multisite-erasurecoding">s3.access.single.regions.multisite.erasurecoding</a></li>
<li><a class="reference internal" href="#s3-access-multi-regions-crr-single-site">s3.access.multi.regions.crr.single.site</a></li>
<li><a class="reference internal" href="#s3-access-multi-regions-crr-multisite">s3.access.multi.regions.crr.multisite</a></li>
<li><a class="reference internal" href="#s3-access-regions-mixed-policies">s3.access.regions.mixed.policies</a></li>
<li><a class="reference internal" href="#s3-bucket-put-tagging">s3.bucket.put.tagging</a></li>
<li><a class="reference internal" href="#s3-bucket-get-tagging">s3.bucket.get.tagging</a></li>
<li><a class="reference internal" href="#s3-bucket-delete-tagging">s3.bucket.delete.tagging</a></li>
<li><a class="reference internal" href="#s3-acl">s3.acl</a></li>
<li><a class="reference internal" href="#s3-bucketpolicy">s3.bucketpolicy</a></li>
<li><a class="reference internal" href="#s3-iamuserpolicy">s3.iamuserpolicy</a></li>
<li><a class="reference internal" href="#s3-crr">s3.crr</a></li>
<li><a class="reference internal" href="#s3-crr-put-policies">s3.crr.put.policies</a></li>
<li><a class="reference internal" href="#s3-crr-put-object">s3.crr.put.object</a></li>
<li><a class="reference internal" href="#s3-crr-get-policies">s3.crr.get.policies</a></li>
<li><a class="reference internal" href="#s3-crr-delete-policies">s3.crr.delete.policies</a></li>
<li><a class="reference internal" href="#s3-versioning">s3.versioning</a><ul>
<li><a class="reference internal" href="#s3-bucket-put-versioning">s3.bucket.put.versioning</a></li>
<li><a class="reference internal" href="#s3-bucket-get-versioning">s3.bucket.get.versioning</a></li>
<li><a class="reference internal" href="#s3-object-put-versioning">s3.object.put.versioning</a></li>
<li><a class="reference internal" href="#s3-object-get-versioning">s3.object.get.versioning</a></li>
<li><a class="reference internal" href="#s3-object-delete-versioning">s3.object.delete.versioning</a></li>
</ul>
</li>
<li><a class="reference internal" href="#s3-throttling">s3.throttling</a></li>
<li><a class="reference internal" href="#s3-copy-object">s3.copy.object</a></li>
<li><a class="reference internal" href="#s3-copy-part">s3.copy.part</a></li>
<li><a class="reference internal" href="#s3-hybridcloud-replication">s3.hybridcloud.replication</a></li>
<li><a class="reference internal" href="#s3-hybridcloud-tiering">s3.hybridcloud.tiering</a></li>
<li><a class="reference internal" href="#s3-sse-s3-managedkeys">s3.sse.s3.managedkeys</a></li>
<li><a class="reference internal" href="#s3-sse-user-managedkeys">s3.sse.user.managedkeys</a></li>
<li><a class="reference internal" href="#dix-kv-usage">dix.kv_usage</a></li>
<li><a class="reference internal" href="#dix-delete">dix.delete</a></li>
<li><a class="reference internal" href="#dix-direct-rebalance">dix.direct_rebalance</a></li>
<li><a class="reference internal" href="#dix-mdraid">dix.mdraid</a></li>
<li><a class="reference internal" href="#scaleout-balance-capacity">scaleout.balance.capacity</a></li>
<li><a class="reference internal" href="#scaleout-balcap-read-drive-fail">scaleout.balcap.read.drive.fail</a></li>
<li><a class="reference internal" href="#scaleout-balcap-read-ios-fail">scaleout.balcap.read.ios.fail</a></li>
<li><a class="reference internal" href="#scaleout-balcap-write-drive-fail">scaleout.balcap.write.drive.fail</a></li>
<li><a class="reference internal" href="#scaleout-balcap-write-ios-fail">scaleout.balcap.write.ios.fail</a></li>
<li><a class="reference internal" href="#scaleout-balcap-write-drive-restore">scaleout.balcap.write.drive.restore</a></li>
<li><a class="reference internal" href="#scaleout-balcap-write-ios-restore">scaleout.balcap.write.ios.restore</a></li>
<li><a class="reference internal" href="#scaleout-balance-capacity-coordinator-fail">scaleout.balance.capacity.coordinator.fail</a></li>
<li><a class="reference internal" href="#scaleout-balance-capacity-mdupdate-fail">scaleout.balance.capacity.mdupdate.fail</a></li>
<li><a class="reference internal" href="#scaleout-poolmod">scaleout.poolmod</a></li>
<li><a class="reference internal" href="#scaleout-balance-io">scaleout.balance.io</a></li>
<li><a class="reference internal" href="#be-paged-read">be.paged.read</a></li>
<li><a class="reference internal" href="#be-paged-write">be.paged.write</a></li>
<li><a class="reference internal" href="#ras-fault-handle-pods-vdisk">ras.fault.handle.pods.vdisk</a></li>
<li><a class="reference internal" href="#ras-fault-handle-pods-fru">ras.fault.handle.pods.fru</a></li>
<li><a class="reference internal" href="#ras-fault-handle-pods-raid">ras.fault.handle.pods.raid</a></li>
<li><a class="reference internal" href="#ras-fault-handle-os-service">ras.fault.handle.os.service</a></li>
<li><a class="reference internal" href="#ras-fault-handle-os-mdraid">ras.fault.handle.os.mdraid</a></li>
<li><a class="reference internal" href="#ras-fault-handle-nw-switch">ras.fault.handle.nw.switch</a></li>
<li><a class="reference internal" href="#ras-fault-handle-pdu-voltage">ras.fault.handle.pdu.voltage</a></li>
<li><a class="reference internal" href="#ras-fault-handle-os-space">ras.fault.handle.os.space</a></li>
<li><a class="reference internal" href="#ras-fault-alert-email">ras.fault.alert.email</a></li>
<li><a class="reference internal" href="#ras-fault-alert-dashboard">ras.fault.alert.dashboard</a></li>
<li><a class="reference internal" href="#ras-stats-os-cpu">ras.stats.os.cpu</a></li>
<li><a class="reference internal" href="#ras-stats-os-memory">ras.stats.os.memory</a></li>
<li><a class="reference internal" href="#ras-support-bundle">ras.support.bundle</a></li>
<li><a class="reference internal" href="#ras-support-callhome">ras.support.callhome</a></li>
<li><a class="reference internal" href="#ras-fault-simulate-pods-expander-reset">ras.fault.simulate.pods.expander.reset</a></li>
<li><a class="reference internal" href="#ras-fault-simulate-nw-interface">ras.fault.simulate.nw.interface</a></li>
<li><a class="reference internal" href="#ras-fault-simulate-pods-raid">ras.fault.simulate.pods.raid</a></li>
<li><a class="reference internal" href="#ras-fault-simulate-os-mdraid">ras.fault.simulate.os.mdraid</a></li>
<li><a class="reference internal" href="#ras-fault-predict-pods-vdisk">ras.fault.predict.pods.vdisk</a></li>
<li><a class="reference internal" href="#ras-security-user">ras.security.user</a></li>
<li><a class="reference internal" href="#ras-security-encryption">ras.security.encryption</a></li>
<li><a class="reference internal" href="#ras-iem-log">ras.iem.log</a></li>
<li><a class="reference internal" href="#ras-iem-email">ras.iem.email</a></li>
<li><a class="reference internal" href="#nfs-mount">nfs.mount</a></li>
<li><a class="reference internal" href="#nfs-unmount">nfs.unmount</a></li>
<li><a class="reference internal" href="#nfs-export-create">nfs.export.create</a></li>
<li><a class="reference internal" href="#nfs-export-delete">nfs.export.delete</a></li>
<li><a class="reference internal" href="#nfs-export-list">nfs.export.list</a></li>
<li><a class="reference internal" href="#nfs-data-read">nfs.data.read</a></li>
<li><a class="reference internal" href="#nfs-data-write">nfs.data.write</a></li>
<li><a class="reference internal" href="#nfs-file-create">nfs.file.create</a></li>
<li><a class="reference internal" href="#nfs-file-rename">nfs.file.rename</a></li>
<li><a class="reference internal" href="#nfs-file-open">nfs.file.open</a></li>
<li><a class="reference internal" href="#nfs-file-close">nfs.file.close</a></li>
<li><a class="reference internal" href="#nfs-setattr">nfs.setattr</a></li>
<li><a class="reference internal" href="#nfs-getattr">nfs.getattr</a></li>
<li><a class="reference internal" href="#nfs-setxattr">nfs.setxattr</a></li>
<li><a class="reference internal" href="#nfs-getxattr">nfs.getxattr</a></li>
<li><a class="reference internal" href="#nfs-dir-lookup">nfs.dir.lookup</a></li>
<li><a class="reference internal" href="#nfs-dir-mkdir">nfs.dir.mkdir</a></li>
<li><a class="reference internal" href="#nfs-dir-rmdir">nfs.dir.rmdir</a></li>
<li><a class="reference internal" href="#nfs-dir-readdir">nfs.dir.readdir</a></li>
<li><a class="reference internal" href="#sns-repreb">sns.repreb</a></li>
</ul>
</li>
<li><a class="reference internal" href="#encyclopaedia">Encyclopædia</a><ul>
<li><a class="reference internal" href="#entity-nfs">nfs</a></li>
<li><a class="reference internal" href="#fdmi">fdmi</a><ul>
<li><a class="reference internal" href="#fdmi-vs-posix">fdmi vs. POSIX</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fdmi-source">fdmi.source</a></li>
<li><a class="reference internal" href="#fdmi-record">fdmi.record</a></li>
<li><a class="reference internal" href="#fdmi-service">fdmi.service</a></li>
<li><a class="reference internal" href="#fdmi-filter">fdmi.filter</a></li>
<li><a class="reference internal" href="#fdmi-plugin">fdmi.plugin</a></li>
<li><a class="reference internal" href="#fdmi-reply">fdmi.reply</a></li>
<li><a class="reference internal" href="#fdmi-done">fdmi.done</a></li>
<li><a class="reference internal" href="#fdmi-app">fdmi.app</a></li>
<li><a class="reference internal" href="#fdmi-batch">fdmi.batch</a></li>
<li><a class="reference internal" href="#conf-schema">conf.schema</a></li>
<li><a class="reference internal" href="#dix-client">dix.client</a></li>
<li><a class="reference internal" href="#dix-cm">dix.cm</a></li>
<li><a class="reference internal" href="#dix-cm-cp">dix.cm.cp</a></li>
<li><a class="reference internal" href="#dix-cm-iter">dix.cm.iter</a></li>
<li><a class="reference internal" href="#dix-cm-repair">dix.cm.repair</a></li>
<li><a class="reference internal" href="#dix-cm-rebalance">dix.cm.rebalance</a></li>
<li><a class="reference internal" href="#dix-cm-direct-rebalance">dix.cm.direct_rebalance</a></li>
<li><a class="reference internal" href="#dix-cm-trigger">dix.cm.trigger</a></li>
<li><a class="reference internal" href="#dix-layout">dix.layout</a></li>
<li><a class="reference internal" href="#dix-cas">dix.cas</a></li>
<li><a class="reference internal" href="#dix-cas-request">dix.cas.request</a></li>
<li><a class="reference internal" href="#dix-cas-rop">dix.cas.rop</a></li>
<li><a class="reference internal" href="#dix-n">dix.N</a></li>
<li><a class="reference internal" href="#dix-p">dix.P</a></li>
<li><a class="reference internal" href="#dix-k">dix.K</a></li>
<li><a class="reference internal" href="#dix-meta">dix.meta</a></li>
<li><a class="reference internal" href="#dix-req">dix.req</a></li>
<li><a class="reference internal" href="#dix-key">dix.key</a></li>
<li><a class="reference internal" href="#dix-val">dix.val</a></li>
<li><a class="reference internal" href="#dix-index">dix.index</a></li>
<li><a class="reference internal" href="#dix-root">dix.root</a></li>
<li><a class="reference internal" href="#dix-imask">dix.imask</a></li>
<li><a class="reference internal" href="#dix-item">dix.item</a></li>
<li><a class="reference internal" href="#dix-pver">dix.pver</a></li>
<li><a class="reference internal" href="#dix-cas-fop">dix.cas.fop</a></li>
<li><a class="reference internal" href="#dix-di">dix.di</a></li>
<li><a class="reference internal" href="#cas">cas</a></li>
<li><a class="reference internal" href="#unit">unit</a></li>
<li><a class="reference internal" href="#checksum">checksum</a></li>
<li><a class="reference internal" href="#parity-group">parity.group</a></li>
<li><a class="reference internal" href="#mero-client">mero.client</a></li>
<li><a class="reference internal" href="#entity-halon">halon</a></li>
<li><a class="reference internal" href="#interface-export">interface.export</a></li>
<li><a class="reference internal" href="#adapt-md">adapt.md</a></li>
<li><a class="reference internal" href="#adapt-drivesets">adapt.drivesets</a></li>
<li><a class="reference internal" href="#io-checksum">io.checksum</a></li>
<li><a class="reference internal" href="#misdirectedwrite-md">misdirectedwrite.md</a></li>
<li><a class="reference internal" href="#ios">ios</a></li>
<li><a class="reference internal" href="#ios-bufferpool">ios.bufferpool</a></li>
<li><a class="reference internal" href="#ios-rdma">ios.rdma</a></li>
<li><a class="reference internal" href="#ios-stobio">ios.stobio</a></li>
<li><a class="reference internal" href="#ios-cobdomain">ios.cobdomain</a></li>
<li><a class="reference internal" href="#ios-cobdomain-cob">ios.cobdomain.cob</a></li>
<li><a class="reference internal" href="#ios-cobdomain-crow">ios.cobdomain.crow</a></li>
<li><a class="reference internal" href="#ios-locality">ios.locality</a></li>
<li><a class="reference internal" href="#entity-provisioner">provisioner</a></li>
<li><a class="reference internal" href="#provisioner-node">provisioner.node</a></li>
<li><a class="reference internal" href="#provisioner-node-role">provisioner.node.role</a></li>
<li><a class="reference internal" href="#provisioner-re-image">provisioner.re.image</a></li>
<li><a class="reference internal" href="#provisioner-node-network">provisioner.node.network</a></li>
<li><a class="reference internal" href="#provisioner-node-service">provisioner.node.service</a></li>
<li><a class="reference internal" href="#provisioner-package">provisioner.package</a></li>
<li><a class="reference internal" href="#sale">sale</a></li>
<li><a class="reference internal" href="#manufacturing">manufacturing</a></li>
<li><a class="reference internal" href="#shipment">shipment</a></li>
<li><a class="reference internal" href="#assembly">assembly</a></li>
<li><a class="reference internal" href="#operation">operation</a></li>
<li><a class="reference internal" href="#eol">eol</a></li>
<li><a class="reference internal" href="#eol-secure-delete">eol.secure.delete</a></li>
<li><a class="reference internal" href="#be">be</a></li>
<li><a class="reference internal" href="#be-tx">be.tx</a></li>
<li><a class="reference internal" href="#be-tx-payload">be.tx.payload</a></li>
<li><a class="reference internal" href="#be-credit">be.credit</a></li>
<li><a class="reference internal" href="#be-seg">be.seg</a></li>
<li><a class="reference internal" href="#be-reg">be.reg</a></li>
<li><a class="reference internal" href="#be-domain">be.domain</a></li>
<li><a class="reference internal" href="#be-engine">be.engine</a></li>
<li><a class="reference internal" href="#be-group">be.group</a></li>
<li><a class="reference internal" href="#be-list">be.list</a></li>
<li><a class="reference internal" href="#be-allocator">be.allocator</a></li>
<li><a class="reference internal" href="#be-alloc-oom">be.alloc.oom</a></li>
<li><a class="reference internal" href="#be-btree">be.btree</a></li>
<li><a class="reference internal" href="#be-extmap">be.extmap</a></li>
<li><a class="reference internal" href="#be-paged">be.paged</a></li>
<li><a class="reference internal" href="#be-paged-page">be.paged.page</a></li>
<li><a class="reference internal" href="#be-paged-cellar">be.paged.cellar</a></li>
<li><a class="reference internal" href="#be-paged-request">be.paged.request</a></li>
<li><a class="reference internal" href="#be-paged-fom">be.paged.fom</a></li>
<li><a class="reference internal" href="#be-io">be.io</a></li>
<li><a class="reference internal" href="#be-log">be.log</a></li>
<li><a class="reference internal" href="#be-recovery">be.recovery</a></li>
<li><a class="reference internal" href="#stob">stob</a></li>
<li><a class="reference internal" href="#stob-ad">stob.ad</a></li>
<li><a class="reference internal" href="#stob-linux">stob.linux</a></li>
<li><a class="reference internal" href="#stob-io">stob.io</a></li>
<li><a class="reference internal" href="#stob-domain">stob.domain</a></li>
<li><a class="reference internal" href="#stob-type">stob.type</a></li>
<li><a class="reference internal" href="#stob-ioq">stob.ioq</a></li>
<li><a class="reference internal" href="#balloc">balloc</a></li>
<li><a class="reference internal" href="#net">net</a></li>
<li><a class="reference internal" href="#net-rdma">net.rdma</a></li>
<li><a class="reference internal" href="#net-lnet">net.lnet</a></li>
<li><a class="reference internal" href="#net-devm0lnet">net.devm0lnet</a></li>
<li><a class="reference internal" href="#net-tm">net.tm</a></li>
<li><a class="reference internal" href="#net-buf">net.buf</a></li>
<li><a class="reference internal" href="#net-ep">net.ep</a></li>
<li><a class="reference internal" href="#net-domain">net.domain</a></li>
<li><a class="reference internal" href="#net-buffer-pool">net.buffer_pool</a></li>
<li><a class="reference internal" href="#system-upgrade">system.upgrade</a></li>
<li><a class="reference internal" href="#system-downgrade">system.downgrade</a></li>
<li><a class="reference internal" href="#fs-readonly">fs.readonly</a></li>
<li><a class="reference internal" href="#s3-region">s3.region</a></li>
<li><a class="reference internal" href="#s3-bucket">s3.bucket</a></li>
<li><a class="reference internal" href="#s3-bucket-name">s3.bucket.name</a></li>
<li><a class="reference internal" href="#s3-object">s3.object</a></li>
<li><a class="reference internal" href="#s3-object-name">s3.object.name</a></li>
<li><a class="reference internal" href="#s3-bucket-operation">s3.bucket.operation</a></li>
<li><a class="reference internal" href="#s3-object-operation">s3.object.operation</a></li>
<li><a class="reference internal" href="#s3-endpoint">s3.endpoint</a></li>
<li><a class="reference internal" href="#s3-bucket-tagging">s3.bucket.tagging</a></li>
<li><a class="reference internal" href="#s3-user">s3.user</a></li>
<li><a class="reference internal" href="#s3-account">s3.account</a></li>
<li><a class="reference internal" href="#s3-subaccount">s3.subaccount</a></li>
<li><a class="reference internal" href="#s3-statistics">s3.statistics</a></li>
<li><a class="reference internal" href="#s3-availability-zones">s3.availability.zones</a></li>
<li><a class="reference internal" href="#s3-service">s3.service</a></li>
<li><a class="reference internal" href="#s3-api">s3.api</a></li>
<li><a class="reference internal" href="#s3-client">s3.client</a></li>
<li><a class="reference internal" href="#s3-dns">s3.dns</a></li>
<li><a class="reference internal" href="#s3-loadbalancer-haproxy">s3.loadbalancer (haproxy)</a></li>
<li><a class="reference internal" href="#s3-put">s3.PUT</a></li>
<li><a class="reference internal" href="#s3-policies">s3.policies</a></li>
<li><a class="reference internal" href="#s3-server">s3.server</a></li>
<li><a class="reference internal" href="#s3-auth-server">s3.auth.server</a></li>
<li><a class="reference internal" href="#s3-failover">s3.failover</a></li>
<li><a class="reference internal" href="#s3-sse">s3.sse</a></li>
<li><a class="reference internal" href="#rpc">rpc</a></li>
<li><a class="reference internal" href="#rpc-item">rpc.item</a></li>
<li><a class="reference internal" href="#rpc-connection">rpc.connection</a></li>
<li><a class="reference internal" href="#rpc-session">rpc.session</a></li>
<li><a class="reference internal" href="#rpc-formation">rpc.formation</a></li>
<li><a class="reference internal" href="#rpc-timeout">rpc.timeout</a></li>
<li><a class="reference internal" href="#rpc-resend">rpc.resend</a></li>
<li><a class="reference internal" href="#rpc-reply">rpc.reply</a></li>
<li><a class="reference internal" href="#sns-parity-math">sns.parity_math</a></li>
<li><a class="reference internal" href="#rconfc">rconfc</a></li>
<li><a class="reference internal" href="#fop">fop</a></li>
<li><a class="reference internal" href="#fop-entrypoint">fop.entrypoint</a></li>
<li><a class="reference internal" href="#confd-quorum">confd.quorum</a></li>
<li><a class="reference internal" href="#throughput">throughput</a></li>
<li><a class="reference internal" href="#queue-depth">queue.depth</a></li>
<li><a class="reference internal" href="#rdma">rdma</a></li>
<li><a class="reference internal" href="#bitrot">bitrot</a></li>
<li><a class="reference internal" href="#bitrot-md">bitrot.md</a></li>
<li><a class="reference internal" href="#fop-cob-check">fop.cob.check</a></li>
<li><a class="reference internal" href="#bsc">bsc</a></li>
<li><a class="reference internal" href="#bsc-scanner">bsc.scanner</a></li>
<li><a class="reference internal" href="#bsc-repair-request">bsc.repair.request</a></li>
<li><a class="reference internal" href="#bsc-bad-list">bsc.bad.list</a></li>
<li><a class="reference internal" href="#bsc-request-list">bsc.request.list</a></li>
<li><a class="reference internal" href="#bsc-scrubber">bsc.scrubber</a></li>
<li><a class="reference internal" href="#balance-capacity">balance.capacity</a></li>
<li><a class="reference internal" href="#balance-capacity-pool">balance.capacity.pool</a></li>
<li><a class="reference internal" href="#balance-capacity-policy">balance.capacity.policy</a></li>
<li><a class="reference internal" href="#balance-capacity-index">balance.capacity.index</a></li>
<li><a class="reference internal" href="#balance-capacity-restripe">balance.capacity.restripe</a></li>
<li><a class="reference internal" href="#balance-capacity-coordinator">balance.capacity.coordinator</a></li>
<li><a class="reference internal" href="#balance-capacity-layout-set">balance.capacity.layout.set</a></li>
<li><a class="reference internal" href="#balance-capacity-bsc-request">balance.capacity.bsc.request</a></li>
<li><a class="reference internal" href="#balance-capacity-rm">balance.capacity.rm</a></li>
<li><a class="reference internal" href="#balance-capacity-bufferpool">balance.capacity.bufferpool</a></li>
<li><a class="reference internal" href="#balance-capacity-dtm0">balance.capacity.dtm0</a></li>
<li><a class="reference internal" href="#balance-capacity-cob-versioning">balance.capacity.cob.versioning</a></li>
<li><a class="reference internal" href="#balance-capacity-flowcontrol">balance.capacity.flowcontrol</a></li>
<li><a class="reference internal" href="#balance-capacity-evacuate">balance.capacity.evacuate</a></li>
<li><a class="reference internal" href="#pdclust">pdclust</a></li>
<li><a class="reference internal" href="#pdclust-unit">pdclust.unit</a></li>
<li><a class="reference internal" href="#pdclust-paritygroup">pdclust.paritygroup</a></li>
<li><a class="reference internal" href="#pdclust-target">pdclust.target</a></li>
<li><a class="reference internal" href="#pdclust-targetframe">pdclust.targetframe</a></li>
<li><a class="reference internal" href="#failuredomain">failuredomain</a></li>
<li><a class="reference internal" href="#failuredomain-tree">failuredomain.tree</a></li>
<li><a class="reference internal" href="#pool">pool</a></li>
<li><a class="reference internal" href="#pool-pver">pool.pver</a></li>
<li><a class="reference internal" href="#pool-pver-actual">pool.pver.actual</a></li>
<li><a class="reference internal" href="#pool-pver-formulaic">pool.pver.formulaic</a></li>
<li><a class="reference internal" href="#pool-pver-virtual">pool.pver.virtual</a></li>
<li><a class="reference internal" href="#pool-pver-allowancevector">pool.pver.allowancevector</a></li>
<li><a class="reference internal" href="#pool-pver-tolerancevector">pool.pver.tolerancevector</a></li>
<li><a class="reference internal" href="#pool-pver-pooldev">pool.pver.pooldev</a></li>
<li><a class="reference internal" href="#pool-pver-poolmachine">pool.pver.poolmachine</a></li>
<li><a class="reference internal" href="#pool-pver-selectionpolicy">pool.pver.selectionpolicy</a></li>
<li><a class="reference internal" href="#pool-pver-poolmachine-poolmachinestate">pool.pver.poolmachine.poolmachinestate</a></li>
<li><a class="reference internal" href="#entity-hld">hld</a></li>
<li><a class="reference internal" href="#dld">dld</a></li>
<li><a class="reference internal" href="#dldinsp">dldinsp</a></li>
<li><a class="reference internal" href="#codeinsp">codeinsp</a></li>
<li><a class="reference internal" href="#rack">rack</a></li>
<li><a class="reference internal" href="#clovis">clovis</a></li>
<li><a class="reference internal" href="#clovis-entity">clovis.entity</a></li>
<li><a class="reference internal" href="#clovis-object">clovis.object</a></li>
<li><a class="reference internal" href="#clovis-index">clovis.index</a></li>
<li><a class="reference internal" href="#clovis-container">clovis.container</a></li>
<li><a class="reference internal" href="#clovis-operation">clovis.operation</a></li>
<li><a class="reference internal" href="#copymachine">copymachine</a></li>
<li><a class="reference internal" href="#copymachine-pump">copymachine.pump</a></li>
<li><a class="reference internal" href="#copymachine-aggregation-group">copymachine.aggregation.group</a></li>
<li><a class="reference internal" href="#copymachine-copypacket">copymachine.copypacket</a></li>
<li><a class="reference internal" href="#copymachine-proxy">copymachine.proxy</a></li>
<li><a class="reference internal" href="#copymachine-proxy-update">copymachine.proxy.update</a></li>
<li><a class="reference internal" href="#copymachine-sliding-window">copymachine.sliding.window</a></li>
<li><a class="reference internal" href="#copymachine-status">copymachine.status</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb">copymachine.sns.repreb</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-trigger">copymachine.sns.repreb.trigger</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-copypacket">copymachine.sns.repreb.copypacket</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-aggregation-group">copymachine.sns.repreb.aggregation.group</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-agiter">copymachine.sns.repreb.agiter</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-iter">copymachine.sns.repreb.iter</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-storage">copymachine.sns.repreb.storage</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-xform">copymachine.sns.repreb.xform</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-net">copymachine.sns.repreb.net</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-halon">copymachine.sns.repreb.halon</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-layout">copymachine.sns.repreb.layout</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-paritymath">copymachine.sns.repreb.paritymath</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-bufferpool">copymachine.sns.repreb.bufferpool</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-be">copymachine.sns.repreb.be</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-di">copymachine.sns.repreb.di</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-bsc">copymachine.sns.repreb.bsc</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-ccio">copymachine.sns.repreb.ccio</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-rm">copymachine.sns.repreb.rm</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-pause-resume">copymachine.sns.repreb.pause.resume</a></li>
<li><a class="reference internal" href="#copymachine-sns-repreb-abort">copymachine.sns.repreb.abort</a></li>
<li><a class="reference internal" href="#metadata-internal-cob">metadata.internal.cob:</a></li>
<li><a class="reference internal" href="#metadata-internal-cob-attr">metadata.internal.cob.attr</a></li>
<li><a class="reference internal" href="#metadata-internal-balloc">metadata.internal.balloc</a></li>
<li><a class="reference internal" href="#metadata-internal-sns">metadata.internal.sns</a></li>
<li><a class="reference internal" href="#metadata-internal-be-checksum">metadata.internal.be.checksum</a></li>
<li><a class="reference internal" href="#metadata-external-s3">metadata.external.s3</a></li>
<li><a class="reference internal" href="#metadata-external-clovis">metadata.external.clovis</a></li>
<li><a class="reference internal" href="#metadata-external-be-checksum">metadata.external.be.checksum</a></li>
<li><a class="reference internal" href="#metadata-external-bitrot">metadata.external.bitrot</a></li>
<li><a class="reference internal" href="#metadata-external-dix-dtm0">metadata.external.dix.dtm0</a></li>
<li><a class="reference internal" href="#metadata-external-directrebalance">metadata.external.directrebalance</a></li>
<li><a class="reference internal" href="#ha-halon-model">ha.halon.model</a></li>
<li><a class="reference internal" href="#ha-state">ha.state</a></li>
<li><a class="reference internal" href="#ha-state-hold">ha.state.hold</a></li>
<li><a class="reference internal" href="#ha-state-dependency">ha.state.dependency</a></li>
<li><a class="reference internal" href="#ha-state-epoch">ha.state.epoch</a></li>
<li><a class="reference internal" href="#ha-state-broadcast">ha.state.broadcast</a></li>
<li><a class="reference internal" href="#ha-conf">ha.conf</a></li>
<li><a class="reference internal" href="#conf-object-categories">conf.object.categories</a></li>
<li><a class="reference internal" href="#ha-hold-handler">ha.hold.handler</a></li>
<li><a class="reference internal" href="#ha-hold-handler-queue">ha.hold.handler.queue</a></li>
<li><a class="reference internal" href="#conf-object-persistence">conf.object.persistence</a></li>
<li><a class="reference internal" href="#ha-hold-example">ha.hold.example</a></li>
<li><a class="reference internal" href="#ha-draft">ha.draft</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
<h3><a href="#">Table of Contents</a></h3>

  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/index.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
  </ul></li>
</ul>
</div><h3>Navigation</h3>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2018, Seagate.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>